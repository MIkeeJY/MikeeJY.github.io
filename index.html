<!doctype html>



  


<html class="theme-next muse use-motion">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta property="og:type" content="website">
<meta property="og:title" content="Mikee的八度空间">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Mikee的八度空间">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mikee的八度空间">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Mikee的八度空间 </title>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Mikee的八度空间</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/12/10/job2018/" itemprop="url">
                  2018年年底Android悲催的面试之路
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-12-10T21:32:46+08:00" content="2018-12-10">
              2018-12-10
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="本人近况"><a href="#本人近况" class="headerlink" title="本人近况"></a>本人近况</h1><p>年底裁人了，一年半没准备面试了，之前换也是内推的，在这个寒冬的冬天还经历此遭，偏偏还赶上裁员<br>心态早已爆炸，大的环境不好，各位且干且珍惜….<br>记录下最近的面试经历，整理下让自己不断进步！</p>
<h3 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h3><p>我不知道一个人人性究竟可以坏到什么程度，但是我最近亲身经历的确实是这样，我一个安心想做技术的人跟你TMD HR部门的八竿子打不着，又何苦为难我呢？ 之前有个公司的薪酬绩效主管，邵X，只因为我在大会上顶撞了她一个问题，一味着揪着我的把柄不放，甚至特么的为了少给我一个季度的绩效不允许提前转正，真的是坏透了，可能这就是职场，这就是江湖充满尔虞我诈，真的人真是身不由己的，本想与世无争安心踏实做技术，但是某些人却看不得你的安宁。。。还是那句话，出来混的迟早要还的，望好自为之</p>
<h2 id="右划"><a href="#右划" class="headerlink" title="右划"></a>右划</h2><blockquote>
<p>这公司是在拉勾上投的，CEO号称曾于字节跳动，任视频负责人，创建了头条视频APP。公司待遇15薪非常不错，坐落于望京Soho对面的望京融科写字楼</p>
<ul>
<li>面试过程觉得自己挺失败的没有充分准备算法再加上由于一年半没有再面试过了，有点手生，好多应该答上来的问题都没有答好，面试官确实是大牛，没会的问题也稍微讲解了下，不过深度确实蛮深的</li>
<li>印象比较深的几个问题：Lru算法，Binder机制，EventBus实现原理和为什么不能跨进程，Handler如何在handleMessage方法拦截之前发出的message，手写二分法查找（没准备直接跪了），后来让我手写冒泡，我觉得前面已经没戏了（大致说了下双重循环然后赋值也没手写），跨进程几种方式，AIDL，handler机制，ThreadLocal实现原理（回答的很模糊，附上正确答案：每个Thread的对象都有一个ThreadLocalMap，当创建一个ThreadLocal的时候，就会将该ThreadLocal对象添加到该Map中，其中键就是ThreadLocal，值可以是任意类型。</li>
</ul>
</blockquote>
<p>在该类中，最重要的方法就是两个：set()和get()方法。当调用ThreadLocal的get()方法的时候，会先找到当前线程的ThreadLocalMap，然后再找到对应的值。set()方法也是一样。）系统是如何监听ANR的（他说是androidframework层有一个单独的进程），后来问到如何定位和排查我不小心说了blockCanary，他有追问了一下源码和原理我回答的也不是很好（应用发生卡顿，一定是在dispatchMessage中执行了耗时操作。我们通过给主线程的Looper设置一个Printer，打点统计dispatchMessage方法执行的时间，如果超出阀值，表示发生卡顿，则dump出各种信息，提供开发者分析性能瓶颈。）<br>最后知道今天一定挂了，不过还是很有收获的知道自己哪里不足…<br>PS:明天去五道口面试斗鱼，希望能好好把握</p>
<h2 id="斗鱼"><a href="#斗鱼" class="headerlink" title="斗鱼"></a>斗鱼</h2><blockquote>
<p>拉勾投的斗鱼，据说最近在疯狂裁人？只经历了两轮面试，一共面了两个多小时，没到HR，估计歇菜了</p>
<ul>
<li>斗鱼有份笔试题，还是蛮简单的随便写写就ok，一面问的蛮详细的，问的大致是看简历写的东西问的，中规中矩，记忆比较深刻的是问了handlerThread原理,MVP模式（因为斗鱼目前的架构都是mvp），弹幕的实现原理和重叠问题（这个没怎么做过，回答的不是太好，而且之前也是直接用的B站开源的那个库），Kotlin协程（这个没用过,kt的掌握程度还只是入门阶段），Retrofit+Okhttp+Rxjava在华为的好多手机会OOM是由线程数溢出引起如何解决？堆内存，栈内存理解，栈如何转换成堆？内存泄漏是发生在堆内存还是栈内存？为什么？ BlockCanary原理？（第二次被问了！！！看来真要看看源码了）如何实现打印指定阻塞线程的方法名？LinkedHashMap与HashMap区别。。。<br>String a=“A” 与 String a = new String（“A”); 区别，分别存储在哪个区域（这题有误导嫌疑，第一个应该是常量区，堆栈都不是，第二个是栈）MutiDex 第一次ANR以及解决方式<br>我觉得大部分的问题回答的还是不错的，一面问了下薪资然后开始二面</li>
<li>二面印象最深的是根据面向对象设计一个电梯系统，问题的关键点在于所有的属性都跟电梯有关，跟人无关，楼层数是固定的常量…我当时设计跑偏了，总联想到人然后去设计。。<br>结束以后没有HR面，估计歇菜了…再接再厉吧…</li>
</ul>
</blockquote>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/08/24/AndroidDex分包之旅/" itemprop="url">
                  Android Dex分包之旅
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-08-24T11:40:00+08:00" content="2018-08-24">
              2018-08-24
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当程序越来越大之后，出现了一个 dex 包装不下的情况，通过 MultiDex 的方法解决了这个问题，但是在底端机器上又出现了 INSTALL_FAILED_DEXOPT 的情况，那再解决这个问题吧。等解决完这个问题之后，发现需要填的坑越来越多了，文章讲的是我在分包处理中填的坑，比如 65536、LinearAlloc、NoClassDefFoundError等等。</p>
<h2 id="INSTALL-FAILED-DEXOPT"><a href="#INSTALL-FAILED-DEXOPT" class="headerlink" title="INSTALL_FAILED_DEXOPT"></a>INSTALL_FAILED_DEXOPT</h2><p>INSTALL_FAILED_DEXOPT 出现的原因大部分都是两种，一种是 65536 了，另外一种是 LinearAlloc 太小了。两者的限制不同，但是原因却是相似，那就是App太大了，导致没办法安装到手机上。</p>
<h2 id="65536"><a href="#65536" class="headerlink" title="65536"></a>65536</h2><p>trouble writing output: Too many method references: 70048; max is 65536.<br>或者<br>UNEXPECTED TOP-LEVEL EXCEPTION:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: method ID not in [0, 0xffff]: 65536</span><br><span class="line">​ at com.android.dx.merge.DexMerger$6.updateIndex(DexMerger.java:501)</span><br><span class="line">​ at com.android.dx.merge.DexMerger$IdMerger.mergeSorted(DexMerger.java:276)</span><br><span class="line">​ at com.android.dx.merge.DexMerger.mergeMethodIds(DexMerger.java:490)</span><br><span class="line">​ at com.android.dx.merge.DexMerger.mergeDexes(DexMerger.java:167)</span><br><span class="line">​ at com.android.dx.merge.DexMerger.merge(DexMerger.java:188)</span><br><span class="line">​ at com.android.dx.command.dexer.Main.mergeLibraryDexBuffers(Main.java:439)</span><br><span class="line">​ at com.android.dx.command.dexer.Main.runMonoDex(Main.java:287)</span><br><span class="line">​ at com.android.dx.command.dexer.Main.run(Main.java:230)</span><br><span class="line">​ at com.android.dx.command.dexer.Main.main(Main.java:199)</span><br><span class="line">​ at com.android.dx.command.Main.main(Main.java:103):Derp:dexDerpDebug FAILED</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">编译环境</span><br><span class="line">``` </span><br><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &apos;com.android.tools.build:gradle:1.3.0&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion 23</span><br><span class="line">    buildToolsVersion &quot;25.0.3&quot;</span><br><span class="line">    //....</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdkVersion 14</span><br><span class="line">        targetSdkVersion 23</span><br><span class="line">        //....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">#### 为什么是65536</span><br><span class="line">根据 StackOverFlow – Does the Android ART runtime have the same method limit limitations as Dalvik? 上面的说法，是因为 Dalvik 的 invoke-kind 指令集中，method reference index 只留了 16 bits，最多能引用 65535 个方法。Dalvik bytecode ：</span><br><span class="line"></span><br><span class="line">| Op &amp; Format	Mnemonic      |    Mnemonic / Syntax | Arguments  |</span><br><span class="line">| :-------- | --------:| :--: |</span><br><span class="line">| 6e..72   | invoke-kind &#123;vC, vD, vE, vF, vG&#125;, meth@BBBB6e:  |  A: argument word count (4 bits)B:   |</span><br><span class="line">| 35c     |   invoke-virtual6f: invoke-super70: invoke-direct71: invoke-static72: invoke-interface |  method reference index (16 bits)C..G: argument registers (4 bits each)  |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 即使 dex 里面的引用方法数超过了 65536，那也只有前面的 65536 得的到调用。所以这个不是 dex 的原因。其次，既然和 dex 没有关系，那在打包 dex 的时候为什么会报错。我们先定位 Too many 关键字，定位到了 MemberIdsSection ：</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">public abstract class MemberIdsSection extends UniformItemSection &#123;</span><br><span class="line">  /** &#123;@inheritDoc&#125; */</span><br><span class="line">    @Override</span><br><span class="line">    protected void orderItems() &#123;</span><br><span class="line">        int idx = 0;</span><br><span class="line"></span><br><span class="line">        if (items().size() &gt; DexFormat.MAX_MEMBER_IDX + 1) &#123;</span><br><span class="line">            throw new DexIndexOverflowException(getTooManyMembersMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for (Object i : items()) &#123;</span><br><span class="line">            ((MemberIdItem) i).setIndex(idx);</span><br><span class="line">            idx++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private String getTooManyMembersMessage() &#123;</span><br><span class="line">        Map&lt;String, AtomicInteger&gt; membersByPackage = new TreeMap&lt;String, AtomicInteger&gt;();</span><br><span class="line">        for (Object member : items()) &#123;</span><br><span class="line">            String packageName = ((MemberIdItem) member).getDefiningClass().getPackageName();</span><br><span class="line">            AtomicInteger count = membersByPackage.get(packageName);</span><br><span class="line">            if (count == null) &#123;</span><br><span class="line">                count = new AtomicInteger();</span><br><span class="line">                membersByPackage.put(packageName, count);</span><br><span class="line">            &#125;</span><br><span class="line">            count.incrementAndGet();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Formatter formatter = new Formatter();</span><br><span class="line">        try &#123;</span><br><span class="line">            String memberType = this instanceof MethodIdsSection ? &quot;method&quot; : &quot;field&quot;;</span><br><span class="line">            formatter.format(&quot;Too many %s references: %d; max is %d.%n&quot; +</span><br><span class="line">                    Main.getTooManyIdsErrorMessage() + &quot;%n&quot; +</span><br><span class="line">                    &quot;References by package:&quot;,</span><br><span class="line">                    memberType, items().size(), DexFormat.MAX_MEMBER_IDX + 1);</span><br><span class="line">            for (Map.Entry&lt;String, AtomicInteger&gt; entry : membersByPackage.entrySet()) &#123;</span><br><span class="line">                formatter.format(&quot;%n%6d %s&quot;, entry.getValue().get(), entry.getKey());</span><br><span class="line">            &#125;</span><br><span class="line">            return formatter.toString();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            formatter.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">items().size() &gt; DexFormat.MAX_MEMBER_IDX + 1 ，那 DexFormat 的值是：</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">public final class DexFormat &#123;</span><br><span class="line">  /**</span><br><span class="line">     * Maximum addressable field or method index.</span><br><span class="line">     * The largest addressable member is 0xffff, in the &quot;instruction formats&quot; spec as field@CCCC or</span><br><span class="line">     * meth@CCCC.</span><br><span class="line">     */</span><br><span class="line">    public static final int MAX_MEMBER_IDX = 0xFFFF;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">dx 在这里做了判断，当大于 65536 的时候就抛出异常了。所以在生成 dex 文件的过程中，当调用方法数不能超过 65535 。那我们再跟一跟代码，发现 MemberIdsSection 的一个子类叫 MethodidsSection ：</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">public final class MethodIdsSection extends MemberIdsSection &#123;&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">回过头来，看一下 orderItems() 方法在哪里被调用了，跟到了 MemberIdsSection 的父类 UniformItemSection :</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">public abstract class UniformItemSection extends Section &#123;</span><br><span class="line">	@Override</span><br><span class="line">    protected final void prepare0() &#123;</span><br><span class="line">        DexFile file = getFile();</span><br><span class="line"></span><br><span class="line">        orderItems();</span><br><span class="line"></span><br><span class="line">        for (Item one : items()) &#123;</span><br><span class="line">            one.addContents(file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">	protected abstract void orderItems();</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">再跟一下 prepare0 在哪里被调用，查到了 UniformItemSection 父类 Section :</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">public abstract class Section &#123;</span><br><span class="line">	public final void prepare() &#123;</span><br><span class="line">        throwIfPrepared();</span><br><span class="line">        prepare0();</span><br><span class="line">        prepared = true;</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">  	protected abstract void prepare0();</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">那现在再跟一下 prepare() ，查到 DexFile 中有调用：</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">public final class DexFile &#123;</span><br><span class="line">  private ByteArrayAnnotatedOutput toDex0(boolean annotate, boolean verbose) &#123;</span><br><span class="line">        classDefs.prepare();</span><br><span class="line">        classData.prepare();</span><br><span class="line">        wordData.prepare();</span><br><span class="line">        byteData.prepare();</span><br><span class="line">        methodIds.prepare();</span><br><span class="line">        fieldIds.prepare();</span><br><span class="line">        protoIds.prepare();</span><br><span class="line">        typeLists.prepare();</span><br><span class="line">        typeIds.prepare();</span><br><span class="line">        stringIds.prepare();</span><br><span class="line">        stringData.prepare();</span><br><span class="line">        header.prepare();</span><br><span class="line">		//blablabla......</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">那再看一下 toDex0() 吧，因为是 private 的，直接在类中找调用的地方就可以了：</span><br><span class="line">``` </span><br><span class="line">public final class DexFile &#123;</span><br><span class="line">	public byte[] toDex(Writer humanOut, boolean verbose) throws IOException &#123;</span><br><span class="line">        boolean annotate = (humanOut != null);</span><br><span class="line">        ByteArrayAnnotatedOutput result = toDex0(annotate, verbose);</span><br><span class="line"></span><br><span class="line">        if (annotate) &#123;</span><br><span class="line">            result.writeAnnotationsTo(humanOut);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return result.getArray();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	public void writeTo(OutputStream out, Writer humanOut, boolean verbose) throws IOException &#123;</span><br><span class="line">        boolean annotate = (humanOut != null);</span><br><span class="line">        ByteArrayAnnotatedOutput result = toDex0(annotate, verbose);</span><br><span class="line"></span><br><span class="line">        if (out != null) &#123;</span><br><span class="line">            out.write(result.getArray());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (annotate) &#123;</span><br><span class="line">            result.writeAnnotationsTo(humanOut);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">先搜搜 toDex() 方法吧，最终发现在 com.android.dx.command.dexer.Main 中：</span><br><span class="line">``` </span><br><span class="line">public class Main &#123;</span><br><span class="line">	private static byte[] writeDex(DexFile outputDex) &#123;</span><br><span class="line">        byte[] outArray = null;</span><br><span class="line">      	//blablabla......</span><br><span class="line">		if (args.methodToDump != null) &#123;</span><br><span class="line">			outputDex.toDex(null, false);</span><br><span class="line">            dumpMethod(outputDex, args.methodToDump, humanOutWriter);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			outArray = outputDex.toDex(humanOutWriter, args.verboseDump);</span><br><span class="line">		&#125;</span><br><span class="line">		//blablabla......</span><br><span class="line">        return outArray;</span><br><span class="line">    &#125;</span><br><span class="line">  	//调用writeDex的地方</span><br><span class="line">  	private static int runMonoDex() throws IOException &#123;</span><br><span class="line">  		//blablabla......</span><br><span class="line">      	outArray = writeDex(outputDex);</span><br><span class="line">      	//blablabla......</span><br><span class="line">	&#125;</span><br><span class="line">  	//调用runMonoDex的地方</span><br><span class="line">  	public static int run(Arguments arguments) throws IOException &#123;</span><br><span class="line">  		if (args.multiDex) &#123;</span><br><span class="line">			return runMultiDex();</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">            return runMonoDex();</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">args.multiDex 就是是否分包的参数，那么问题找着了，如果不选择分包的情况下，引用方法数超过了 65536 的话就会抛出异常。</span><br><span class="line"></span><br><span class="line">同样分析第二种情况，根据错误信息可以具体定位到代码，但是很奇怪的是 DexMerger ，我们没有设置分包参数或者其他参数，为什么会有 DexMerger ，而且依赖工程最终不都是 aar 格式的吗？那我们还是来跟一跟代码吧。</span><br><span class="line">``` </span><br><span class="line">public class Main &#123;</span><br><span class="line">	private static byte[] mergeLibraryDexBuffers(byte[] outArray) throws IOException &#123;</span><br><span class="line">        ArrayList&lt;Dex&gt; dexes = new ArrayList&lt;Dex&gt;();</span><br><span class="line">        if (outArray != null) &#123;</span><br><span class="line">            dexes.add(new Dex(outArray));</span><br><span class="line">        &#125;</span><br><span class="line">        for (byte[] libraryDex : libraryDexBuffers) &#123;</span><br><span class="line">            dexes.add(new Dex(libraryDex));</span><br><span class="line">        &#125;</span><br><span class="line">        if (dexes.isEmpty()) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        Dex merged = new DexMerger(dexes.toArray(new Dex[dexes.size()]), CollisionPolicy.FAIL).merge();</span><br><span class="line">        return merged.getBytes();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">这里可以看到变量 libraryDexBuffers ，是一个 List 集合，那么我们看一下这个集合在哪里添加数据的：</span><br><span class="line">``` </span><br><span class="line">public class Main &#123;</span><br><span class="line">	private static boolean processFileBytes(String name, long lastModified, byte[] bytes) &#123;</span><br><span class="line">  		boolean isClassesDex = name.equals(DexFormat.DEX_IN_JAR_NAME);</span><br><span class="line">      	//blablabla...</span><br><span class="line">        &#125; else if (isClassesDex) &#123;</span><br><span class="line">            synchronized (libraryDexBuffers) &#123;</span><br><span class="line">                libraryDexBuffers.add(bytes);</span><br><span class="line">            &#125;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">      	//blablabla...</span><br><span class="line">	&#125;</span><br><span class="line">  	//调用processFileBytes的地方</span><br><span class="line">  	private static class FileBytesConsumer implements ClassPathOpener.Consumer &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean processFileBytes(String name, long lastModified,</span><br><span class="line">                byte[] bytes)   &#123;</span><br><span class="line">            return Main.processFileBytes(name, lastModified, bytes);</span><br><span class="line">        &#125;</span><br><span class="line">      	//blablabla...</span><br><span class="line">    &#125;</span><br><span class="line">  	//调用FileBytesConsumer的地方</span><br><span class="line">  	private static void processOne(String pathname, FileNameFilter filter) &#123;</span><br><span class="line">        ClassPathOpener opener;</span><br><span class="line"></span><br><span class="line">        opener = new ClassPathOpener(pathname, true, filter, new FileBytesConsumer());</span><br><span class="line"></span><br><span class="line">        if (opener.process()) &#123;</span><br><span class="line">          updateStatus(true);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  	//调用processOne的地方</span><br><span class="line">  	private static boolean processAllFiles() &#123;</span><br><span class="line">      	//blablabla...</span><br><span class="line">  		// forced in main dex</span><br><span class="line">        for (int i = 0; i &lt; fileNames.length; i++) &#123;</span><br><span class="line">			processOne(fileNames[i], mainPassFilter);</span><br><span class="line">		&#125;</span><br><span class="line">      	//blablabla...</span><br><span class="line">	&#125;</span><br><span class="line">  	//调用processAllFiles的地方</span><br><span class="line">  	private static int runMonoDex() throws IOException &#123;</span><br><span class="line">      	//blablabla...</span><br><span class="line">  		if (!processAllFiles()) &#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;</span><br><span class="line">      	//blablabla...</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">跟了一圈又跟回来了，但是注意一个变量：fileNames[i]，传进去这个变量，是个地址，最终在 processFileBytes 中处理后添加到 libraryDexBuffers 中，那跟一下这个变量：</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line">public class Main &#123;</span><br><span class="line">  	private static boolean processAllFiles() &#123;</span><br><span class="line">      	//blablabla...</span><br><span class="line">  		String[] fileNames = args.fileNames;</span><br><span class="line">      	//blablabla...</span><br><span class="line">	&#125;</span><br><span class="line">  	public void parse(String[] args) &#123;</span><br><span class="line">      	//blablabla...</span><br><span class="line">    	&#125;else if(parser.isArg(INPUT_LIST_OPTION + &quot;=&quot;)) &#123;</span><br><span class="line">			File inputListFile = new File(parser.getLastValue());</span><br><span class="line">			try&#123;</span><br><span class="line">				inputList = new ArrayList&lt;String&gt;();</span><br><span class="line">                readPathsFromFile(inputListFile.getAbsolutePath(), inputList);</span><br><span class="line">            &#125; catch(IOException e) &#123;</span><br><span class="line">				System.err.println(&quot;Unable to read input list file: &quot; + inputListFile.getName());</span><br><span class="line">				throw new UsageException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">      	//blablabla...</span><br><span class="line">  		fileNames = parser.getRemaining();</span><br><span class="line">		if(inputList != null &amp;&amp; !inputList.isEmpty()) &#123;</span><br><span class="line">            inputList.addAll(Arrays.asList(fileNames));</span><br><span class="line">            fileNames = inputList.toArray(new String[inputList.size()]);</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">  	</span><br><span class="line">  	public static void main(String[] argArray) throws IOException &#123;</span><br><span class="line">        Arguments arguments = new Arguments();</span><br><span class="line">        arguments.parse(argArray);</span><br><span class="line"></span><br><span class="line">        int result = run(arguments);</span><br><span class="line">        if (result != 0) &#123;</span><br><span class="line">            System.exit(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">跟到这里发现是传进来的参数，那我们再看看 gradle 里面传的是什么参数吧，查看 Dex task :</span><br><span class="line">``` </span><br><span class="line">public class Dex extends BaseTask &#123;</span><br><span class="line">  	@InputFiles</span><br><span class="line">    Collection&lt;File&gt; libraries</span><br><span class="line">&#125;</span><br><span class="line">我们把这个参数打印出来：</span><br><span class="line"></span><br><span class="line">afterEvaluate &#123;</span><br><span class="line">    tasks.matching &#123;</span><br><span class="line">        it.name.startsWith(&apos;dex&apos;)</span><br><span class="line">    &#125;.each &#123; dx -&gt;</span><br><span class="line">        if (dx.additionalParameters == null) &#123;</span><br><span class="line">            dx.additionalParameters = []</span><br><span class="line">        &#125;</span><br><span class="line">        println dx.libraries</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">打印出来发现是 build/intermediates/pre-dexed/ 目录里面的 jar 文件，再把 jar 文件解压发现里面就是 dex 文件了。所以 DexMerger 的工作就是合并这里的 dex 。</span><br><span class="line"></span><br><span class="line">更改编译环境</span><br><span class="line">``` </span><br><span class="line">buildscript &#123;</span><br><span class="line">	//...</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath &apos;com.android.tools.build:gradle:2.1.0-alpha3&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">将 gradle 设置为 2.1.0-alpha3 之后，在项目的 build.gradle 中即使没有设置 multiDexEnabled true 也能够编译通过，但是生成的 apk 包依旧是两个 dex ，我想的是可能为了设置 instantRun 。</span><br><span class="line"></span><br><span class="line">#### 解决 65536</span><br><span class="line"></span><br><span class="line">Google MultiDex 解决方案：</span><br><span class="line"></span><br><span class="line">在 gradle 中添加 MultiDex 的依赖：</span><br><span class="line">``` </span><br><span class="line">dependencies &#123; compile &apos;com.android.support:MultiDex:1.0.0&apos; &#125;</span><br><span class="line">``` </span><br><span class="line">在 gradle 中配置 MultiDexEnable :</span><br><span class="line">``` </span><br><span class="line">android &#123;</span><br><span class="line">	buildToolsVersion &quot;21.1.0&quot;</span><br><span class="line">	defaultConfig &#123;</span><br><span class="line">        // Enabling MultiDex support.</span><br><span class="line">        MultiDexEnabled true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">在 AndroidManifest.xml 的 application 中声明:</span><br><span class="line">``` </span><br><span class="line">&lt;application</span><br><span class="line">  android:name=&quot;android.support.multidex.MultiDexApplication&quot;&gt;</span><br><span class="line">&lt;application/&gt;</span><br><span class="line">``` </span><br><span class="line">如果有自己的 Application 了，让其继承于 MultiDexApplication 。</span><br><span class="line"></span><br><span class="line">如果继承了其他的 Application ，那么可以重写 attachBaseContext(Context):</span><br><span class="line">``` </span><br><span class="line">@Override </span><br><span class="line">protected void attachBaseContext(Context base) &#123;</span><br><span class="line">    super.attachBaseContext(base);</span><br><span class="line">    MultiDex.install(this);</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">## LinearAlloc</span><br><span class="line">gradle：</span><br></pre></td></tr></table></figure></p>
<p>afterEvaluate {<br>  tasks.matching {<br>    it.name.startsWith(‘dex’)<br>  }.each { dx -&gt;<br>    if (dx.additionalParameters == null) {<br>      dx.additionalParameters = []<br>    }<br>    dx.additionalParameters += ‘–set-max-idx-number=48000’<br>  }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--set-max-idx-number= 用于控制每一个 dex 的最大方法个数。</span><br><span class="line"></span><br><span class="line">这个参数在查看 dx.jar 找到：</span><br></pre></td></tr></table></figure></p>
<p>//blablabla…<br>} else if (parser.isArg(“–set-max-idx-number=”)) { // undocumented test option<br>  maxNumberOfIdxPerDex = Integer.parseInt(parser.getLastValue());<br>} else if(parser.isArg(INPUT_LIST_OPTION + “=”)) {<br>//blablabla…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">更多细节可以查看源码：Github – platform_dalvik/Main</span><br><span class="line"></span><br><span class="line">FB 的工程师们曾经还想到过直接修改 LinearAlloc 的大小，比如从 5M 修改到 8M： Under the Hood: Dalvik patch for Facebook for Android 。</span><br><span class="line"></span><br><span class="line">## dexopt &amp;&amp; dex2oat</span><br><span class="line">![](media/15350820002263/15350900382484.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## dexopt</span><br><span class="line">当 Android 系统安装一个应用的时候，有一步是对 Dex 进行优化，这个过程有一个专门的工具来处理，叫 DexOpt。DexOpt 是在第一次加载 Dex 文件的时候执行的，将 dex 的依赖库文件和一些辅助数据打包成 odex 文件，即 Optimised Dex，存放在 cache/dalvik_cache 目录下。保存格式为 apk路径 @ apk名 @ classes.dex 。执行 ODEX 的效率会比直接执行 Dex 文件的效率要高很多。</span><br><span class="line"></span><br><span class="line">## dex2oat</span><br><span class="line">Android Runtime 的 dex2oat 是将 dex 文件编译成 oat 文件。而 oat 文件是 elf 文件，是可以在本地执行的文件，而 Android Runtime 替换掉了虚拟机读取的字节码转而用本地可执行代码，这就被叫做 AOT(ahead-of-time)。dex2oat 对所有 apk 进行编译并保存在 dalvik-cache 目录里。PackageManagerService 会持续扫描安装目录，如果有新的 App 安装则马上调用 dex2oat 进行编译。</span><br><span class="line"></span><br><span class="line">## NoClassDefFoundError</span><br><span class="line">现在 INSTALL_FAILED_DEXOPT 问题是解决了，但是有时候编译完运行的时候一打开 App 就 crash 了，查看 log 发现是某个类找不到引用。</span><br><span class="line"></span><br><span class="line">- Build Tool 是如何分包的</span><br><span class="line">为什么会这样呢？是因为 build-tool 在分包的时候只判断了直接引用类。什么是直接引用类呢？举个栗子：</span><br></pre></td></tr></table></figure></p>
<p>public class MainActivity extends Activity {<br>    protected void onCreate(Bundle savedInstanceState) {<br>        DirectReferenceClass test = new DirectReferenceClass();<br>    }<br>}</p>
<p>public class DirectReferenceClass {<br>    public DirectReferenceClass() {<br>        InDirectReferenceClass test = new InDirectReferenceClass();<br>    }<br>}</p>
<p>public class InDirectReferenceClass {<br>    public InDirectReferenceClass() {</p>
<pre><code>}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">上面有 MainActivity、DirectReferenceClass 、InDirectReferenceClass 三个类，其中 DirectReferenceClass 是 MainActivity 的直接引用类，InDirectReferenceClass 是 DirectReferenceClass 的直接引用类。而 InDirectReferenceClass 是 MainActivity 的间接引用类(即直接引用类的所有直接引用类)。</span><br><span class="line"></span><br><span class="line">如果我们代码是这样写的：</span><br></pre></td></tr></table></figure></p>
<p>public class HelloMultiDexApplication extends Application {<br>    @Override<br>    protected void attachBaseContext(Context base) {<br>        super.attachBaseContext(base);<br>        DirectReferenceClass test = new DirectReferenceClass();<br>        MultiDex.install(this);<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">这样直接就 crash 了。同理还要单例模式中拿到单例之后直接调用某个方法返回的是另外一个对象，并非单例对象。</span><br><span class="line"></span><br><span class="line">build tool 的分包操作可以查看 sdk 中 build-tools 文件夹下的 mainDexClasses 脚本，同时还发现了 mainDexClasses.rules 文件，该文件是主 dex 的匹配规则。该脚本要求输入一个文件组（包含编译后的目录或jar包），然后分析文件组中的类并写入到–output所指定的文件中。实现原理也不复杂，主要分为三步：</span><br><span class="line"></span><br><span class="line">- 环境检查，包括传入参数合法性检查，路径检查以及proguard环境检测等。</span><br><span class="line">- 使用mainDexClasses.rules规则，通过Proguard的shrink功能，裁剪无关类，生成一个tmp.jar包。</span><br><span class="line">- 通过生成的tmp jar包，调用MainDexListBuilder类生成主dex的文件列表</span><br><span class="line"></span><br><span class="line">## Gradle 打包流程中是如何分包的</span><br><span class="line">在项目中，可以直接运行 gradle 的 task 。</span><br><span class="line">- **collect&#123;flavor&#125;&#123;buildType&#125;MultiDexComponents** Task 。这个 task 是获取 AndroidManifest.xml 中 Application 、Activity 、Service 、 Receiver 、 Provider 等相关类，以及 Annotation ，之后将内容写到 **build/intermediates/multi-dex/&#123;flavor&#125;/&#123;buildType&#125;/maindexlist.txt** 文件中去。</span><br><span class="line"></span><br><span class="line">- **packageAll&#123;flavor&#125;DebugClassesForMultiDex** Task 。该 task 是将所有类打包成 jar 文件存在 **build/intermediates/multi-dex/&#123;flavor&#125;/debug/allclasses.jar** 。 当 BuildType 为 Release 的时候，执行的是 proguard&#123;flavor&#125;Release Task，该 task 将 proguard 混淆后的类打包成 jar 文件存在 **build/intermediates/classes-proguard/&#123;flavor&#125;/release/classes.jar**</span><br><span class="line"></span><br><span class="line">- **shrink&#123;flavor&#125;&#123;buildType&#125;MultiDexComponents** Task 。该 task 会根据 maindexlist.txt 生成 componentClasses.jar ，该 jar 包里面就只有 maindexlist.txt 里面的类，该 jar 包的位置在 **build/intermediates/multi-dex/&#123;flavor&#125;/&#123;buildType&#125;/componentClasses.jar**</span><br><span class="line"></span><br><span class="line">- **create&#123;flavor&#125;&#123;buildType&#125;MainDexClassList** Task 。该 task 会根据生成的 componentClasses.jar 去找这里面的所有的 class 中直接依赖的 class ，然后将内容写到 **build/intermediates/multi-dex/&#123;flavor&#125;/&#123;buildType&#125;/maindexlist.txt** 中。最终这个文件里面列出来的类都会被分配到第一个 dex 里面。</span><br><span class="line"></span><br><span class="line">## 解决 NoClassDefFoundError</span><br><span class="line">gradle :</span><br></pre></td></tr></table></figure></p>
<p>afterEvaluate {<br>  tasks.matching {<br>    it.name.startsWith(‘dex’)<br>  }.each { dx -&gt;<br>    if (dx.additionalParameters == null) {<br>      dx.additionalParameters = []<br>    }<br>    dx.additionalParameters += ‘–set-max-idx-number=48000’<br>    dx.additionalParameters += “–main-dex-list=$projectDir/multidex.keep”.toString()<br>  }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">**--main-dex-list=** 参数是一个类列表的文件，在该文件中的类会被打包在第一个 dex 中。</span><br><span class="line"></span><br><span class="line">multidex.keep 里面列上需要打包到第一个 dex 的 class 文件，注意，如果需要混淆的话需要写混淆之后的 class 。</span><br><span class="line"></span><br><span class="line">## Application Not Responding</span><br><span class="line">因为第一次运行（包括清除数据之后）的时候需要 dexopt ，然而 dexopt 是一个比较耗时的操作，同时 MultiDex.install() 操作是在 Application.attachBaseContext() 中进行的，占用的是UI线程。那么问题来了，当我的第二个包、第三个包很大的时候，程序就阻塞在 MultiDex.install() 这个地方了，一旦超过规定时间，那就 ANR 了。那怎么办？放子线程？如果 Application 有一些初始化操作，到初始化操作的地方的时候都还没有完成 install + dexopt 的话，那不是又 NoClassDefFoundError 了吗？同时 ClassLoader 放在哪个线程都让主线程挂起。好了，那在 multidex.keep 的加上相关的所有的类吧。好像这样成了，但是第一个 dex 又大起来了，而且如果用户操作快，还没完成 install + dexopt 但是已经把 App 所以界面都打开了一遍。。。虽然这不现实。。</span><br><span class="line"># 微信加载方案</span><br><span class="line">首次加载在地球中页中, 并用线程去加载（但是 5.0 之前加载 dex 时还是会挂起主线程一段时间（不是全程都挂起））。</span><br><span class="line">- dex 形式</span><br><span class="line"> 微信是将包放在 assets 目录下的，在加载 Dex 的代码时，实际上传进去的是 zip，在加载前需要验证 MD5，确保所加载的 Dex 没有被篡改。</span><br><span class="line"> </span><br><span class="line">- dex 类分包规则</span><br><span class="line">分包规则即将所有 Application、ContentProvider 以及所有 export 的 Activity、Service 、Receiver 的间接依赖集都必须放在主 dex。</span><br><span class="line"></span><br><span class="line">- 加载 dex 的方式</span><br><span class="line">加载逻辑这边主要判断是否已经 dexopt，若已经 dexopt，即放在 attachBaseContext 加载，反之放于地球中用线程加载。怎么判断？因为在微信中，若判断 revision 改变，即将 dex 以及 dexopt 目录清空。只需简单判断两个目录 dex 名称、数量是否与配置文件的一致。</span><br><span class="line"></span><br><span class="line">总的来说，这种方案用户体验较好，缺点在于太过复杂，每次都需重新扫描依赖集，而且使用的是比较大的间接依赖集。</span><br><span class="line"></span><br><span class="line">## Facebook 加载方案</span><br><span class="line"></span><br><span class="line">Facebook的思路是将 **MultiDex.install()** 操作放在另外一个经常进行的。</span><br><span class="line"></span><br><span class="line">- dex 形式</span><br><span class="line"></span><br><span class="line">   与微信相同。</span><br><span class="line"></span><br><span class="line">- dex 类分包规则</span><br><span class="line"></span><br><span class="line">   Facebook 将加载 dex 的逻辑单独放于一个单独的 nodex 进程中。</span><br></pre></td></tr></table></figure></p>
<p><activity android:exported="false" android:process=":nodex" android:name="com.facebook.nodex.startup.splashscreen.NodexSplashActivity"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">所有的依赖集为 Application、NodexSplashActivity 的间接依赖集即可。</span><br><span class="line"></span><br><span class="line">- 加载 dex 的方式</span><br><span class="line"></span><br><span class="line">  因为 NodexSplashActivity 的 intent-filter 指定为 Main 和LAUNCHER ，所以一打开 App 首先拉起 nodex 进程，然后打开 NodexSplashActivity 进行 MultiDex.install() 。如果已经进行了 dexpot 操作的话就直接跳转主界面，没有的话就等待 dexpot 操作完成再跳转主界面。</span><br><span class="line"></span><br><span class="line">这种方式好处在于依赖集非常简单，同时首次加载 dex 时也不会卡死。但是它的缺点也很明显，即每次启动主进程时，都需先启动 nodex 进程。尽管 nodex 进程逻辑非常简单，这也需100ms以上。</span><br><span class="line"></span><br><span class="line">## 美团加载方案</span><br><span class="line">- dex 形式</span><br><span class="line">  在 gradle 生成 dex 文件的这步中，自定义一个 task 来干预 dex 的生产过程，从而产生多个 dex 。</span><br></pre></td></tr></table></figure></activity></p>
<p> tasks.whenTaskAdded { task -&gt;<br>    if (task.name.startsWith(‘proguard’) &amp;&amp; (task.name.endsWith(‘Debug’) || task.name.endsWith(‘Release’))) {<br>        task.doLast {<br>            makeDexFileAfterProguardJar();<br>        }<br>        task.doFirst {<br>            delete “${project.buildDir}/intermediates/classes-proguard”;</p>
<pre><code>        String flavor = task.name.substring(&apos;proguard&apos;.length(), task.name.lastIndexOf(task.name.endsWith(&apos;Debug&apos;) ? &quot;Debug&quot; : &quot;Release&quot;));
        generateMainIndexKeepList(flavor.toLowerCase());
    }
} else if (task.name.startsWith(&apos;zipalign&apos;) &amp;&amp; (task.name.endsWith(&apos;Debug&apos;) || task.name.endsWith(&apos;Release&apos;))) {
    task.doFirst {
        ensureMultiDexInApk();
    }
}
</code></pre><p>}<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- dex 类分包规则</span><br><span class="line"> 把 Service、Receiver、Provider 涉及到的代码都放到主 dex 中，而把 Activity 涉及到的代码进行了一定的拆分，把首页 Activity、Laucher Activity 、欢迎页的 Activity 、城市列表页 Activity 等所依赖的 class 放到了主 dex 中，把二级、三级页面的 Activity 以及业务频道的代码放到了第二个 dex 中，为了减少人工分析 class 的依赖所带了的不可维护性和高风险性，美团编写了一个能够自动分析 class 依赖的脚本， 从而能够保证主 dex 包含 class 以及他们所依赖的所有 class 都在其内，这样这个脚本就会在打包之前自动分析出启动到主 dex 所涉及的所有代码，保证主 dex 运行正常。</span><br><span class="line">- 加载 dex 的方式</span><br><span class="line"> 通过分析 Activity 的启动过程，发现 Activity 是由 ActivityThread 通过 Instrumentation 来启动的，那么是否可以在 Instrumentation 中做一定的手脚呢？通过分析代码 ActivityThread 和 Instrumentation 发现，Instrumentation 有关 Activity 启动相关的方法大概有：execStartActivity、 newActivity 等等，这样就可以在这些方法中添加代码逻辑进行判断这个 class 是否加载了，如果加载则直接启动这个 Activity，如果没有加载完成则启动一个等待的 Activity 显示给用户，然后在这个 Activity 中等待后台第二个 dex 加载完成，完成后自动跳转到用户实际要跳转的 Activity；这样在代码充分解耦合，以及每个业务代码能够做到颗粒化的前提下，就做到第二个 dex 的按需加载了。 </span><br><span class="line"></span><br><span class="line">美团的这种方式对主 dex 的要求非常高，因为第二个 dex 是等到需要的时候再去加载。重写Instrumentation 的 execStartActivity 方法，hook 跳转 Activity 的总入口做判断，如果当前第二个 dex 还没有加载完成，就弹一个 loading Activity等待加载完成。</span><br><span class="line"></span><br><span class="line">## 综合加载方案</span><br><span class="line">微信的方案需要将 dex 放于 assets 目录下，在打包的时候太过负责；Facebook 的方案每次进入都是开启一个 nodex 进程，而我们希望节省资源的同时快速打开 App；美团的方案确实很 hack，但是对于项目已经很庞大，耦合度又比较高的情况下并不适合。所以这里尝试结合三个方案，针对自己的项目来进行优化。</span><br><span class="line"></span><br><span class="line">- dex 形式</span><br><span class="line">第一，为了能够继续支持 Android 2.x 的机型，我们将每个包的方法数控制在 48000 个，这样最后分出来 dex 包大约在 5M 左右；第二，为了防止 NoClassDefFoundError 的情况，我们找出来启动页、引导页、首页比较在意的一些类，比如 Fragment 等（因为在生成 maindexlist.txt 的时候只会找 Activity 的直接引用，比如首页 Activity 直接引用 AFragemnt，但是 AFragment 的引用并没有去找）。</span><br><span class="line"></span><br><span class="line">- dex 类分包规则</span><br><span class="line">第一个包放 Application、Android四大组件以及启动页、引导页、首页的直接引用的 Fragment 的引用类，还放了推送消息过来点击 Notification 之后要展示的 Activity 中的 Fragment 的引用类。</span><br><span class="line">Fragment 的引用类是写了一个脚本，输入需要找的类然后将这些引用类写到 multidex.keep 文件中，如果是 debug 的就直接在生成的 jar 里面找，如果是 release 的话就通过 mapping.txt 找，找不到的话再去 jar 里面找，所以在 gradle 打包的过程中我们人为干扰一下：</span><br></pre></td></tr></table></figure></p>
<p>tasks.whenTaskAdded { task -&gt;<br>    if (task.name.startsWith(“create”) &amp;&amp; task.name.endsWith(“MainDexClassList”)) {<br>        task.doLast {<br>            def flavorAndBuildType = task.name.substring(“create”.length(), task.name.length() - “MainDexClassList”.length())<br>            autoSplitDex.configure {<br>                description = flavorAndBuildType<br>            }<br>            autoSplitDex.execute()<br>        }<br>    }<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">详细代码可见：Github — PhotoNoter/gradle</span><br><span class="line"></span><br><span class="line">- 加载 dex 的方式</span><br><span class="line">在防止 ANR 方面，我们采用了 Facebook 的思路。但是稍微有一点区别，差别在于我们并不在一开启 App 的时候就去起进程，而是一开启 App 的时候在主进程里面判断是否 dexopt 过没，没有的话再去起另外的进程的 Activity 专门做 dexopt 操作 。一旦拉起了去做 dexopt 的进程，那么让主进程进入一个死循环，一直等到 dexopt 进程结束再结束死循环往下走。那么问题来了，第一，主进程进入死循环会 ANR 吗？第二，如何判断是否 dexopt 过；第三，为了界面友好，dexopt 的进程该怎么做；第四，主进程怎么知道 dexopt 进程结束了，也就是怎么去做进程间通信。</span><br><span class="line"></span><br><span class="line"> - 一个一个问题的解决，先第一个：因为当拉起 dexopt 进程之后，我们在 dexopt 进程的 Activity 中进行 MultiDex.install() 操作，此时主进程不再是前台进程了，所以不会 ANR 。</span><br><span class="line"></span><br><span class="line"> - 第二个问题：因为第一次启动是什么数据都没有的，那么我们就建立一个 SharedPreference ，启动的时候先去从这里获取数据，如果没有数据那么也就是没有 dexopt 过，如果有数据那么肯定是 dexopt 过的，但是这个 SharedPreference 我们得保证我们的程序只有这个地方可以修改，其他地方不能修改。</span><br><span class="line"></span><br><span class="line"> - 第三个问题：因为 App 的启动也是一张图片，所以在 dexopt 的 Activity 的 layout 中，我们就把这张图片设置上去就好了，当关闭 dexopt 的 Activity 的时候，我们得关闭 Activity 的动画。同时为了不让 dexopt 进程发生 ANR ，我们将 MultiDex.install() 过程放在了子线程中进行。</span><br><span class="line"></span><br><span class="line"> - 第四个问题：Linux 的进程间通信的方式有很多，Android 中还有 Binder 等，那么我们这里采用哪种方式比较好呢？首先想到的是既然 dexopt 进程结束了自然在主进程的死循环中去判断 dexopt 进程是否存在。但是在实际操作中发现，dexopt 虽然已经退出了，但是进程并没有马上被回收掉，所以这个方法走不通。那么用 Broadcast 广播可以吗？可是可以，但是增加了 Application 的负担，在拉起 dexopt 进程前还得注册一个动态广播，接收到广播之后还得注销掉，所以这个也没有采用。那么最终采用的方式是判断文件是否存在，在拉起 dexopt 进程前在某个安全的地方建立一个临时文件，然后死循环判断这个文件是否存在，在 dexopt 进程结束的时候删除这个临时文件，那么在主进程的死循环中发现此文件不存在了，就直接跳出循环，继续 Application 初始化操作。</span><br></pre></td></tr></table></figure></p>
<p>public class NoteApplication extends Application {<br>@Override<br>    protected void attachBaseContext(Context base) {<br>        super.attachBaseContext(base);<br>        //开启dex进程的话也会进入application<br>        if (isDexProcess()) {<br>            return;<br>        }<br>        doInstallBeforeLollipop();<br>        MultiDex.install(this);<br>    }</p>
<pre><code>@Override
public void onCreate() {
    super.onCreate();
    if (isDexProcess()) {
        return;
    }
  //其他初始化
}
</code></pre><p>  private void doInstallBeforeLollipop() {<br>        //满足3个条件，1.第一次安装开启，2.主进程，3.API&lt;21(因为21之后ART的速度比dalvik快接近10倍(毕竟5.0之后的手机性能也要好很多))<br>        if (isAppFirstInstall() &amp;&amp; !isDexProcessOrOtherProcesses() &amp;&amp; Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP) {<br>            try {<br>                createTempFile();<br>                startDexProcess();<br>                while (true) {<br>                    if (existTempFile()) {<br>                        try {<br>                            Thread.sleep(50);<br>                        } catch (InterruptedException e) {<br>                            e.printStackTrace();<br>                        }<br>                    } else {<br>                        setAppNoteFirstInstall();<br>                        break;<br>                    }<br>                }<br>            } catch (IOException e) {<br>                e.printStackTrace();<br>            }<br>        }<br>    }<br>```<br>  详细代码可见：Github — PhotoNoter/NoteApplication</p>
<p>总的来说，这种方式好处在于依赖集非常简单，同时它的集成方式也是非常简单，我们无须去修改与加载无关的代码。但是当没有启动过 App 的时候，被推送全家桶唤醒或者收到了广播，虽然这里都是没有界面的过程，但是运用了这种加载方式的话会弹出 dexopt 进程的 Activity，用户看到会一脸懵比的。<br>推荐插件： <a href="https://github.com/TangXiaoLv/Android-Easy-MultiDex" target="_blank" rel="noopener">https://github.com/TangXiaoLv/Android-Easy-MultiDex</a></p>
<p>坑<br>Too many classes in –main-dex-list<br>UNEXPECTED TOP-LEVEL EXCEPTION:com.android.dex.DexException: Too many classes in –main-dex-list, main dex capacity exceeded at com.android.dx.command.dexer.Main.processAllFiles(Main.java:494) at com.android.dx.command.dexer.Main.runMultiDex(Main.java:332) at com.android.dx.command.dexer.Main.run(Main.java:243) at com.android.dx.command.dexer.Main.main(Main.java:214) at com.android.dx.command.Main.main(Main.java:106)</p>
<p>通过 sdk 的 mainDexClasses.rules 知道主 dex 里面会有 Application、Activity、Service、Receiver、Provider、Instrumentation、BackupAgent 和 Annotation。当这些类以及直接引用类比较多的时候，都要塞进主 dex ，就引发了 main dex capacity exceeded build error 。</p>
<p>为了解决这个问题，当执行 Create{flavor}{buildType}ManifestKeepList task 之前将其中的 activity 去掉，之后会发现 /build/intermediates/multi_dex/{flavor}/{buildType}/manifest_keep.txt 文件中已经没有 Activity 相关的类了。</p>
<p>def patchKeepSpecs() {<br>    def taskClass = “com.android.build.gradle.internal.tasks.multidex.CreateManifestKeepList”;<br>    def clazz = this.class.classLoader.loadClass(taskClass)<br>    def keepSpecsField = clazz.getDeclaredField(“KEEP_SPECS”)<br>    keepSpecsField.setAccessible(true)<br>    def keepSpecsMap = (Map) keepSpecsField.get(null)<br>    if (keepSpecsMap.remove(“activity”) != null) {<br>        println “KEEP_SPECS patched: removed ‘activity’ root”<br>    } else {<br>        println “Failed to patch KEEP_SPECS: no ‘activity’ root found”<br>    }<br>}</p>
<p>patchKeepSpecs()<br>详细可以看 CreateManifestKeepList 的源码：Github – CreateManifestKeepList</p>
<p>Too many classes in –main-dex-list<br>没错，还是 Too many classes in –main-dex-list 的错误。在美团的自动拆包中讲到：</p>
<p>实际应用中我们还遇到另外一个比较棘手的问题， 就是Field的过多的问题，Field过多是由我们目前采用的代码组织结构引入的，我们为了方便多业务线、多团队并发协作的情况下开发，我们采用的aar的方式进行开发，并同时在aar依赖链的最底层引入了一个通用业务aar，而这个通用业务aar中包含了很多资源，而ADT14以及更高的版本中对Library资源处理时，Library的R资源不再是static final的了，详情请查看google官方说明，这样在最终打包时Library中的R没法做到内联，这样带来了R field过多的情况，导致需要拆分多个Secondary DEX，为了解决这个问题我们采用的是在打包过程中利用脚本把Libray中R field（例如ID、Layout、Drawable等）的引用替换成常量，然后删去Library中R.class中的相应Field。</p>
<p>同样，hu关于这个问题可以参考这篇大神的文章：当Field邂逅65535 。</p>
<p>DexException: Library dex files are not supported in multi-dex mode<br>com.android.dex.DexException: Library dex files are not supported in multi-dex mode<br>​ at com.android.dx.command.dexer.Main.runMultiDex(Main.java:322)<br>​ at com.android.dx.command.dexer.Main.run(Main.java:228)<br>​ at com.android.dx.command.dexer.Main.main(Main.java:199)<br>​ at com.android.dx.command.Main.main(Main.java:103)</p>
<p>解决：</p>
<p>android {<br>    dexOptions {<br>        preDexLibraries = false<br>    }<br>}<br>OutOfMemoryError: Java heap space<br>UNEXPECTED TOP-LEVEL ERROR:<br>​ java.lang.OutOfMemoryError: Java heap space</p>
<p>解决：</p>
<p>android {<br>    dexOptions {<br>        javaMaxHeapSize “2g”<br>    }<br>}</p>
<h3 id="Android-分包之旅技术分享疑难解答"><a href="#Android-分包之旅技术分享疑难解答" class="headerlink" title="Android 分包之旅技术分享疑难解答"></a>Android 分包之旅技术分享疑难解答</h3><p>Q1：Facebook mutidex 方案为何要多起一个进程，如果采用单进程 线程去处理呢？<br>答：install能不能放到线程里做？如果开新线程加载，而主线程继续Application初始化—-——导致如果异步化，multidex安装没有结束意味着dex还没加载进来，这时候如果进程需要seconday.dex里的classes信息不就悲剧了—-某些类强行使用就会报NoClassDefFoundError.<br>FaceBook多dex分包方案<br>安装完成之后第一次启动时，是secondary.dex的dexopt花费了更多的时间，认识到这点非常重要，使得问题转化为：在不阻塞UI线程的前提下，完成dexopt，以后都不需要再次dexopt，所以可以在UI线程install dex了<br>我们现在想做到的是：既希望在Application的attachContext（）方法里同步加载secondary.dex，又不希望卡住UI线程<br>FB的方案就是：<br>让Launcher Activity在另外一个进程启动，但是Multidex.install还是在Main Process中开启，虽然逻辑上已经不承担dexopt的任务<br>这个Launcher Activity就是用来异步触发dexopt的 ，load完成就启动Main Activity；如果已经loaded，则直接启动Main Process<br>Multidex.install所引发的合并耗时操作，是在前台进程的异步任务中执行的，所以没有anr的风险</p>
<p>Q2：当没有启动过 App 的时候，被推送全家桶唤醒或者收到了广播（App已经处于不是第一次启动过）<br>会唤醒，而且会出现dexopt的独立进程页面activity，一闪而过用户会懵逼…<br>改进采用新的思路会唤起新进程，但是该进程只会触发一次…<br>如何保证只触发一次？ 我们先判断是否第一次安装启动应用，当应用不是第一次安装启动时，我们直接启动闪屏页，并且结束掉子进程即可。</p>
<p>Q3:处于第一次安装成功之后，app收到推送全家桶是否会被唤醒？<br>不会，因为需要首次在application执行过一次推送的init代码才会被唤醒<br>Q4:最终方案？<br>示例代码参考 :</p>
<ul>
<li><a href="https://github.com/yuyang272999712/NewFeaturesTest/blob/master/app/src/main/java/com/yuyang/fitsystemwindowstestdrawer/MyApplication.java" target="_blank" rel="noopener">https://github.com/yuyang272999712/NewFeaturesTest/blob/master/app/src/main/java/com/yuyang/fitsystemwindowstestdrawer/MyApplication.java</a><br>方案思路参考：</li>
<li><a href="https://www.jianshu.com/p/9072ca9718ce" target="_blank" rel="noopener">https://www.jianshu.com/p/9072ca9718ce</a></li>
<li><a href="https://juejin.im/entry/5a7807926fb9a063517250b1" target="_blank" rel="noopener">https://juejin.im/entry/5a7807926fb9a063517250b1</a></li>
</ul>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/10/CommonUtils/" itemprop="url">
                  Android工具类常用的几种方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-10T20:17:30+08:00" content="2017-10-10">
              2017-10-10
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-安装应用APK"><a href="#1-安装应用APK" class="headerlink" title="1.安装应用APK"></a>1.安装应用APK</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> private void installApk(String apkFilePath) &#123;</span><br><span class="line">        File apkfile = new File(apkFilePath);        </span><br><span class="line">        <span class="keyword">if</span> (!apkfile.exists()) &#123;            </span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Intent i = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        i.setDataAndType(Uri.parse(<span class="string">"file://"</span> + apkfile.toString()), <span class="string">"application/vnd.android.package-archive"</span>);</span><br><span class="line">        startActivity(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-MD5算法"><a href="#2-MD5算法" class="headerlink" title="2. MD5算法"></a>2. MD5算法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public final static String MD5(String s) &#123;        </span><br><span class="line">            char hexDigits[] = &#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>&#125;;        </span><br><span class="line">            try &#123;            </span><br><span class="line">            byte[] btInput = s.getBytes();          // 获得MD5摘要算法的 MessageDigest 对象</span><br><span class="line">            MessageDigest mdInst = MessageDigest.getInstance(<span class="string">"MD5"</span>);  // 使用指定的字节更新摘要</span><br><span class="line">            mdInst.update(btInput);                 // 获得密文</span><br><span class="line">            byte[] md = mdInst.digest();            // 把密文转换成十六进制的字符串形式</span><br><span class="line">            int j = md.length;            </span><br><span class="line">            char str[] = new char[j * 2];            </span><br><span class="line">            int k = 0;            //把字节转换成对应的字符串</span><br><span class="line">            <span class="keyword">for</span> (int i = 0; i &lt; j; i++) &#123;                </span><br><span class="line">                byte byte0 = md[i];</span><br><span class="line">                str[k++] = hexDigits[byte0 &gt;&gt;&gt; 4 &amp; 0xf];</span><br><span class="line">                str[k++] = hexDigits[byte0 &amp; 0xf];</span><br><span class="line">            &#125;           </span><br><span class="line">                 <span class="built_in">return</span> new String(str);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();            </span><br><span class="line">                 <span class="built_in">return</span> null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-判断现在是否有网络"><a href="#3-判断现在是否有网络" class="headerlink" title="3. 判断现在是否有网络"></a>3. 判断现在是否有网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">private boolean <span class="function"><span class="title">NetWorkStatus</span></span>() &#123;</span><br><span class="line">        ConnectivityManager cwjManager = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line"></span><br><span class="line">        cwjManager.getActiveNetworkInfo();        </span><br><span class="line">        boolean netSataus = <span class="literal">true</span>;        </span><br><span class="line">        <span class="keyword">if</span> (cwjManager.getActiveNetworkInfo() != null) &#123;</span><br><span class="line"></span><br><span class="line">        netSataus = cwjManager.getActiveNetworkInfo().isAvailable();</span><br><span class="line"></span><br><span class="line">        Toast.makeText(this, <span class="string">"网络已经打开"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Builder b = new AlertDialog.Builder(this).setTitle(<span class="string">"没有可用的网络"</span>)</span><br><span class="line">                                        .setMessage(<span class="string">"是否对网络进行设置？"</span>);</span><br><span class="line">        b.setPositiveButton(<span class="string">"是"</span>, new DialogInterface.OnClickListener() </span><br><span class="line">        &#123;    </span><br><span class="line">                public void onClick(DialogInterface dialog, int whichButton) &#123;</span><br><span class="line">                Intent mIntent = new Intent(<span class="string">"/"</span>);</span><br><span class="line">                ComponentName comp = new ComponentName( <span class="string">"com.android.settings"</span>, <span class="string">"com.android.settings.WirelessSettings"</span>);</span><br><span class="line">                mIntent.setComponent(comp);</span><br><span class="line">                mIntent.setAction(<span class="string">"android.intent.action.VIEW"</span>);</span><br><span class="line">                startActivityForResult(mIntent,0); </span><br><span class="line">                &#125;</span><br><span class="line">                &#125;).setNeutralButton(<span class="string">"否"</span>, new DialogInterface.<span class="function"><span class="title">OnClickListener</span></span>() &#123;                        </span><br><span class="line">                public void onClick(DialogInterface dialog, int whichButton) &#123;</span><br><span class="line">                        dialog.cancel();</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;).show();</span><br><span class="line">                &#125;                </span><br><span class="line">                <span class="built_in">return</span> netSataus;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-获取设备屏幕的宽度高度密度"><a href="#4-获取设备屏幕的宽度高度密度" class="headerlink" title="4. 获取设备屏幕的宽度高度密度"></a>4. 获取设备屏幕的宽度高度密度</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public  class   DisplayUtil &#123; </span><br><span class="line">     /**</span><br><span class="line">     * 得到设备屏幕的宽度</span><br><span class="line">     */</span><br><span class="line">    public static int getScreenWidth(Context context) &#123;        </span><br><span class="line">        <span class="built_in">return</span> context.getResources().getDisplayMetrics().widthPixels;</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 得到设备屏幕的高度</span><br><span class="line">     */</span><br><span class="line">    public static int getScreenHeight(Context context) &#123;        </span><br><span class="line">        <span class="built_in">return</span> context.getResources().getDisplayMetrics().heightPixels;</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 得到设备的密度</span><br><span class="line">     */</span><br><span class="line">    public static <span class="built_in">float</span> getScreenDensity(Context context) &#123;        </span><br><span class="line">        <span class="built_in">return</span> context.getResources().getDisplayMetrics().density;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-dp、sp-转换为-px-的工具类"><a href="#5-dp、sp-转换为-px-的工具类" class="headerlink" title="5. dp、sp 转换为 px 的工具类"></a>5. dp、sp 转换为 px 的工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public  class  DisplayUtil &#123;          </span><br><span class="line">    /**</span><br><span class="line">     * 将px值转换为dip或dp值，保证尺寸大小不变</span><br><span class="line">     */</span><br><span class="line">    public static int px2dip(Context context, <span class="built_in">float</span> pxValue) &#123;        </span><br><span class="line">		final <span class="built_in">float</span> scale = context.getResources().getDisplayMetrics().density;        </span><br><span class="line">		<span class="built_in">return</span> (int) (pxValue / scale + 0.5f);</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 将dip或dp值转换为px值，保证尺寸大小不变</span><br><span class="line">     * </span><br><span class="line">     * @param dipValue</span><br><span class="line">     * @param scale</span><br><span class="line">     *            （DisplayMetrics类中属性density）</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static int dip2px(Context context, <span class="built_in">float</span> dipValue) &#123;        </span><br><span class="line">        final <span class="built_in">float</span> scale = context.getResources().getDisplayMetrics().density;        </span><br><span class="line">        <span class="built_in">return</span> (int) (dipValue * scale + 0.5f);</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 将px值转换为sp值，保证文字大小不变</span><br><span class="line">     * </span><br><span class="line">     * @param pxValue</span><br><span class="line">     * @param fontScale</span><br><span class="line">     *            （DisplayMetrics类中属性scaledDensity）</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static int px2sp(Context context, <span class="built_in">float</span> pxValue) &#123;        </span><br><span class="line">        final <span class="built_in">float</span> fontScale = context.getResources().getDisplayMetrics().scaledDensity;        </span><br><span class="line">        <span class="built_in">return</span> (int) (pxValue / fontScale + 0.5f);</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 将sp值转换为px值，保证文字大小不变</span><br><span class="line">     * </span><br><span class="line">     * @param spValue</span><br><span class="line">     * @param fontScale</span><br><span class="line">     *            （DisplayMetrics类中属性scaledDensity）</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static int sp2px(Context context, <span class="built_in">float</span> spValue) &#123;        </span><br><span class="line">        final <span class="built_in">float</span> fontScale = context.getResources().getDisplayMetrics().scaledDensity;        </span><br><span class="line">        <span class="built_in">return</span> (int) (spValue * fontScale + 0.5f);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-drawable转bitmap的工具类"><a href="#6-drawable转bitmap的工具类" class="headerlink" title="6.drawable转bitmap的工具类"></a>6.drawable转bitmap的工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * drawable转bitmap</span><br><span class="line"> *</span><br><span class="line"> * @param drawable</span><br><span class="line"> * @<span class="built_in">return</span></span><br><span class="line">*/</span><br><span class="line">private Bitmap drawableToBitamp(Drawable drawable) &#123;    </span><br><span class="line">       <span class="keyword">if</span> (null == drawable) &#123;        </span><br><span class="line">       <span class="built_in">return</span> null;</span><br><span class="line">       &#125;<span class="keyword">if</span> (drawable instanceof BitmapDrawable) &#123;</span><br><span class="line">       BitmapDrawable bd = (BitmapDrawable) drawable;        </span><br><span class="line">       <span class="built_in">return</span> bd.getBitmap();</span><br><span class="line">   &#125;    </span><br><span class="line">       int w = drawable.getIntrinsicWidth();    </span><br><span class="line">       int h = drawable.getIntrinsicHeight();</span><br><span class="line">       Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);</span><br><span class="line">       Canvas canvas = new Canvas(bitmap);</span><br><span class="line">       drawable.setBounds(0, 0, w, h);</span><br><span class="line">       drawable.draw(canvas);    </span><br><span class="line">       <span class="built_in">return</span> bitmap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-文章发布模仿朋友圈时间显示"><a href="#7-文章发布模仿朋友圈时间显示" class="headerlink" title="7.文章发布模仿朋友圈时间显示"></a>7.文章发布模仿朋友圈时间显示</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">public static String ChangeTime(Date time) &#123;</span><br><span class="line">        String ftime = <span class="string">""</span>;</span><br><span class="line">        Calendar cal = Calendar.getInstance();        // 判断是否是同一天</span><br><span class="line">        String curDate = dateFormater2.get().format(cal.getTime());</span><br><span class="line">        String paramDate = dateFormater2.get().format(time);        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (curDate.equals(paramDate)) &#123;            </span><br><span class="line"></span><br><span class="line">    int hour = (int) ((cal.getTimeInMillis() - time.getTime()) / 3600000);            </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hour == 0)</span><br><span class="line">                ftime = Math.max(</span><br><span class="line">                        (cal.getTimeInMillis() - time.getTime()) / 60000, 1)</span><br><span class="line">                        + <span class="string">"分钟前"</span>;            </span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                ftime = hour + <span class="string">"小时前"</span>;            </span><br><span class="line"></span><br><span class="line">            <span class="built_in">return</span> ftime;</span><br><span class="line">        &#125;        long lt = time.getTime() / 86400000;        </span><br><span class="line"></span><br><span class="line">            long ct = cal.getTimeInMillis() / 86400000;        </span><br><span class="line"></span><br><span class="line">            int days = (int) (ct - lt);        </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (days == 0) &#123;            </span><br><span class="line"></span><br><span class="line">            int hour = (int) ((cal.getTimeInMillis() - time.getTime()) / 3600000);            </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (hour == 0)</span><br><span class="line">            ftime = Math.max( (cal.getTimeInMillis() - time.getTime()) / 60000, 1)</span><br><span class="line">                        + <span class="string">"分钟前"</span>;           </span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                ftime = hour + <span class="string">"小时前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days == 1) &#123;</span><br><span class="line">            ftime = <span class="string">"昨天"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days == 2) &#123;</span><br><span class="line">            ftime = <span class="string">"前天 "</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 2 &amp;&amp; days &lt; 31) &#123;</span><br><span class="line">            ftime = days + <span class="string">"天前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt;= 31 &amp;&amp; days &lt;= 2 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"一个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 2 * 31 &amp;&amp; days &lt;= 3 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"2个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 3 * 31 &amp;&amp; days &lt;= 4 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"3个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ftime = dateFormater2.get().format(time);</span><br><span class="line">        &#125;        <span class="built_in">return</span> ftime;</span><br><span class="line">    &#125;    public static String friendly_time(String sdate) &#123;</span><br><span class="line">        Date time = null;        </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (TimeZoneUtil.isInEasternEightZones())</span><br><span class="line">            time = toDate(sdate);        <span class="keyword">else</span></span><br><span class="line">            time = TimeZoneUtil.transformTime(toDate(sdate),</span><br><span class="line">                    TimeZone.getTimeZone(<span class="string">"GMT+08"</span>), TimeZone.getDefault());        </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (time == null) &#123;            </span><br><span class="line"></span><br><span class="line">            <span class="built_in">return</span> <span class="string">"Unknown"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String ftime = <span class="string">""</span>;</span><br><span class="line">        Calendar cal = Calendar.getInstance();        // 判断是否是同一天</span><br><span class="line">        String curDate = dateFormater2.get().format(cal.getTime());</span><br><span class="line">        String paramDate = dateFormater2.get().format(time);        </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (curDate.equals(paramDate)) &#123;            </span><br><span class="line"></span><br><span class="line">            int hour = (int) ((cal.getTimeInMillis() - time.getTime()) / 3600000);            </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (hour == 0)</span><br><span class="line">                ftime = Math.max(</span><br><span class="line">                        (cal.getTimeInMillis() - time.getTime()) / 60000, 1)</span><br><span class="line">                        + <span class="string">"分钟前"</span>;           </span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                ftime = hour + <span class="string">"小时前"</span>;            </span><br><span class="line"></span><br><span class="line">             <span class="built_in">return</span> ftime;</span><br><span class="line">        &#125;        long lt = time.getTime() / 86400000;        </span><br><span class="line"></span><br><span class="line">             long ct = cal.getTimeInMillis() / 86400000;        </span><br><span class="line"></span><br><span class="line">             int days = (int) (ct - lt);        </span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (days == 0) &#123;            </span><br><span class="line"></span><br><span class="line">             int hour = (int) ((cal.getTimeInMillis() - time.getTime()) / 3600000);            </span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (hour == 0)</span><br><span class="line">                ftime = Math.max(</span><br><span class="line">                        (cal.getTimeInMillis() - time.getTime()) / 60000, 1)</span><br><span class="line">                        + <span class="string">"分钟前"</span>;           </span><br><span class="line"></span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                ftime = hour + <span class="string">"小时前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days == 1) &#123;</span><br><span class="line">            ftime = <span class="string">"昨天"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days == 2) &#123;</span><br><span class="line">            ftime = <span class="string">"前天 "</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 2 &amp;&amp; days &lt; 31) &#123;</span><br><span class="line">            ftime = days + <span class="string">"天前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt;= 31 &amp;&amp; days &lt;= 2 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"一个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 2 * 31 &amp;&amp; days &lt;= 3 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"2个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 3 * 31 &amp;&amp; days &lt;= 4 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"3个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ftime = dateFormater2.get().format(time);</span><br><span class="line">        &#125;        <span class="built_in">return</span> ftime;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-时间格式转换工具类"><a href="#8-时间格式转换工具类" class="headerlink" title="8.时间格式转换工具类"></a>8.时间格式转换工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static String ConverToString(Date date) &#123;</span><br><span class="line">        DateFormat df = new SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);        </span><br><span class="line">        <span class="built_in">return</span> df.format(date);</span><br><span class="line">    &#125;    </span><br><span class="line">        public static String ConverToString2(Date date)&#123;</span><br><span class="line">        DateFormat df = new SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm"</span>);        </span><br><span class="line">        <span class="built_in">return</span> df.format(date);</span><br><span class="line">    &#125;    </span><br><span class="line">        public static String ConverToString3(Date date)&#123;</span><br><span class="line">        DateFormat df = new SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);        </span><br><span class="line">        <span class="built_in">return</span> df.format(date);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-验证码倒计时工具类"><a href="#9-验证码倒计时工具类" class="headerlink" title="9.验证码倒计时工具类"></a>9.验证码倒计时工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">	public class TimeCount extends CountDownTimer &#123;    </span><br><span class="line">    private Button button;    /**</span><br><span class="line">     * 到计时</span><br><span class="line">     * @param millisInFuture  到计时多久,毫秒</span><br><span class="line">     * @param countDownInterval 周期</span><br><span class="line">     * @param button   按钮</span><br><span class="line">     */</span><br><span class="line">    public TimeCount(long millisInFuture, long countDownInterval,Button button) &#123;        </span><br><span class="line">    super(millisInFuture, countDownInterval);        </span><br><span class="line">    this.button =button;</span><br><span class="line">    &#125;    </span><br><span class="line">    public TimeCount(long millisInFuture, long countDownInterval) &#123;        </span><br><span class="line">    super(millisInFuture, countDownInterval);</span><br><span class="line">    &#125;    </span><br><span class="line">    @Override</span><br><span class="line">    public void <span class="function"><span class="title">onFinish</span></span>() &#123;// 计时完毕</span><br><span class="line">        button.setText(<span class="string">"获取验证码"</span>);</span><br><span class="line">        button.setClickable(<span class="literal">true</span>);</span><br><span class="line">        button.setBackground(MyApplication.getContext().getResources().getDrawable(R.drawable.radius14));</span><br><span class="line">    &#125;   </span><br><span class="line">     @Override</span><br><span class="line">    public void onTick(long millisUntilFinished) &#123;// 计时过程</span><br><span class="line">        button.setClickable(<span class="literal">false</span>);//防止重复点击</span><br><span class="line">        button.setText(millisUntilFinished / 1000 + <span class="string">"s后重试"</span>);</span><br><span class="line">        button.setBackground(MyApplication.getContext().getResources().getDrawable(R.drawable.radius_gray));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-屏幕截图工具类"><a href="#10-屏幕截图工具类" class="headerlink" title="10.屏幕截图工具类"></a>10.屏幕截图工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">	public class ScreenShot &#123;</span><br><span class="line">	    </span><br><span class="line">	public static void shoot(Activity a, File filePath) &#123;        </span><br><span class="line">    <span class="keyword">if</span> (filePath == null) &#123;            </span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">        &#125;        </span><br><span class="line">    <span class="keyword">if</span> (!filePath.getParentFile().exists()) &#123;</span><br><span class="line">            filePath.getParentFile().mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        FileOutputStream fos = null;        </span><br><span class="line">    try &#123;</span><br><span class="line">            fos = new FileOutputStream(filePath);            </span><br><span class="line">    <span class="keyword">if</span> (null != fos) &#123;</span><br><span class="line">                takeScreenShot(a).compress(Bitmap.CompressFormat.PNG, 100, fos);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;            </span><br><span class="line">    <span class="keyword">if</span> (fos != null) &#123;                </span><br><span class="line">    try &#123;</span><br><span class="line">                    fos.flush();</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    private static Bitmap takeScreenShot(Activity activity) &#123;</span><br><span class="line">        View view = activity.getWindow().getDecorView();</span><br><span class="line">        view.setDrawingCacheEnabled(<span class="literal">true</span>);</span><br><span class="line">        view.buildDrawingCache();</span><br><span class="line">        Bitmap bitmap = view.getDrawingCache();</span><br><span class="line">        Rect frame = new Rect();</span><br><span class="line">        activity.getWindow().getDecorView().getWindowVisibleDisplayFrame(frame);        </span><br><span class="line">        int statusBarHeight = frame.top;        </span><br><span class="line">        int width = activity.getWindowManager().getDefaultDisplay().getWidth();        </span><br><span class="line">        int height = activity.getWindowManager().getDefaultDisplay()</span><br><span class="line">                .getHeight();        //去掉标题栏</span><br><span class="line">        Bitmap b = Bitmap.createBitmap(bitmap, 0, statusBarHeight, width,</span><br><span class="line">                height - statusBarHeight);</span><br><span class="line">        view.destroyDrawingCache();        </span><br><span class="line">        <span class="built_in">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/06/job/" itemprop="url">
                  2017年Android曲折的求职之路
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-06T18:12:35+08:00" content="2017-06-06">
              2017-06-06
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="本人近况"><a href="#本人近况" class="headerlink" title="本人近况"></a>本人近况</h1><p>先说下博主最近近况，5月底毅然离职没想到目前市场这么萧条，怪自己太作，有好的机会不好好把握，非得出来受虐哈，人都是犯贱的……所以目前整理几家去过的公司以免以后被坑。</p>
<h2 id="金开门（好贷网旗下孵化创业公司）"><a href="#金开门（好贷网旗下孵化创业公司）" class="headerlink" title="金开门（好贷网旗下孵化创业公司）"></a>金开门（好贷网旗下孵化创业公司）</h2><blockquote>
<p>这公司是在BOSS直聘上投的<br>总体面试还算不错吧Android技术那面一般也不会问特别深主要是最新的主流技术一般会问下，还有就是之前的项目会大致问一下<br>接下来是总监面，总监是个蛮不错的人，满有亲和力的，大概就是聊推送这一块的，还有支付，因为这公司主要业务是聚合支付相关的，总体还OK<br>接着是HR 谈薪水还有介绍公司近况，貌似最近一直是995的节奏<br>最后是大Boss面貌似很屌的说了一句目前我们就是996的节奏（应该是试探我的），我觉得跟他也没啥好谈，他一幅咄咄逼人的气势，由于他比较强势，我又不妥协，所以就没有后续了…</p>
</blockquote>
<h2 id="音悦台"><a href="#音悦台" class="headerlink" title="音悦台"></a>音悦台</h2><blockquote>
<p>这个也是在Boss直聘上约的，公司就在三里屯SOHO<br>公司主要业务主打MV的剩下的我就不多说了，前几年业务还是挺火的</p>
<p>HR人还是很不错的，公司的环境神马的都没得说，妹子也多╮(╯_╰)╭没给offer确实感觉挺遗憾的</p>
<p>首先光技术面问的就蛮深入的，基本最近貌似招人都比较苛刻~多线程，线程池，handler，Looper源码层，activity源码，四种启动模式，生命周期，View的绘制流程，自定义view，手势传递问的最复杂也最多<br>还有一些开源项目相关的问题吧 okhttp，glide，eventbus相关的</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">但是特么的这个面完之后就没有然后了，估计是薪资没谈拢？</span><br><span class="line">只说按公司流程来说还要有次复试，</span><br><span class="line">HR说下周一大概会通知结果，也确实通知了（比较少有的有职业素质的公司吧）</span><br></pre></td></tr></table></figure>
<h2 id="1905电影网"><a href="#1905电影网" class="headerlink" title="1905电影网"></a>1905电影网</h2><blockquote>
<p>这个是在拉勾上投的，公司在西直门<br>我敢说这个面试官是这么多年我遇到的最能装逼一个，当然人家技术也蛮不错的，你不会的，遇到问题的，人家也耐心给你讲解哟，无形装逼，最为致命啊！如果你技术不是很好的话千万不要去这家公司找虐</p>
<p>博主之前有个朋友也来过这家面试，貌似最后给说开不了他的工资，还跟他说来面试很多<br>给我种感觉 就是面试造核弹，工作拧螺丝？最后还问了我项目里有啥亮点<br>问题蛮多的好多都忘了，大致记住几个</p>
</blockquote>
<p>Glide ，Picasso都分别有几个线程池<br>Asynctask 源码，为什么android4.0以后是串行</p>
<p>OnMeasure 方法几个参数对应含义（这个题问的最多的所以我把答案贴上O(∩_∩)O~</p>
<p>首先我们要理解的是widthMeasureSpec, heightMeasureSpec这两个参数是从哪里来的？onMeasure()函数由包含这个View的具体的ViewGroup调用，因此值也是从这个ViewGroup中传入的。这里我直接给出答案：子类View的这两个参数，由ViewGroup中的layout_width，layout_height和padding以及View自身的layout_margin共同决定。权值weight也是尤其需要考虑的因素，有它的存在情况可能会稍微复杂点。<br>了解了这两个参数的来源，还要知道这两个值的作用。我们只取heightMeasureSpec作说明。这个值由高32位和低16位组成，高32位保存的值叫specMode，可以通过如代码中所示的MeasureSpec.getMode()获取；低16位为specSize，同样可以由MeasureSpec.getSize()获取。那么specMode和specSize的作用有是什么呢？要想知道这一点，我们需要知道代码中的最后一行，所有的View的onMeasure()的最后一行都会调用setMeasureDimension()函数的作用——这个函数调用中传进去的值是View最终的视图大小。也就是说onMeasure()中之前所作的所有工作都是为了最后这一句话服务的。</p>
<p>我们知道在ViewGroup中，给View分配的空间大小并不是确定的，有可能随着具体的变化而变化，而这个变化的条件就是传到specMode中决定的，specMode一共有三种可能：</p>
<p>MeasureSpec.EXACTLY：父视图希望子视图的大小应该是specSize中指定的。</p>
<p>MeasureSpec.AT_MOST：子视图的大小最多是specSize中指定的值，也就是说不建议子视图的大小超过specSize中给定的值。</p>
<p>MeasureSpec.UNSPECIFIED：我们可以随意指定视图的大小。)</p>
<p>广播怎么不跨进程<br>Rxjava 操作符<br>Rxjava 1 2的区别<br>还有问了轮播怎么让用户按下三秒之后继续翻页<br>还有五种进程级别<br>多线程下载，3个线程如何下载10M的文件<br>两列Recyclerview 如果是表格布局怎么添加header view<br>Thread 和intent service </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">最牛B的一个问题是类似天猫这种大厂APP实现的全局应用代理是怎么实现的</span><br><span class="line">（本意就是类似于推送的时候处理推送的逻辑不写一大堆switch case，而是在入口处动态去配置就可以）</span><br></pre></td></tr></table></figure>
<h2 id="凡普金科（普惠金融旗下）"><a href="#凡普金科（普惠金融旗下）" class="headerlink" title="凡普金科（普惠金融旗下）"></a>凡普金科（普惠金融旗下）</h2><blockquote>
<p>这个是在拉勾上投的，公司在银河SOHO<br>当时面试地点其实是发的有问题的，前台大门明明在A座嘛，你非得发个D座那边的位置，结果那边的门锁了，我敲了半天才有人开，我才知道走错门了应该从A座的电梯上来，可是就是发的D座，这里吐槽下。。。然后前台妹子给我的笔试题居然是Java的（貌似给错了）</p>
<p>面试的深度基本跟1905那哥们差不多，也是activity启动模式跟手势传递还有Looper的源码那块问的比较多只是这个人最后问了一个尺子的效果：附上项目地址哈<br><a href="https://github.com/kailaisi/WheelSelect" target="_blank" rel="noopener">https://github.com/kailaisi/WheelSelect</a><br>类似这个地址demo的实现效果只是年龄换成了金额（毕竟是做金融的公司 当然这样咯）</p>
<p>只说还有复试，但是也是没下文了 ~~o(&gt;_&lt;)o ~~</p>
</blockquote>
<h2 id="映社（木蚂蚁）"><a href="#映社（木蚂蚁）" class="headerlink" title="映社（木蚂蚁）"></a>映社（木蚂蚁）</h2><blockquote>
<p>这个公司绝对是坑比中的战斗机，去了就让你一直等啊等，等到花都谢了的那种<br>PS：他们现在的项目主要是做直播的产品叫“映社”（有种抄袭映客的嫌疑~~）<br>去的时候公司前台都没人，打电话也没人接，后来一个快递小哥进门了我和另外的一个也是面试的才进去</p>
<p>首先是有笔试题的话说蛮弱智的（做完感觉也不会怎么看，完全就是浪费时间啊啊）然后那哥们把你领到一个类似小会议室的屋子里，这哥们给人的感觉技术也很一般，没有之前面的那么强势，基本都是照着简历问的，问直播跟FFmpeg那块偏多，贝塞尔曲线？自定义View，偶尔穿插下retrofit，Rxjava，热修复神马的，面完之后就出去了让你一直等啊等，等了快40分钟的时候进来说总监在开会<br>这个公司真特么的是个奇葩，你约人的时候不会挑个没会的时间么，貌似拉勾上有个面php的哥们跟我一样也是被搁置一直等啊等，真是日了狗了！最后来了一句改天复试吧</p>
<p>只说还有复试，让我来我也不会来了。。。</p>
</blockquote>
<h2 id="Melons-北京知行远科技"><a href="#Melons-北京知行远科技" class="headerlink" title="Melons(北京知行远科技)"></a>Melons(北京知行远科技)</h2><blockquote>
<p>这家公司是我在拉勾上投的，公司成立于2016年太初创了（我能怎么办，我也很绝望啊，貌似最近拉勾的公司比较少，稀里糊涂就投了╮(╯▽╰)╭）<br>Boss也是做android的，而且还是前最美应用的联合创始人，技术出身还是蛮不错的公司早10晚8做海外项目</p>
<p>但是目前的状况是跟别人挤在一间办公室里，那个隔壁组的貌似是Google天气的团队。。。</p>
<p>技术面还是跟之前的那几家差不多，基本都不会看你做过的项目就咔咔的问底层源码咯，唯一不同的是启动模式那块多问了taskAffinity这个属性，我确实是没用过，面试官拿着macbook一个一个的循序渐进的问着，面试流程大概一个半小时左右，然后跟boss聊了聊薪资和之前为什么离职，因为是早上十点半约的，一直聊到了中午12点40多</p>
<p>我中午饭都没吃，然后紧接着就去中关村准备下午那家的面试</p>
<p>PS:今天还下着雨，挺苦逼的。。。</p>
<p>目测不会发offer，可能是小公司给不起薪资。。。</p>
</blockquote>
<h2 id="NewsDog-公司名字就叫这个薪资标的还挺高"><a href="#NewsDog-公司名字就叫这个薪资标的还挺高" class="headerlink" title="NewsDog(公司名字就叫这个薪资标的还挺高)"></a>NewsDog(公司名字就叫这个薪资标的还挺高)</h2><blockquote>
<p>这家公司是我在拉勾上投的，公司应该是B轮了已经<br>因为是约的是下午两点，而且刚从Melons那里面完就来了，所以去这家公司的时候连中午饭都没吃，让前台给接了杯水暂时压压惊。。。</p>
<p>看简介公司应该是做海外市场主要是信息推荐跟数据挖掘的业务（不知道他们现在的产品是啥）</p>
<p>技术面主要是根据简历去问的，比较在意内存泄漏，内存优化还有View的过渡绘制这一块的东西，还有就是问了问图片开源库Picasso v/s Imageloader v/s Fresco vs Glide 区别以及如何去选择吧，还有eventbus的源码以及注解的优点，其它的大概就是还问了问项目的难点之类的</p>
<p>比较操蛋的是没有讨论薪资，然后就直接送客了，不造差在哪里。。。</p>
</blockquote>
<h2 id="曙光无限"><a href="#曙光无限" class="headerlink" title="曙光无限"></a>曙光无限</h2><p><strong>曙光无限</strong>这家公司是在boss上约的，公司地址在回龙观东大街的腾讯众创空间（办公楼的环境蛮好的），公司主打产品是海外的项目，旗下产品几十种还是蛮多的</p>
<ul>
<li><strong>第一面</strong> ：只是人事先照着简历初略的聊了聊以前的项目经验，由于公司是做海外滤镜软件的，可能对图片算法这块要求蛮高的，福利这块目前是采取接近避税的方式，第一年还不给交住房公积金，貌似还需要第二面总监面，而且还要上机写demo…</li>
<li><strong>目前android行情</strong> ：从以往的面试分析来看基本android的行情接近饱和状态，薪资这块基本稍微要高点的话直接就给你pass然后可能用其它人候选人去对比，市场的行情还真是惨淡</li>
<li><strong>后续</strong> ：没有通知进一步的面试~~~~ HR先面的公司一般都会要求复试各位如果考虑时间成本的话要慎重去这种公司。。。。</li>
</ul>
<hr>
<h2 id="遇见科技"><a href="#遇见科技" class="headerlink" title="遇见科技"></a>遇见科技</h2><p><strong>遇见科技</strong>这家公司是在boss上约的，公司地址在知春路附近，公司的办公环境也还不错哈，项目应该是一款社交软件，貌似起步还是蛮早的，已经做了几年了</p>
<ul>
<li><strong>第一面</strong> ：主要是技术面，问的以简历的内容为主还有面试官会看以往做过的项目（现在看项目的公司确实不多了）比较在意的是之前做过的项目整体的流程，整体架构设计模式还有业务这块的详情，基本都是围绕做的项目这块的技术点来的涉及的知识点也基本涵盖了目前比较流行的开源组件，还有会问一些关于同类框架之前的区别与对比：比如volley与okhttp，图片框架，数据库greenDao，realm，litepal等等性能方面的问题</li>
<li><strong>第二面</strong> ：第一面没什么问题之后会和HR进一步沟通，主要介绍了公司目前的产品方向还有项目节奏，福利待遇神马之类的</li>
<li><strong>总监面</strong> ：能见到总监也基本很不容易了，基本也是聊了聊以往的项目，可能比较看重的是解决问题的能力，会问擅长哪方面（Ui还是业务？）项目难点等等。。。</li>
<li><strong>后续</strong> ：没有通知是否给offer（难道是薪资问题？？现在市场要到20K左右貌似就要考虑考虑了）</li>
</ul>
<hr>
<h2 id="邻动"><a href="#邻动" class="headerlink" title="邻动"></a>邻动</h2><p><strong>邻动</strong> 这家公司是在boss上约的，公司地址也是在知春路附近，公司的办公环境没的说，门口摆着各种零食饮料，面试等待的过程，前台妹子还给了一杯饮料喝O(∩_∩)O~，公司主要做视频方向的项目，目前已知产品叫“快牙”</p>
<ul>
<li><strong>第一面</strong> ：主要是技术面，基本问的跟之前遇到的问题一样，其中回答的不是很好的问题户要是MessageQue的源码实现（我回答错了，应该是链表）还有自定义线程池（应该是问线程池那几个参数），但是公司的技术要求可能希望更倾向于有FFmpeg相关经验还有做过视频剪切，裁剪之类的经验吧，问完就送客了….内心其实还是挺喜欢做视频这块的项目(⊙﹏⊙)b</li>
</ul>
<blockquote>
<p>感觉问到的问题除了那两块其他的回答还是蛮好的，尼玛心累</p>
</blockquote>
<hr>
<h2 id="元宝亿家"><a href="#元宝亿家" class="headerlink" title="元宝亿家"></a>元宝亿家</h2><p><strong>元宝亿家</strong> 这家公司是在boss上约的，公司地址在东直门，去了直接在前台填表，然后一个目测像总监的人直接面试，他们现在的项目是采用MVP写的应该是想找个人快速接手</p>
<ul>
<li><strong>第一面</strong> ：主要是技术面，问的东西感觉还好，但是感觉自己发挥的不是很好，Java String类的底层源码（其实就是char数组），Hashmap实现原理，Android 广播 Service相关的，ANR，gson高级用法（比如序列化的时候如何排除某个字段），项目里用到的设计模式，android手势机制用到了什么设计模式（是责任链模式，这个我回答错了），内存泄漏和内存溢出，子线程不能更新view的机制，Rxjava retrofit okhttp，给我印象比较深的是问了mac上pwd这个命令是干嘛的（我用了这么久mac确实没有用过这个命令，是显示当前文件全路径的）还有用没用过Home brew，最后问了问Git相关的命令pull跟fetch</li>
<li>git rm a.a 移除文件(从暂存区和工作区中删除)</li>
<li><p>git rm –cached a.a 移除文件(只从暂存区中删除)</p>
</li>
<li><p>PS:技术很耐心的给我讲解了我没能答对的问题</p>
</li>
<li><p><strong>总结</strong> ：感觉自己跟目前市场上需求真正意义的Android高级工程职位还是有一定差距的，好多东西还是欠缺好多，还要继续恶补了，fighting…</p>
<blockquote>
<p>约了第二天复试，信心严重受挫，不知道能不能谈拢…<br>复试完结在考虑是否过去…</p>
</blockquote>
</li>
</ul>
<hr>
<h2 id="最近面试的几家公司"><a href="#最近面试的几家公司" class="headerlink" title="最近面试的几家公司"></a>最近面试的几家公司</h2><p>这周面的几家公司相对来说都比较正常了没有过多的问源码，基本都是看简历然后以往的项目经验，基本能把以前问过的东西能正确的说出来再面的别的公司也基本OK…</p>
<p><strong>苏宁体育</strong> 这家公司是在boss上约的，公司地址望京锐创国际，去了直接在前台填表，然后有个笔试题（还蛮简单的，主要是写一个单例，多态）,填完就一直等，因为面Android的在排队，然后等了快半个小时，来了两个人面的一个是Android,另外一个是一个女的项目负责人。。。</p>
<ul>
<li><p>总体的面试感觉还OK，因为是做体育类视频项目的，会要求多一些FFmpeg的技能。。。公司会比较在意这一块的想来面试的建议先把这部分摸清，否则人家都不会往深层次的提问，就算问了也接不上哦~</p>
</li>
<li><p>薪资我只奢求不低于之前在信和的待遇，估计按现在的行情很难啊,有种想回原来公司的冲动~~o(&gt;_&lt;)o ~~。。。大的环境冒险离职真的很危险啊，出来都要降薪了，现在这个时间段确实不适合找工作，希望有离职想法的兄弟别冲动….</p>
</li>
</ul>
<p><strong>新娱时代</strong> 这家公司都忘了是哪个大兄弟帮我推的，公司原来是在魏公村，现在搬到了中关村的鼎好电子城写字楼，去的时候还一直在装修，面试的地方极其简陋，因为是内推的技术这块基本就大致聊聊，感觉薪资也是给不到。。而且目前公司还是996的节奏，做海外直播，貌似项目还蛮多的工作强度很大。。。</p>
<ul>
<li>目前他们公司的项目是采用MVP写的，不理解的是为什么项目还用比较陈旧的Volley作为请求框架…</li>
</ul>
<p><strong>半糖</strong> 这家公司是一个非常好的哥们推给他们公司的php的童鞋然后帮我推的，公司在雍和宫的一个胡同里，非常有文艺气息，来到公司首先要填表然后还要填一份性格测试，之后来的面试官也非常的有亲和力，基本都在聊以往互相的项目经验之类的，面试官做Android也蛮久了可能比较保守，自己公司的产品并木有用到最新比较主流的技术框架，应该是考虑项目稳定吧，但是我感觉也太保守了，公司的产品做了三年按他的话来说就是迭代的时间太紧张，基本没有重构的时间就开始做下个版本了，我觉得还是应该搞一搞技术变革的，肯定能提升团队整体的效率，并跟他推荐了一个蛮好用的插件jrebel for android…</p>
<ul>
<li><p>这里安利几个本人一直在用的比较好用库  </p>
</li>
<li><p>下拉刷新&amp;滚动到底部加载更多 <a href="https://github.com/MIkeeJY/demo-1" target="_blank" rel="noopener">https://github.com/MIkeeJY/demo-1</a></p>
</li>
<li><p>这个项目是由一个CSDN大神叫Li Hong修改自PulltoRefresh那个库而来，基本做到了View的分离，用法也比较简单就是直接把拓展的控件放进去，理论上支持所有的View的下拉，需要注意的是这个库只实现了listview的加载更多，recyclerview需要自己拓展</p>
</li>
<li><p><a href="https://github.com/ybq/Endless-RecyclerView" target="_blank" rel="noopener">https://github.com/ybq/Endless-RecyclerView</a> 这个库实现了recyclerview的加载更多配合上面的下拉刷新控件对比别的recyclerview的扩展，这个是代码量最少最简单且bug比较少的，其它类似的扩展大概就是用装饰器模式去封装recyclerview的adapter咯~</p>
</li>
<li><a href="https://github.com/MIkeeJY/OkHttpUtils-2" target="_blank" rel="noopener">https://github.com/MIkeeJY/OkHttpUtils-2</a> 自用Okhttp封装，参考了鸿洋大神Okhttp2.x版本的封装，采用纯Okhttp实现，基本能满足所有的网络请求</li>
<li>Glide封装可以参考 <a href="https://github.com/whyalwaysmea/BigBoom" target="_blank" rel="noopener">https://github.com/whyalwaysmea/BigBoom</a> 这个项目中抽出接口的方式</li>
<li><a href="https://github.com/jinloong/BannerLayout" target="_blank" rel="noopener">https://github.com/jinloong/BannerLayout</a> 虽然star不多但是用起来非常稳定的一个轮播库（比较冷门，相反star数多的库反而各种bug,(⊙﹏⊙)b）</li>
</ul>
<p><strong>总结</strong> ：面试也是一个不断总结跟学习的过程，可能拿到合适的offer还需要一些运气的成份，我始终坚信就算大的环境再不好，但是其实整个行业还是缺牛人的！一时的不景气并不会影响真正技术好的人，博主已经入职了，祝大家好运~</p>
<p><strong>PS</strong> ：首先写这篇文章的目的不在于针对某某公司，这个选择都是双向的，大家谁都不欠谁，只是想把遇到的公司做一个总结展示给大家看，供大家以后求职时候的参考，在于告诫大家如果没什么想不开的千万不要在这个时候离职，比较目前环境可以说是非常的严峻，离职要慎重！！！离职要慎重！！！离职要慎重！！！重要的事情说三遍~！如果有针对某些公司负能量的言语，可能言语过激，希望大家能及时指出，我会及时修改，目测应该还有人对我的技术做出了评价，我也承认目前跟真正的Android高级是有差距的（但是毕竟还是有些技术实力的，15年面过腾讯，优酷，16年面了Apus都拿到了offer，只是我当时想法太年轻没去而已），但是目前Android层的东西还是蛮杂的，我也不可能什么都会，目前已经拿到几家offer也已经做出选择了，这里记录下辛酸的面试历程吧~</p>
<hr>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/11/camera/" itemprop="url">
                  关于调用系统照相机Activity被销毁问题解决
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-11T17:08:26+08:00" content="2016-05-11">
              2016-05-11
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在项目中需要启用系统照相机来拍照。本来很容易的一个问题。但在适配中出现了问题。<br>简单说一下问题：<br>    有些手机拍照成功，有些手机拍完照后确定返回后activity数据丢失，被销毁了。<br>问题查找：<br>    经过代码查找发现，当这些出问题的手机被调用系统手机拍照时，当前activity被销毁了之后又被重新创建了。即Acitivity 执行了ondestory()–&gt;onCreate()，所以Activity被重新创建了从而内部的数据丢失,而按照正常的逻辑该Activity应该入后台堆栈。一开始以为是系统启用照相机内存不够自动销毁回收。可有些手机不会出现该问题。很无奈。<br>    之后经过本人细心研究activity的生命周期才恍然大悟，原来当手机横竖屏时系统会重新创建一个activity，这就是为什么上个activity会ondestory()–&gt;onCreate()。但为什么有些手机会执行有些不会呢。问题就出在横竖屏上。因为有些手机的系统照相机弄的很炫会自动旋转90度，从而导致了横竖屏的发生（–！看来最潮的也不是好东西，苦了我们这些碼农）。这就是为什有些手机会发生有些不会。跟系统照相机是否旋转有关系。<br>    最后贴上解决方案。<br>    AndroidMainifest.xml中加入</p>
<pre><code>&lt;activity
            android:name=&quot;.Activity&quot;
            android:launchMode=&quot;singleTask&quot;          
            android:configChanges=&quot;orientation|keyboardHidden&quot;                       
            android:theme=&quot;@android:style/Theme.Black.NoTitleBar.Fullscreen&quot;/&gt;
</code></pre><pre><code>@Override
public void onConfigurationChanged(Configuration newConfig) {
    //其实这里什么都不要做
    super.onConfigurationChanged(newConfig);
}
</code></pre><h6 id="PS-在level13以后加入了一个screenSize的属性，这个属性很重要如果在android3-2以后的版本中没有添加”screenSize”的话依然会触发横竖屏activity销毁周期-也就是说不能屏蔽activity销毁，从而调用onConfigurationChanged方法，而在3-2之前只要设置orientation-keyboardHidden就可以-。由于智能机的迅速普及手机的系统大多数升级到4-0以上，这样会导致很多没有设置screenSize属性的程序activity又出现销毁情况。"><a href="#PS-在level13以后加入了一个screenSize的属性，这个属性很重要如果在android3-2以后的版本中没有添加”screenSize”的话依然会触发横竖屏activity销毁周期-也就是说不能屏蔽activity销毁，从而调用onConfigurationChanged方法，而在3-2之前只要设置orientation-keyboardHidden就可以-。由于智能机的迅速普及手机的系统大多数升级到4-0以上，这样会导致很多没有设置screenSize属性的程序activity又出现销毁情况。" class="headerlink" title="PS:在level13以后加入了一个screenSize的属性，这个属性很重要如果在android3.2以后的版本中没有添加”screenSize”的话依然会触发横竖屏activity销毁周期(也就是说不能屏蔽activity销毁，从而调用onConfigurationChanged方法，而在3.2之前只要设置orientation|keyboardHidden就可以)。由于智能机的迅速普及手机的系统大多数升级到4.0以上，这样会导致很多没有设置screenSize属性的程序activity又出现销毁情况。"></a>PS:在level13以后加入了一个screenSize的属性，这个属性很重要如果在android3.2以后的版本中没有添加”screenSize”的话依然会触发横竖屏activity销毁周期(也就是说不能屏蔽activity销毁，从而调用onConfigurationChanged方法，而在3.2之前只要设置orientation|keyboardHidden就可以)。由于智能机的迅速普及手机的系统大多数升级到4.0以上，这样会导致很多没有设置screenSize属性的程序activity又出现销毁情况。</h6><p>试试如下代码：<br>AndroidMainifest.xml中加入</p>
<pre><code>&lt;activity  
  android:name=&quot;.Activity&quot; 
  android:launchMode=&quot;singleTask&quot;    
  android:configChanges=&quot;orientationkeyboardHidden|screenSize&quot;/&gt;
</code></pre><p>复写acitivity的onConfigurationChanged方法</p>
<pre><code>@Override
public void onConfigurationChanged(Configuration newConfig) {
    //其实这里什么都不要做
    super.onConfigurationChanged(newConfig);
}
</code></pre>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/20/BaseRecyclerView/" itemprop="url">
                  对RecyclerView.Adapter的简单封装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-20T14:58:25+08:00" content="2016-04-20">
              2016-04-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对分页展示而言，RecyclerView已经可以完全替代ListView。这里只进行一下对其Adapter的简单封装。  </p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ul>
<li>目的：目的是为了减少Adapter具体实现的代码，使代码整洁，易于维护。</li>
<li>分析：与listview面向view的adapter不同，recyclerview面向的是viewholder。所以BaseRecyclerAdapter需要两个泛型声明，一个是数据源，一个是viewholder。<br>onCreateViewHoler()方法中需要生成具体的viewhoder实例，所以暂时不去对其做封装。对onBindViewHoler()方法的操作分为两步，一步是bindItemData()将数据填充至itemview，下一步是setupOnItemClick()设置每个item的点击监听。其它方法都是对便利性的扩展，可以根据不同情况添加。</li>
<li>并没有对viewholder动刀子，考虑到目前情况下在AS中利用ButterKnife可以高效的生成viewholder，对开发效率影响不大。不过ButterKnife毕竟是通过运行时反射对view进行绑定的，对效率是有影响，但是AS2.0之后发现Google有扶正DataBindding的趋势，所以综合考虑下，还是没有对viewholder动刀子。但是会在RecyclerView深入研究时思考这个问题。 </li>
</ul>
<h3 id="BaseRecyclerViewAdapter"><a href="#BaseRecyclerViewAdapter" class="headerlink" title="BaseRecyclerViewAdapter"></a>BaseRecyclerViewAdapter</h3><p>话不多说,上代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public abstract class BaseRecyclerAdapter&lt;T, VH extends RecyclerView.ViewHolder&gt; extends RecyclerView.Adapter&lt;VH&gt; &#123;</span><br><span class="line">    protected List&lt;T&gt; mDatas = new ArrayList&lt;&gt;();</span><br><span class="line">    protected Context mContext;</span><br><span class="line">    protected LayoutInflater inflater;</span><br><span class="line">    AdapterView.OnItemClickListener mItemClickListener;</span><br><span class="line">    public BaseRecyclerAdapter(List&lt;T&gt; mDatas, Context mContext) &#123;</span><br><span class="line">        this.mDatas = mDatas;</span><br><span class="line">        this.mContext = mContext;</span><br><span class="line">        inflater = LayoutInflater.from(mContext);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onBindViewHolder(VH holder, int position) &#123;</span><br><span class="line">        final T item = getItem(position);</span><br><span class="line">        bindItemData(holder, item, position);</span><br><span class="line">        setupOnItemClick(holder, position);</span><br><span class="line">    &#125;</span><br><span class="line">    protected abstract void bindItemData(VH viewHolder, T data, int position);</span><br><span class="line">    protected void setupOnItemClick(final VH viewHolder, final int position) &#123;</span><br><span class="line">        if (mItemClickListener != null) &#123;</span><br><span class="line">            viewHolder.itemView.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(View v) &#123;</span><br><span class="line">                    mItemClickListener.onItemClick(null, viewHolder.itemView, position, position);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public int getItemCount() &#123;</span><br><span class="line">        return mDatas != null ? mDatas.size() : 0;</span><br><span class="line">    &#125;</span><br><span class="line">    public T getItem(int position) &#123;</span><br><span class="line">        position = Math.max(0, position);</span><br><span class="line">        return mDatas.get(position);</span><br><span class="line">    &#125;</span><br><span class="line">    public List&lt;T&gt; getDataSource() &#123;</span><br><span class="line">        return mDatas;</span><br><span class="line">    &#125;</span><br><span class="line">    public void addData(List&lt;T&gt; newItems) &#123;</span><br><span class="line">        if (newItems != null) &#123;</span><br><span class="line">            mDatas.addAll(newItems);</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public void updateListViewData(List&lt;T&gt; lists) &#123;</span><br><span class="line">        mDatas.clear();</span><br><span class="line">        if (lists != null) &#123;</span><br><span class="line">            mDatas.addAll(lists);</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setOnItemClickListener(AdapterView.OnItemClickListener listener) &#123;</span><br><span class="line">        this.mItemClickListener = listener;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class NotesAdapter extends BaseRecyclerAdapter&lt;NoteItem, NotesAdapter.NotesViewHolder&gt; &#123;</span><br><span class="line">    public NotesAdapter(List&lt;NoteItem&gt; mDatas, Context mContext) &#123;</span><br><span class="line">        super(mDatas, mContext);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public NotesViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</span><br><span class="line">        View contentView = LayoutInflater.from(mContext)</span><br><span class="line">                .inflate(R.layout.recycler_item_note, parent, false);</span><br><span class="line">        NotesViewHolder vh = new NotesViewHolder(contentView);</span><br><span class="line">        return vh;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void bindItemData(NotesViewHolder viewHolder, NoteItem data, int position) &#123;</span><br><span class="line">        viewHolder.titleTxt.setText(data.getTitle());</span><br><span class="line">        viewHolder.timeTxt.setText(data.getCreatedTime());</span><br><span class="line">        viewHolder.tagTxt.setText(data.getTags().size() != 0 ? data.getTags().get(0) : &quot;other&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    static class NotesViewHolder extends RecyclerView.ViewHolder &#123;</span><br><span class="line">        @Bind(R.id.title_txt)</span><br><span class="line">        TextView titleTxt;</span><br><span class="line">        @Bind(R.id.time_txt)</span><br><span class="line">        TextView timeTxt;</span><br><span class="line">        @Bind(R.id.tag_txt)</span><br><span class="line">        TextView tagTxt;</span><br><span class="line">        NotesViewHolder(View view) &#123;</span><br><span class="line">            super(view);</span><br><span class="line">            ButterKnife.bind(this, view);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/20/gson/" itemprop="url">
                  Gson解析（List和Map）格式json数据
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-20T14:58:25+08:00" content="2016-04-20">
              2016-04-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有时候服务端非得返回比较傻逼的Json</p>
<h2 id="这时候可以用gson解析带有键值对的json"><a href="#这时候可以用gson解析带有键值对的json" class="headerlink" title="这时候可以用gson解析带有键值对的json"></a>这时候可以用gson解析带有键值对的json</h2><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public class jsonParse&#123;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">class City&#123;</span><br><span class="line"></span><br><span class="line">        int id;</span><br><span class="line"></span><br><span class="line">        String name;</span><br><span class="line"></span><br><span class="line">        String code;</span><br><span class="line"></span><br><span class="line">        String map;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        //列表/array 数据</span><br><span class="line"></span><br><span class="line">                 String str=<span class="string">"[&#123;'id': '1','code': 'bj','name': '北京','map': '39.90403, 116.40752599999996'&#125;, &#123;'id': '2','code': 'sz','name': '深圳','map': '22.543099, 114.05786799999998'&#125;, &#123;'id': '9','code': 'sh','name': '上海','map': '31.230393,121.473704'&#125;, &#123;'id': '10','code': 'gz','name': '广州','map': '23.129163,113.26443500000005'&#125;]"</span>;</span><br><span class="line"></span><br><span class="line">        Gson gson=new Gson();</span><br><span class="line"></span><br><span class="line">        List&lt;City&gt; rs=new ArrayList&lt;City&gt;();</span><br><span class="line"></span><br><span class="line">         Type <span class="built_in">type</span> = new TypeToken&lt;ArrayList&lt;City&gt;&gt;() &#123;&#125;.getType();</span><br><span class="line"></span><br><span class="line">          rs=gson.fromJson(str, <span class="built_in">type</span>);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span>(City o:rs)&#123;</span><br><span class="line"></span><br><span class="line">                  System.out.println(o.name);</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          </span><br><span class="line"></span><br><span class="line">          //map数据</span><br><span class="line"></span><br><span class="line">          String jsonStr=<span class="string">"&#123;'1': &#123;'id': '1','code': 'bj','name': '北京','map': '39.90403, 116.40752599999996'&#125;,'2': &#123;'id': '2','code': 'sz','name': '深圳','map': '22.543099, 114.05786799999998'&#125;,'9': &#123;'id': '9','code': 'sh','name': '上海','map': '31.230393,121.473704'&#125;,'10': &#123;'id': '10','code': 'gz','name': '广州','map': '23.129163,113.26443500000005'&#125;&#125;"</span>;</span><br><span class="line"></span><br><span class="line">          Map&lt;String, City&gt; citys = gson.fromJson(jsonStr, new TypeToken&lt;Map&lt;String, City&gt;&gt;() &#123;&#125;.getType()); </span><br><span class="line"></span><br><span class="line">          System.out.println(citys.get(<span class="string">"1"</span>).name+<span class="string">"----------"</span>+citys.get(<span class="string">"2"</span>).code);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/20/gsonUtil/" itemprop="url">
                  Gson工具类
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-20T14:58:25+08:00" content="2016-04-20">
              2016-04-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用泛型来封装Gson</p>
<h2 id="泛型才是JAVA的精髓"><a href="#泛型才是JAVA的精髓" class="headerlink" title="泛型才是JAVA的精髓"></a>泛型才是JAVA的精髓</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">import com.google.gson.Gson;</span><br><span class="line">import com.google.gson.JsonArray;</span><br><span class="line">import com.google.gson.JsonElement;</span><br><span class="line">import com.google.gson.JsonParser;</span><br><span class="line">import com.google.gson.reflect.TypeToken;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class GsonUtil &#123;</span><br><span class="line">    private static Gson gson = null;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        <span class="keyword">if</span> (gson == null) &#123;</span><br><span class="line">            gson = new Gson();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="function"><span class="title">GsonUtil</span></span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成json</span><br><span class="line">     *</span><br><span class="line">     * @param object</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static String GsonString(Object object) &#123;</span><br><span class="line">        String gsonString = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            gsonString = gson.toJson(object);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> gsonString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成bean</span><br><span class="line">     *</span><br><span class="line">     * @param gsonString</span><br><span class="line">     * @param cls</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; T GsonToBean(String gsonString, Class&lt;T&gt; cls) &#123;</span><br><span class="line">        T t = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            t = gson.fromJson(gsonString, cls);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成list</span><br><span class="line">     * 解决泛型问题</span><br><span class="line">     *</span><br><span class="line">     * @param json</span><br><span class="line">     * @param cls</span><br><span class="line">     * @param &lt;T&gt;</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; List&lt;T&gt; GsonToList(String json, Class&lt;T&gt; cls) &#123;</span><br><span class="line">        Gson gson = new Gson();</span><br><span class="line">        List&lt;T&gt; list = new ArrayList&lt;T&gt;();</span><br><span class="line">        JsonArray array = new JsonParser().parse(json).getAsJsonArray();</span><br><span class="line">        <span class="keyword">for</span> (final JsonElement elem : array) &#123;</span><br><span class="line">            list.add(gson.fromJson(elem, cls));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成list中有map的</span><br><span class="line">     *</span><br><span class="line">     * @param gsonString</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; List&lt;Map&lt;String, T&gt;&gt; GsonToListMaps(String gsonString) &#123;</span><br><span class="line">        List&lt;Map&lt;String, T&gt;&gt; list = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            list = gson.fromJson(gsonString, new TypeToken&lt;List&lt;Map&lt;String, T&gt;&gt;&gt;() &#123;</span><br><span class="line">            &#125;.getType());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成map的</span><br><span class="line">     *</span><br><span class="line">     * @param gsonString</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; Map&lt;String, T&gt; GsonToMaps(String gsonString) &#123;</span><br><span class="line">        Map&lt;String, T&gt; map = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            map = gson.fromJson(gsonString, new TypeToken&lt;Map&lt;String, T&gt;&gt;() &#123;</span><br><span class="line">            &#125;.getType());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">     * 将Map转化为Json</span><br><span class="line">     *</span><br><span class="line">     * @param map</span><br><span class="line">     * @<span class="built_in">return</span> String</span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; String mapToJson(Map&lt;String, T&gt; map) &#123;</span><br><span class="line">        String jsonStr = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            jsonStr = gson.toJson(map);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> jsonStr;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/default_avatar.jpg" alt="Mikee">
          <p class="site-author-name" itemprop="name">Mikee</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">8</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mikee</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
