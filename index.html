<!doctype html>



  


<html class="theme-next muse use-motion">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta property="og:type" content="website">
<meta property="og:title" content="Mikee的八度空间">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Mikee的八度空间">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mikee的八度空间">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Mikee的八度空间 </title>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Mikee的八度空间</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/08/16/Android开发中RecyclerView的一些优化技术/" itemprop="url">
                  Android开发中RecyclerView的一些优化技术
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2019-08-16T10:33:37+08:00" content="2019-08-16">
              2019-08-16
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>关于RecyclerView的优化，自己会将它们分为两大类，一类是RecyclerView自带的系统优化，另一类就是我们通过代码实现的手动优化，先来介绍下RecyclerView自带的系统优化。系统优化我们不能做太多的干预，但是通过理解RecyclerView的系统优化能够让我们更好的理解RecyclerView的工作机制。</p>
<h4 id="预取功能-Prefetch"><a href="#预取功能-Prefetch" class="headerlink" title="预取功能(Prefetch)"></a>预取功能(Prefetch)</h4><p> 这个功能是rv在版本25之后自带的，也就是说只要你使用了25或者之后版本的rv，那么就自带该功能，并且默认就是处理开启的状态，通过LinearLayoutManager的setItemPrefetchEnabled()我们可以手动控制该功能的开启关闭，但是一般情况下没必要也不推荐关闭该功能，预取功能的原理比较好理解，如图所示</p>
<p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz/MOu2ZNAwZwPHKG7Ee6AKxj1ichFSy14jbNibRVm6KDn601AEFNEC1qEial48kzDBF2UCUSVlnvnht1stlJXLxuVGA/640?wx_fmt=other" alt="img"></p>
<p>我们都知道android是通过每16ms刷新一次页面来保证ui的流畅程度，现在android系统中刷新ui会通过cpu产生数据，然后交给gpu渲染的形式来完成，从上图可以看出当cpu完成数据处理交给gpu后就一直处于空闲状态，需要等待下一帧才会进行数据处理，而这空闲时间就被白白浪费了，如何才能压榨cpu的性能，让它一直处于忙碌状态，这就是rv的预取功能(Prefetch)要做的事情，rv会预取接下来可能要显示的item，在下一帧到来之前提前处理完数据，然后将得到的itemholder缓存起来，等到真正要使用的时候直接从缓存取出来即可</p>
<h4 id="预取代码理解"><a href="#预取代码理解" class="headerlink" title="预取代码理解"></a>预取代码理解</h4><p>虽说预取是默认开启不需要我们开发者操心的事情，但是明白原理还是能加深该功能的理解。下面就说下自己在看预取源码时的一点理解。实现预取功能的一个关键类就是gapworker，可以直接在rv源码中找到该类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GapWorker mGapWorker;</span><br></pre></td></tr></table></figure>
<p>rv通过在ontouchevent中触发预取的判断逻辑，在手指执行move操作的代码末尾有这么段代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">case MotionEvent.ACTION_MOVE: &#123;</span><br><span class="line">               ......</span><br><span class="line">                    if (mGapWorker != null &amp;&amp; (dx != 0 || dy != 0)) &#123;</span><br><span class="line">                        mGapWorker.postFromTraversal(this, dx, dy);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; break;</span><br></pre></td></tr></table></figure>
<p>通过每次move操作来判断是否预取下一个可能要显示的item数据，判断的依据就是通过传入的dx和dy得到手指接下来可能要移动的方向，如果dx或者dy的偏移量会导致下一个item要被显示出来则预取出来，但是并不是说预取下一个可能要显示的item一定都是成功的，其实每次rv取出要显示的一个item本质上就是取出一个viewholder，根据viewholder上关联的itemview来展示这个item。而取出viewholder最核心的方法就是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tryGetViewHolderForPositionByDeadline(int position,boolean dryRun, long deadlineNs)</span><br></pre></td></tr></table></figure>
<p>名字是不是有点长，在rv源码中你会时不时见到这种巨长的方法名，看方法的参数也能找到和预取有关的信息,deadlineNs的一般取值有两种，一种是为了兼容版本25之前没有预取机制的情况，兼容25之前的参数为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static final long FOREVER_NS = Long.MAX_VALUE;</span><br></pre></td></tr></table></figure>
<p>，另一种就是实际的deadline数值，超过这个deadline则表示预取失败，这个其实也好理解，预取机制的主要目的就是提高rv整体滑动的流畅性，如果要预取的viewholder会造成下一帧显示卡顿强行预取的话那就有点本末倒置了。</p>
<p>关于预取成功的条件通过调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">boolean willCreateInTime(int viewType, long approxCurrentNs, long deadlineNs) &#123;</span><br><span class="line">            long expectedDurationNs = getScrapDataForType(viewType).mCreateRunningAverageNs;</span><br><span class="line">            return expectedDurationNs == 0 || (approxCurrentNs + expectedDurationNs &lt; deadlineNs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来进行判断，approxCurrentNs的值为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">long start = getNanoTime();</span><br><span class="line">if (deadlineNs != FOREVER_NS</span><br><span class="line">                            &amp;&amp; !mRecyclerPool.willCreateInTime(type, start, deadlineNs)) &#123;</span><br><span class="line">         // abort - we have a deadline we can&apos;t meet</span><br><span class="line">        return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而mCreateRunningAverageNs就是创建同type的holder的平均时间，感兴趣的可以去看下这个值如何得到，不难理解就不贴代码了。关于预取就说到这里，感兴趣的可以自己去看下其余代码的实现方式，可以说google对于rv还是相当重视的，煞费苦心提高rv的各种性能，据说最近推出的viewpager2控件就是通过rv来实现的，大有rv控件一统天下的感觉。</p>
<h4 id="四级缓存"><a href="#四级缓存" class="headerlink" title="四级缓存"></a>四级缓存</h4><p>rv设计中另一个提高滑动流畅性的东西就是这个四级缓存了，如果说预取是25版本外来的务工人员，那么这个四级缓存就是一个本地土著了，自rv出现以来就一直存在，相比较listview的2级缓存机制，rv的四级看起来是不是显得更加的高大上。借用一张示意图来看下rv的四级缓存</p>
<p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz/MOu2ZNAwZwPHKG7Ee6AKxj1ichFSy14jbZic5VZNkCfjJYiaZYNUQMpf0BZzGZOY7tOQsxu4vB0GtiaxugmOu1w3ww/640?wx_fmt=other" alt="img"></p>
<p>，rv中通过recycler来管理缓存机制，关于如何使用缓存可以在tryGetViewHolderForPositionByDeadline找到，没错又是这个方法，看来名字起的长存在感也会比较足。</p>
<p>tryGetViewHolderForPositionByDeadline依次会从各级缓存中去取viewholer，如果取到直接丢给rv来展示，如果取不到最终才会执行我们非常熟悉的oncreatviewholder和onbindview方法，一句话就把tryGetViewHolderForPositionByDeadline的功能给讲明白了，内部实现无非是如何从四级缓存中去取肯定有个优先级的顺序。可以先来看下recycler中关于这四级缓存的代码部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public final class Recycler &#123;</span><br><span class="line">        final ArrayList&lt;ViewHolder&gt; mAttachedScrap = new ArrayList&lt;&gt;();</span><br><span class="line">        ArrayList&lt;ViewHolder&gt; mChangedScrap = null;</span><br><span class="line"></span><br><span class="line">        final ArrayList&lt;ViewHolder&gt; mCachedViews = new ArrayList&lt;ViewHolder&gt;();</span><br><span class="line"></span><br><span class="line">        private ViewCacheExtension mViewCacheExtension;</span><br><span class="line"></span><br><span class="line">        RecycledViewPool mRecyclerPool;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>四级缓存的真面目可以在这看到，其中两个scrap就是第一级缓存，是recycler在获取viewholder时最先考虑的缓存，接下来的mCachedViews，mViewCacheExtension，mRecyclerPool分别对应2,3,4级缓存。</p>
<h4 id="各级缓存作用"><a href="#各级缓存作用" class="headerlink" title="各级缓存作用"></a>各级缓存作用</h4><p>scrap:<br> rv之所以要将缓存分成这么多块肯定在功能上是有一定的区分的，它们分别对应不同的使用场景，scrap是用来保存被rv移除掉但最近又马上要使用的缓存，比如说rv中自带item的动画效果，本质上就是计算item的偏移量然后执行属性动画的过程，这中间可能就涉及到需要将动画之前的item保存下位置信息，动画后的item再保存下位置信息，然后利用这些位置数据生成相应的属性动画。如何保存这些viewholer呢，就需要使用到scrap了，因为这些viewholer数据上是没有改变的，只是位置改变而已，所以放置到scrap最为合适。稍微仔细看的话就能发现scrap缓存有两个成员mChangedScrap和mAttachedScrap，它们保存的对象有些不一样，一般调用adapter的notifyItemRangeChanged被移除的viewholder会保存到mChangedScrap，其余的notify系列方法(不包括notifyDataSetChanged)移除的viewholder会被保存到mAttachedScrap中。</p>
<p>cached:<br> 也是rv中非常重要的一个缓存，就linearlayoutmanager来说cached缓存默认大小为2，它的容量非常小，所起到的作用就是rv滑动时刚被移出屏幕的viewholer的收容所，因为rv会认为刚被移出屏幕的viewholder可能接下来马上就会使用到，所以不会立即设置为无效viewholer，会将它们保存到cached中，但又不能将所有移除屏幕的viewholder都视为有效viewholer，所以它的默认容量只有2个，当然我们可以通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void setViewCacheSize(int viewCount) &#123;</span><br><span class="line">            mRequestedCacheMax = viewCount;</span><br><span class="line">            updateViewCacheSize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来改变这个容量大小，这个就看实际应用场景了。</p>
<p>extension:<br> 第三级缓存，这是一个自定义的缓存，没错rv是可以自定义缓存行为的，在这里你可以决定缓存的保存逻辑，但是这么个自定义缓存一般都没有见过具体的使用场景，而且自定义缓存需要你对rv中的源码非常熟悉才行，否则在rv执行item动画，或者执行notify的一系列方法后你的自定义缓存是否还能有效就是一个值得考虑的问题，所以一般不太推荐使用该缓存，更多的我觉得这可能是google自已留着方便扩展来使用的，目前来说这还只是个空实现而已，从这点来看其实rv所说的四级缓存本质上还只是三级缓存。</p>
<p>pool：<br> 又一个重要的缓存，这也是唯一一个我们开发者可以方便设置的一个(虽然extension也能设置，但是难度大)，而且设置方式非常简单，new一个pool传进去就可以了，其他的都不用我们来处理，google已经给我们料理好后事了，这个缓存保存的对象就是那些无效的viewholer，虽说无效的viewholer上的数据是无效的，但是它的rootview还是可以拿来使用的，这也是为什么最早的listview有一个convertView参数的原因，当然这种机制也被rv很好的继承了下来。pool一般会和cached配合使用，这么来说，cached存不下的会被保存到pool中毕竟cached默认容量大小只有2，但是pool容量也是有限的当保存满之后再有viewholder到来的话就只能会无情抛弃掉，它也有一个默认的容量大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private static final int DEFAULT_MAX_SCRAP = 5;</span><br><span class="line">int mMaxScrap = DEFAULT_MAX_SCRAP;</span><br></pre></td></tr></table></figure>
<p>这个大小也是可以通过调用方法来改变，具体看应用场景，一般来说正常使用的话使用默认大小即可。</p>
<p>以上就是rv的四级缓存介绍，rv在设计之初就考虑到了这些问题，当然里面的一些细节还是比较多的，这个就需要感兴趣的自己去研究了，也正是因为google给我们考虑到这么多的优化这些才会显得rv的源码有些庞大，光一个rv差不多就1万3千多行，这还不包括layoutmanager的实现代码，这也是为什么很多人在遇到rv崩溃问题的时候会比较抓狂，根本原因还是在于没能好好研究过一些相关源码。</p>
<hr>
<h4 id="我们可以做的"><a href="#我们可以做的" class="headerlink" title="我们可以做的"></a>我们可以做的</h4><p>上面都在说rv中自带的一些优化技术，虽然google爸爸千方百计给我们提供好了很多可以给rv使用的优化api，但是这也架不住很多人不会使用啊，饭都到你嘴边了你自己都不会张嘴那就没人能帮你了，所以接下来就可以来说说我们在代码可以做哪些事情来充分发挥rv的性能。</p>
<h4 id="降低item的布局层次"><a href="#降低item的布局层次" class="headerlink" title="降低item的布局层次"></a>降低item的布局层次</h4><p>其实这个优化不光适用于rv，activity的布局优化也同样适用，降低页面层次可以一定程度降低cpu渲染数据的时间成本，反应到rv中就是降低mCreateRunningAverageNs的时间，不光目前显示的页面能加快速度，预取的成功率也能提高，关于如何降低布局层次还是要推荐下google的强大控件ConstraintLayout，具体使用就自行百度吧，比较容易上手，这里吐槽下另一个控件CoordinatorLayout的上手难度确实是有点大啊，不了解CoordinatorLayout源码可能会遇到一些奇葩问题。降低item的布局层次可以说是rv优化中一个对于rv源码不需要了解也能完全掌握的有效方式。</p>
<h4 id="去除冗余的setitemclick事件"><a href="#去除冗余的setitemclick事件" class="headerlink" title="去除冗余的setitemclick事件"></a>去除冗余的setitemclick事件</h4><p>rv和listview一个比较大的不同之处在于rv居然没有提供setitemclicklistener方法，这是当初自己在使用rv时一个非常不理解的地方，其实现在也不是太理解，但是好在我们可以很方便的实现该功能，一种最简单的方式就是直接在onbindview方法中设置，这其实是一种不太可取的方式，onbindview在item进入屏幕的时候都会被调用到(cached缓存着的除外)，而一般情况下都会创建一个匿名内部类来实现setitemclick，这就会导致在rv快速滑动时创建很多对象，从这点考虑的话setitemclick应该放置到其他地方更为合适</p>
<p>自己的做法就是将setitemclick事件的绑定和viewholder对应的rootview进行绑定，viewholer由于缓存机制的存在它创建的个数是一定的，所以和它绑定的setitemclick对象也是一定的。还有另一种做法可以通过rv自带的addOnItemTouchListener来实现点击事件，原理就是rv在触摸事件中会使用到addOnItemTouchListener中设置的对象，然后配合GestureDetectorCompat实现点击item，示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> recyclerView.addOnItemTouchListener(this);</span><br><span class="line"> gestureDetectorCompat = new GestureDetectorCompat(recyclerView.getContext(), new SingleClick());</span><br><span class="line"></span><br><span class="line"> @Override</span><br><span class="line"> public boolean onInterceptTouchEvent(RecyclerView rv, MotionEvent e) &#123;</span><br><span class="line">     if (gestureDetectorCompat != null) &#123;</span><br><span class="line">         gestureDetectorCompat.onTouchEvent(e);</span><br><span class="line">     &#125;</span><br><span class="line">     return false;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">private class SingleClick extends GestureDetector.SimpleOnGestureListener &#123;</span><br><span class="line"></span><br><span class="line">     @Override</span><br><span class="line">     public boolean onSingleTapConfirmed(MotionEvent e) &#123;</span><br><span class="line">         View view = recyclerView.findChildViewUnder(e.getX(), e.getY());</span><br><span class="line">         if (view == null) &#123;</span><br><span class="line">             return false;</span><br><span class="line">         &#125;</span><br><span class="line">         final RecyclerView.ViewHolder viewHolder = recyclerView.getChildViewHolder(view);</span><br><span class="line">         if (!(viewHolder instanceof ViewHolderForRecyclerView)) &#123;</span><br><span class="line">             return false;</span><br><span class="line">         &#125;</span><br><span class="line">         final int position = getAdjustPosition(viewHolder);</span><br><span class="line">         if (position == invalidPosition()) &#123;</span><br><span class="line">             return false;</span><br><span class="line">         &#125;</span><br><span class="line">         /****************/</span><br><span class="line">         点击事件设置可以考虑放在这里</span><br><span class="line">         /****************/</span><br><span class="line">         return true;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>相对来说这是一个比较优雅点的实现，但是有一点局限在于这种点击只能设置整个item的点击，如果item内部有两个textview都需要实现点击的话就可能不太适用了，所以具体使用哪种看大家的实际应用场景，可以考虑将这两种方式都封装到adapter库中，目前项目中使用的adapter库就是采用两种结合的形式。</p>
<h4 id="复用pool缓存"><a href="#复用pool缓存" class="headerlink" title="复用pool缓存"></a>复用pool缓存</h4><p>四级缓存中我已经介绍过了，复用本身并不难，调用rv的setRecycledViewPool方法设置一个pool进去就可以，但是并不是说每次使用rv场景的情况下都需要设置一个pool，这个复用pool是针对item中包含rv的情况才适用，如果rv中的item都是普通的布局就不需要复用pool</p>
<p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz/MOu2ZNAwZwPHKG7Ee6AKxj1ichFSy14jbfcIWWr6B64RTicUicddtfYOk7ahpe4FkuxdOb87NLdmbvGZeAIAFTrOw/640?wx_fmt=other" alt="img"></p>
<p>如上图所示红框就是一个item中嵌套rv的例子，这种场景还是比较常见，如果有多个item都是这种类型那么复用pool就非常有必要了，在封装adapter库时需要考虑的一个点就是如何找到item中包含rv，可以考虑的做法就是遍历item的根布局如果找到包含rv的，那么将对该rv设置pool，所有item中的嵌套rv都使用同一个pool即可,查找item中rv代码可以如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">private List&lt;RecyclerView&gt; findNestedRecyclerView(View rootView) &#123;</span><br><span class="line">        List&lt;RecyclerView&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">        if (rootView instanceof RecyclerView) &#123;</span><br><span class="line">            list.add((RecyclerView) rootView);</span><br><span class="line">            return list;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!(rootView instanceof ViewGroup)) &#123;</span><br><span class="line">            return list;</span><br><span class="line">        &#125;</span><br><span class="line">        final ViewGroup parent = (ViewGroup) rootView;</span><br><span class="line">        final int count = parent.getChildCount();</span><br><span class="line">        for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">            View child = parent.getChildAt(i);</span><br><span class="line">            list.addAll(findNestedRecyclerView(child));</span><br><span class="line">        &#125;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>得到该list之后接下来要做的就是给里面的rv绑定pool了，可以将该pool设置为adapter库中的成员变量，每次找到嵌套rv的item时直接将该pool设置给对应的rv即可。</p>
<p>关于使用pool源码上有一点需要在意的是，当最外层的rv滑动导致item被移除屏幕时，rv其实最终是通过调用<br> removeview(view)完成的，里面的参数view就是和holder绑定的rootview，如果rootview中包含了rv，也就是上图所示的情况，会最终调用到嵌套rv的onDetachedFromWindow方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public void onDetachedFromWindow(RecyclerView view, RecyclerView.Recycler recycler) &#123;</span><br><span class="line">        super.onDetachedFromWindow(view, recycler);</span><br><span class="line">        if (mRecycleChildrenOnDetach) &#123;</span><br><span class="line">            removeAndRecycleAllViews(recycler);</span><br><span class="line">            recycler.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>注意里面的if分支，如果进入该分支里面的主要逻辑就是会清除掉scrap和cached缓存上的holder并将它们放置到pool中，但是默认情况下mRecycleChildrenOnDetach是为false的，这么设计的目的就在于放置到pool中的holder要想被拿来使用还必须调用onbindview来进行重新绑定数据，所以google默认将该参数设置为了false，这样即使rv会移除屏幕也不会使里面的holder失效，下次再次进入屏幕的时候就可以直接使用避免了onbindview的操作。</p>
<p>但是google还是提供了setRecycleChildrenOnDetach方法允许我们改变它的值，如果要想充分使用pool的功能，最好将其置为true，因为按照一般的用户习惯滑出屏幕的item一般不会回滚查看，这样接下来要被滑入的item如果存在rv的情况下就可以快速复用pool中的holder，这是使用pool复用的时候一个需要注意点的地方。</p>
<h4 id="保存嵌套rv的滑动状态"><a href="#保存嵌套rv的滑动状态" class="headerlink" title="保存嵌套rv的滑动状态"></a>保存嵌套rv的滑动状态</h4><p>原来开发的时候产品就提出过这种需求，需要将滑动位置进行保存，否则每次位置被重置开起来非常奇怪，具体是个什么问题呢，还是以上图嵌套rv为例，红框中的rv可以看出来是滑动到中间位置的，如果这时将该rv移出屏幕，然后再移动回屏幕会发生什么事情，这里要分两种情况，一种是移出屏幕一点后就直接重新移回屏幕，另一种是移出屏幕一段距离再移回来，你会发现一个比较神奇的事就是移出一点回来的rv会保留原先的滑动状态，而移出一大段距离后回来的rv会丢失掉原先的滑动状态，造成这个原因的本质是在于rv的缓存机制，简单来说就是刚滑动屏幕的会被放到cache中而滑出一段距离的会被放到pool中，而从pool中取出的holder会重新进行数据绑定，没有保存滑动状态的话rv就会被重置掉，那么如何才能做到即使放在pool中的holder也能保存滑动状态。</p>
<p>其实这个问题google也替我们考虑到了，linearlayoutmanager中有对应的onSaveInstanceState和onRestoreInstanceState方法来分别处理保存状态和恢复状态，它的机制其实和activity的状态恢复非常类似，我们需要做的就是当rv被移除屏幕调用onSaveInstanceState，移回来时调用onRestoreInstanceState即可。</p>
<p>需要注意点的是onRestoreInstanceState需要传入一个参数parcelable，这个是onSaveInstanceState提供给我们的，parcelable里面就保存了当前的滑动位置信息，如果自己在封装adapter库的时候就需要将这个parcelable保存起来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private Map&lt;Integer, SparseArrayCompat&lt;Parcelable&gt;&gt; states;</span><br></pre></td></tr></table></figure>
<p>map中的key为item对应的position，考虑到一个item中可能嵌套多个rv所以value为SparseArrayCompat，最终的效果</p>
<p><img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_gif/MOu2ZNAwZwPHKG7Ee6AKxj1ichFSy14jb6XoM5laHaiaCfb5BUs0Nn9ia393XYFNbqZAV5x06RJsgZOzxPx53DnvQ/640?wx_fmt=gif" alt="img"></p>
<p>可以看到几个rv在被移出屏幕后再移回来能够正确保存滑动的位置信息，并且在删除其中一个item后states中的信息也能得到同步的更新，更新的实现就是利用rv的registerAdapterDataObserver方法，在adapter调用完notify系列方法后会在对应的回调中响应，对于map的更新操作可以放置到这些回调中进行处理。</p>
<h4 id="视情况设置itemanimator动画"><a href="#视情况设置itemanimator动画" class="headerlink" title="视情况设置itemanimator动画"></a>视情况设置itemanimator动画</h4><p>使用过listview的都知道listview是没有item改变动画效果的，而rv默认就是支持动画效果的，之前说过rv内部源码有1万多行，其实除了rv内部做了大量优化之外，为了支持item的动画效果google也没少下苦功夫，也正是因为这样才使得rv源码看起来非常复杂。默认在开启item动画的情况下会使rv额外处理很多的逻辑判断，notify的增删改操作都会对应相应的item动画效果，所以如果你的应用不需要这些动画效果的话可以直接关闭掉，这样可以在处理增删改操作时大大简化rv的内部逻辑处理，关闭的方法直接调用setItemAnimator(null)即可。</p>
<h4 id="diffutil一个神奇的工具类"><a href="#diffutil一个神奇的工具类" class="headerlink" title="diffutil一个神奇的工具类"></a>diffutil一个神奇的工具类</h4><p>diffutil是配合rv进行差异化比较的工具类，通过对比前后两个data数据集合，diffutil会自动给出一系列的notify操作，避免我们手动调用notifiy的繁琐，看一个简单的使用示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> data = new ArrayList&lt;&gt;();</span><br><span class="line"> data.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello1&quot;));</span><br><span class="line"> data.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello2&quot;));</span><br><span class="line"> data.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello3&quot;));</span><br><span class="line"> data.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello4&quot;));</span><br><span class="line"> data.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello5&quot;));</span><br><span class="line"> data.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello6&quot;));</span><br><span class="line"> data.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello7&quot;));</span><br><span class="line"></span><br><span class="line">newData = new ArrayList&lt;&gt;();</span><br><span class="line"> //改</span><br><span class="line"> newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;new one&quot;));</span><br><span class="line"> newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello2&quot;));</span><br><span class="line"> newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello3&quot;));</span><br><span class="line"> newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello4&quot;));</span><br><span class="line"> //增</span><br><span class="line"> newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;add one&quot;));</span><br><span class="line"> newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello5&quot;));</span><br><span class="line"> newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello6&quot;));</span><br><span class="line"> newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello7&quot;));</span><br></pre></td></tr></table></figure>
<p>先准备两个数据集合分别代表原数据集和最新的数据集,然后实现下Callback接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private class DiffCallBack extends DiffUtil.Callback &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int getOldListSize() &#123;</span><br><span class="line">            return data.size();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int getNewListSize() &#123;</span><br><span class="line">            return newData.size();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean areItemsTheSame(int oldItemPosition, int newItemPosition) &#123;</span><br><span class="line">            return data.get(oldItemPosition).getType() == newData.get(newItemPosition).getType();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean areContentsTheSame(int oldItemPosition, int newItemPosition) &#123;</span><br><span class="line">            String oldStr = (String) DiffUtilDemoActivity.this.data.get(oldItemPosition).getData();</span><br><span class="line">            String newStr = (String) DiffUtilDemoActivity.this.newData.get(newItemPosition).getData();</span><br><span class="line">            return oldStr.equals(newStr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>实现的方法比较容易看懂，diffutil之所以能判断两个数据集的差距就是通过调用上述方法实现，areItemsTheSame表示的就是两个数据集对应position上的itemtype是否一样，areContentsTheSame就是比较在itemtype一致的情况下item中内容是否相同，可以理解成是否需要对item进行局部刷新。实现完callback之后接下来就是如何调用了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DiffUtil.DiffResult diffResult = DiffUtil.calculateDiff(new DiffCallBack(), true);</span><br><span class="line">diffResult.dispatchUpdatesTo(adapter);</span><br><span class="line">adapter.setData(newData);</span><br></pre></td></tr></table></figure>
<p>上述就是diffutil一个简单的代码范例，其实最开始的时候自己想将diffutil封装到adapter库，但实际在使用后发现了几个自认为的弊端，所以放弃使用该工具类，这也可能是自己没有完全掌握diffutil精髓所导致的吧，这里就直接说下我对diffutil使用的看法。</p>
<p>弊端一：<br> 看示例代码应该也能察觉到，要想使用diffutil必须准备两个数据集，这就是一个比较蛋疼的事情，原先我们只需要维护一个数据集就可以，现在就需要我们同时维护两个数据集，两个数据集都需要有一份自己的数据，如果只是简单将数据从一个集合copy到另一个集合是可能会导致问题的，会涉及到对象的深拷贝和浅拷贝问题，你必须保证两份数据集都有各自独立的内存，否则当你修改其中一个数据集可能会造成另一个数据集同时被修改掉的情况。</p>
<p>弊端二：<br> 为了实现callback接口必须实现四个方法，其中areContentsTheSame是最难实现的一个方法，因为这里涉及到对比同type的item内容是否一致，这就需要将该item对应的数据bean进行比较，怎么比较效率会高点，目前能想到的方法就是将bean转换成string通过调用equals方法进行比较，如果item的数据bean对应的成员变量很少如示例所示那倒还好，这也是网上很多推荐diffutil文章避开的问题。但是如果bean对应的成员很多，或者成员变量含有list，里面又包含各种对象元素，想想就知道areContentsTheSame很难去实现，为了引入一个diffutil额外增加这么多的逻辑判断有点得不偿失。</p>
<p>弊端三：<br> diffutil看起来让人捉摸不透的item动画行为，以上面代码为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">        newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello1&quot;));</span><br><span class="line">        newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello2&quot;));</span><br><span class="line">//        newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello3&quot;));</span><br><span class="line">        newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello4&quot;));</span><br><span class="line">        newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello5&quot;));</span><br><span class="line">        newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello6&quot;));</span><br><span class="line">        newData.add(new MultiTypeItem(R.layout.testlayout1, &quot;hello7&quot;));</span><br></pre></td></tr></table></figure>
<p>新的数据集和原有数据集唯一的不同点就在于中间删除了一条数据，按照原先我们对于rv的理解，执行的表现形式应该是hello3被删除掉，然后hello3下面的所有item整体上移才对，但在使用diffutil后你会发现并不是这样的，它的表现比较怪异会移除第一条数据，这种怪异的行为应该和diffutil内部复杂的算法有关。</p>
<p>基于上述几个弊端所以最终自己并没有在adapter库去使用diffutil，比较有意思的是之前在看关于diffutil文章的时候特意留言问过其中一个作者在实际开发中是否有使用过diffutil，得到的答案是并没有在实际项目使用过，所以对于一些工具类是否真的好用还需要实际项目来检验，当然上面所说的都只是我的理解，不排除有人能透彻理解diffutil活用它的开发者，只是我没有在网上找到这种文章。</p>
<h4 id="setHasFixedSize"><a href="#setHasFixedSize" class="headerlink" title="setHasFixedSize"></a>setHasFixedSize</h4><p>又是一个google提供给我们的方法，主要作用就是设置固定高度的rv，避免rv重复measure调用。这个方法可以配合rv的wrap_content属性来使用，比如一个垂直滚动的rv，它的height属性设置为wrap_content，最初的时候数据集data只有3条数据，全部展示出来也不能使rv撑满整个屏幕，如果这时我们通过调用notifyItemRangeInserted增加一条数据，在设置setHasFixedSize和没有设置setHasFixedSize你会发现rv的高度是不一样的，设置过setHasFixedSize属性的rv高度不会改变，而没有设置过则rv会重新measure它的高度，这是setHasFixedSize表现出来的外在形式，我们可以从代码层来找到其中的原因。</p>
<p>notifiy的一系列方法除了notifyDataSetChanged这种万金油的方式，还有一系列进行局部刷新的方法可供调用，而这些方法最终都会执行到一个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void triggerUpdateProcessor() &#123;</span><br><span class="line">            if (POST_UPDATES_ON_ANIMATION &amp;&amp; mHasFixedSize &amp;&amp; mIsAttached) &#123;</span><br><span class="line">                ViewCompat.postOnAnimation(RecyclerView.this, mUpdateChildViewsRunnable);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                mAdapterUpdateDuringMeasure = true;</span><br><span class="line">                requestLayout();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>区别就在于当设置过setHasFixedSize会走if分支，而没有设置则进入到else分支，else分支直接会调用到requestLayout方法，该方法会导致视图树进行重新绘制，onmeasure，onlayout最终都会被执行到，结合这点再来看为什么rv的高度属性为wrap_content时会受到setHasFixedSize影响就很清楚了，根据上述源码可以得到一个优化的地方在于，当item嵌套了rv并且rv没有设置wrap_content属性时，我们可以对该rv设置setHasFixedSize，这么做的一个最大的好处就是嵌套的rv不会触发requestLayout，从而不会导致外层的rv进行重绘，关于这个优化应该很多人都不知道，网上一些介绍setHasFixedSize的文章也并没有提到这点。</p>
<hr>
<p>上面介绍的这些方法都是自己在研究rv优化时自己总结的一些心得，文章到这里其实应该可以结束，但在看源码的过程中还发现了几个比较有意思的方法，现在分享出来</p>
<h4 id="swapadapter"><a href="#swapadapter" class="headerlink" title="swapadapter"></a>swapadapter</h4><p>rv的setadapter大家都会使用，没什么好说的，但关于swapadapter可能就有些人不太知道了，这两个方法最大的不同之处就在于setadapter会直接清空rv上的所有缓存，而swapadapter会将rv上的holder保存到pool中，google提供swapadapter方法考虑到的一个应用场景应该是两个数据源有很大的相似部分的情况下，直接使用setadapter重置的话会导致原本可以被复用的holder全部被清空，而使用swapadapter来代替setadapter可以充分利用rv的缓存机制，可以说是一种更为明智的选择。</p>
<h4 id="getAdapterPosition和getLayoutPosition"><a href="#getAdapterPosition和getLayoutPosition" class="headerlink" title="getAdapterPosition和getLayoutPosition"></a>getAdapterPosition和getLayoutPosition</h4><p>大部分情况下调用这两个方法得到的结果是一致的，都是为了获得holder对应的position位置，但getAdapterPosition获取位置更为及时，而getLayoutPosition会滞后到下一帧才能得到正确的position，如果你想及时得到holder对应的position信息建议使用前者。举个最简单的例子就是当调用完notifyItemRangeInserted在rv头部插入一个item后立即调用这两个方法获取下原先处于第一个位置的position就能立即看出区别，其实跟踪下<br> getAdapterPosition的源码很快能发现原因</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public int applyPendingUpdatesToPosition(int position) &#123;</span><br><span class="line">        final int size = mPendingUpdates.size();</span><br><span class="line">        for (int i = 0; i &lt; size; i++) &#123;</span><br><span class="line">            UpdateOp op = mPendingUpdates.get(i);</span><br><span class="line">            switch (op.cmd) &#123;</span><br><span class="line">                case UpdateOp.ADD:</span><br><span class="line">                    if (op.positionStart &lt;= position) &#123;</span><br><span class="line">                        position += op.itemCount;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case UpdateOp.REMOVE:</span><br><span class="line">                    if (op.positionStart &lt;= position) &#123;</span><br><span class="line">                        final int end = op.positionStart + op.itemCount;</span><br><span class="line">                        if (end &gt; position) &#123;</span><br><span class="line">                            return RecyclerView.NO_POSITION;</span><br><span class="line">                        &#125;</span><br><span class="line">                        position -= op.itemCount;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                case UpdateOp.MOVE:</span><br><span class="line">                    if (op.positionStart == position) &#123;</span><br><span class="line">                        position = op.itemCount; //position end</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        if (op.positionStart &lt; position) &#123;</span><br><span class="line">                            position -= 1;</span><br><span class="line">                        &#125;</span><br><span class="line">                        if (op.itemCount &lt;= position) &#123;</span><br><span class="line">                            position += 1;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return position;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>最终getAdapterPosition会进入到上述方法，在这个方法就能很清楚看出为什么getAdapterPosition总是能及时反应出position的正确位置。但是有一点需要注意的就是getAdapterPosition可能会返回-1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (viewHolder.hasAnyOfTheFlags(ViewHolder.FLAG_INVALID</span><br><span class="line">                | ViewHolder.FLAG_REMOVED | ViewHolder.FLAG_ADAPTER_POSITION_UNKNOWN)</span><br><span class="line">                || !viewHolder.isBound()) &#123;</span><br><span class="line">            return RecyclerView.NO_POSITION;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>这点需要特别留意，做好预防处理。</p>
<h4 id="removeview和detachview"><a href="#removeview和detachview" class="headerlink" title="removeview和detachview"></a>removeview和detachview</h4><p>这两个方法在rv进行排布item的时候会遇到，removeview就是大家很常见的操作，但是detachview就不太常见了，其实removeview是一个更为彻底的移除view操作，内部是会调用到detachview的，并且会调用到我们很熟悉的ondetachfromwindow方法，而detachview是一个轻量级的操作，内部操作就是简单的将该view从父view中移除掉，rv内部调用detachview的场景就是对应被移除的view可能在近期还会被使用到所以采用轻量级的移除操作，removeview一般都预示着这个holder已经彻底从屏幕消失不可见了。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>总算写完了，费了好大力气，写一篇技术文章真的很费时间，这样一直坚持了一年时间，每篇文章都是自己用心去写的，也是对自己之前研究过技术的一个总结。rv确实是一个比较复杂的控件，看源码最好的方式就是基于简单的应用场景切入，然后在此基础上尝试rv的各种方法，带着这些问题去分析源码往往会比干看更有动力。</p>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/05/27/Android开发的一些技术细节/" itemprop="url">
                  Android开发的一些技术细节
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2019-05-27T13:19:12+08:00" content="2019-05-27">
              2019-05-27
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近总结了一些开发中应该注意的技术细节，特此记录下</p>
<ul>
<li><strong>Message obtain跟直接new的区别</strong> ：本质是Message obtain是采用享元模式，所以效率会高一些</li>
<li><strong>Rxjava操作符设计模式</strong> ：看了一下源码其实就是装饰器模式</li>
<li><p><strong>Gson泛型擦除</strong> ：Java泛型的实现机制，使用了泛型的代码在运行期间相关的泛型参数的类型会被擦除，我们无法在运行期间获知泛型参数的具体类型（所有的泛型类型在运行时都是Object类型）<br>意思就是说，我们传入一个泛型T，然后gson在解析的时候，会把泛型参数的类型擦除，那么我们就没办法获得参数的类型了。所以也就报错了，会把List&lt; T &gt; 泛型解析成LinkedTreeMap</p>
</li>
<li><p><strong>线程池如何保证核心线程不被销毁的</strong> ： 大致可以描述为线程池就是用一堆包装住Thread的Wroker类的集合，在里面有条件的进行着死循环，从而可以不断接受任务来进行。</p>
</li>
<li>当有新任务来的时候，先看看当前的线程数有没有超过核心线程数，如果没超过就直接新建一个线程来执行新的任务，如果超过了就看看缓存队列有没有满，没满就将新任务放进缓存队列中，满了就新建一个线程来执行新的任务，如果线程池中的线程数已经达到了指定的最大线程数了，那就根据相应的策略拒绝任务。</li>
<li><p>当缓存队列中的任务都执行完了的时候，线程池中的线程数如果大于核心线程数，就销毁多出来的线程，直到线程池中的线程数等于核心线程数。此时这些线程就不会被销毁了，它们一直处于阻塞状态，等待新的任务到来。</p>
</li>
<li><p><strong>volatile和synchronized区别</strong> ：</p>
</li>
<li>1、volatile不会进行加锁操作<br>volatile变量是一种稍弱的同步机制在访问volatile变量时不会执行加锁操作，因此也就不会使执行线程阻塞，因此volatile变量是一种比synchronized关键字更轻量级的同步机制。</li>
<li>2、volatile变量作用类似于同步变量读写操作<br>从内存可见性的角度看，写入volatile变量相当于退出同步代码块，而读取volatile变量相当于进入同步代码块。</li>
<li>3、volatile不如synchronized安全<br>在代码中如果过度依赖volatile变量来控制状态的可见性，通常会比使用锁的代码更脆弱，也更难以理解。仅当volatile变量能简化代码的实现以及对同步策略的验证时，才应该使用它。一般来说，用同步机制会更安全些。</li>
<li>4、volatile无法同时保证内存可见性和原子性<br>加锁机制（即同步机制）既可以确保可见性又可以确保原子性，而volatile变量只能确保可见性，原因是声明为volatile的简单变量如果当前值与该变量以前的值相关，那么volatile关键字不起作用，也就是说如下的表达式都不是原子操作：“count++”、“count = count+1”。</li>
<li>当且仅当满足以下所有条件时，才应该使用volatile变量：<br>1、 对变量的写入操作不依赖变量的当前值，或者你能确保只有单个线程更新变量的值。<br>2、该变量没有包含在具有其他变量的不变式中。<br>总结：在需要同步的时候，第一选择应该是synchronized关键字，这是最安全的方式，尝试其他任何方式都是有风险的。尤其在、jdK1.5之后，对synchronized同步机制做了很多优化，如：自适应的自旋锁、锁粗化、锁消除、轻量级锁等，使得它的性能明显有了很大的提升。</li>
</ul>
<ul>
<li><strong>HashMap容量为2次幂的原因</strong> ：HashMap为了存取高效，要尽量较少碰撞，就是要尽量把数据分配均匀，每个链表长度大致相同，这个实现就在把数据存到哪个链表中的算法；<br>这个算法实际就是取模，hash%length，计算机中直接求余效率不如位移运算，源码中做了优化hash&amp;(length-1)，<br>hash%length==hash&amp;(length-1)的前提是length是2的n次方；<br>为什么这样能均匀分布减少碰撞呢？2的n次方实际就是1后面n个0，2的n次方-1  实际就是n个1；<br>例如长度为9时候，3&amp;(9-1)=0  2&amp;(9-1)=0 ，都在0上，碰撞了；<br>例如长度为8时候，3&amp;(8-1)=3  2&amp;(8-1)=2 ，不同位置上，不碰撞；<br>其实就是按位“与”的时候，每一位都能  &amp;1  ，也就是和1111……1111111进行与运算</li>
<li><p><strong>从性能层面出发，尽可能直接访问变量而非方法</strong> ：<br>Android开发中，类内尽量避免通过get/set访问成员变量，虽然这在语言的开发中是一个好的习惯，但是Android虚拟机中，对方法的调用开销远大于对变量的直接访问。<br>在没有JIT的情况下，直接的变量访问比调用方法快3倍，<br>在JIT下，直接的变量访问更是比调用方法快7倍!<br>基于现有Java封装思想只写public不符合封装，故依据个人习惯而言，没有强制，不过要尽量避免无用的set方法，个人习惯可以只写get方法，没有用到set的不建议生成。</p>
</li>
<li><p><strong>ButterKnife只需要在Fragment里解绑，Activity不需要</strong> </p>
</li>
</ul>
<hr>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/10/CommonUtils/" itemprop="url">
                  Android工具类常用的几种方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-10T20:17:30+08:00" content="2017-10-10">
              2017-10-10
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1-安装应用APK"><a href="#1-安装应用APK" class="headerlink" title="1.安装应用APK"></a>1.安装应用APK</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> private void installApk(String apkFilePath) &#123;</span><br><span class="line">        File apkfile = new File(apkFilePath);        </span><br><span class="line">        <span class="keyword">if</span> (!apkfile.exists()) &#123;            </span><br><span class="line">            <span class="built_in">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Intent i = new Intent(Intent.ACTION_VIEW);</span><br><span class="line">        i.setDataAndType(Uri.parse(<span class="string">"file://"</span> + apkfile.toString()), <span class="string">"application/vnd.android.package-archive"</span>);</span><br><span class="line">        startActivity(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-MD5算法"><a href="#2-MD5算法" class="headerlink" title="2. MD5算法"></a>2. MD5算法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public final static String MD5(String s) &#123;        </span><br><span class="line">            char hexDigits[] = &#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>&#125;;        </span><br><span class="line">            try &#123;            </span><br><span class="line">            byte[] btInput = s.getBytes();          // 获得MD5摘要算法的 MessageDigest 对象</span><br><span class="line">            MessageDigest mdInst = MessageDigest.getInstance(<span class="string">"MD5"</span>);  // 使用指定的字节更新摘要</span><br><span class="line">            mdInst.update(btInput);                 // 获得密文</span><br><span class="line">            byte[] md = mdInst.digest();            // 把密文转换成十六进制的字符串形式</span><br><span class="line">            int j = md.length;            </span><br><span class="line">            char str[] = new char[j * 2];            </span><br><span class="line">            int k = 0;            //把字节转换成对应的字符串</span><br><span class="line">            <span class="keyword">for</span> (int i = 0; i &lt; j; i++) &#123;                </span><br><span class="line">                byte byte0 = md[i];</span><br><span class="line">                str[k++] = hexDigits[byte0 &gt;&gt;&gt; 4 &amp; 0xf];</span><br><span class="line">                str[k++] = hexDigits[byte0 &amp; 0xf];</span><br><span class="line">            &#125;           </span><br><span class="line">                 <span class="built_in">return</span> new String(str);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();            </span><br><span class="line">                 <span class="built_in">return</span> null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-判断现在是否有网络"><a href="#3-判断现在是否有网络" class="headerlink" title="3. 判断现在是否有网络"></a>3. 判断现在是否有网络</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">private boolean <span class="function"><span class="title">NetWorkStatus</span></span>() &#123;</span><br><span class="line">        ConnectivityManager cwjManager = (ConnectivityManager) getSystemService(Context.CONNECTIVITY_SERVICE);</span><br><span class="line"></span><br><span class="line">        cwjManager.getActiveNetworkInfo();        </span><br><span class="line">        boolean netSataus = <span class="literal">true</span>;        </span><br><span class="line">        <span class="keyword">if</span> (cwjManager.getActiveNetworkInfo() != null) &#123;</span><br><span class="line"></span><br><span class="line">        netSataus = cwjManager.getActiveNetworkInfo().isAvailable();</span><br><span class="line"></span><br><span class="line">        Toast.makeText(this, <span class="string">"网络已经打开"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Builder b = new AlertDialog.Builder(this).setTitle(<span class="string">"没有可用的网络"</span>)</span><br><span class="line">                                        .setMessage(<span class="string">"是否对网络进行设置？"</span>);</span><br><span class="line">        b.setPositiveButton(<span class="string">"是"</span>, new DialogInterface.OnClickListener() </span><br><span class="line">        &#123;    </span><br><span class="line">                public void onClick(DialogInterface dialog, int whichButton) &#123;</span><br><span class="line">                Intent mIntent = new Intent(<span class="string">"/"</span>);</span><br><span class="line">                ComponentName comp = new ComponentName( <span class="string">"com.android.settings"</span>, <span class="string">"com.android.settings.WirelessSettings"</span>);</span><br><span class="line">                mIntent.setComponent(comp);</span><br><span class="line">                mIntent.setAction(<span class="string">"android.intent.action.VIEW"</span>);</span><br><span class="line">                startActivityForResult(mIntent,0); </span><br><span class="line">                &#125;</span><br><span class="line">                &#125;).setNeutralButton(<span class="string">"否"</span>, new DialogInterface.<span class="function"><span class="title">OnClickListener</span></span>() &#123;                        </span><br><span class="line">                public void onClick(DialogInterface dialog, int whichButton) &#123;</span><br><span class="line">                        dialog.cancel();</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;).show();</span><br><span class="line">                &#125;                </span><br><span class="line">                <span class="built_in">return</span> netSataus;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-获取设备屏幕的宽度高度密度"><a href="#4-获取设备屏幕的宽度高度密度" class="headerlink" title="4. 获取设备屏幕的宽度高度密度"></a>4. 获取设备屏幕的宽度高度密度</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public  class   DisplayUtil &#123; </span><br><span class="line">     /**</span><br><span class="line">     * 得到设备屏幕的宽度</span><br><span class="line">     */</span><br><span class="line">    public static int getScreenWidth(Context context) &#123;        </span><br><span class="line">        <span class="built_in">return</span> context.getResources().getDisplayMetrics().widthPixels;</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 得到设备屏幕的高度</span><br><span class="line">     */</span><br><span class="line">    public static int getScreenHeight(Context context) &#123;        </span><br><span class="line">        <span class="built_in">return</span> context.getResources().getDisplayMetrics().heightPixels;</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 得到设备的密度</span><br><span class="line">     */</span><br><span class="line">    public static <span class="built_in">float</span> getScreenDensity(Context context) &#123;        </span><br><span class="line">        <span class="built_in">return</span> context.getResources().getDisplayMetrics().density;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-dp、sp-转换为-px-的工具类"><a href="#5-dp、sp-转换为-px-的工具类" class="headerlink" title="5. dp、sp 转换为 px 的工具类"></a>5. dp、sp 转换为 px 的工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public  class  DisplayUtil &#123;          </span><br><span class="line">    /**</span><br><span class="line">     * 将px值转换为dip或dp值，保证尺寸大小不变</span><br><span class="line">     */</span><br><span class="line">    public static int px2dip(Context context, <span class="built_in">float</span> pxValue) &#123;        </span><br><span class="line">		final <span class="built_in">float</span> scale = context.getResources().getDisplayMetrics().density;        </span><br><span class="line">		<span class="built_in">return</span> (int) (pxValue / scale + 0.5f);</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 将dip或dp值转换为px值，保证尺寸大小不变</span><br><span class="line">     * </span><br><span class="line">     * @param dipValue</span><br><span class="line">     * @param scale</span><br><span class="line">     *            （DisplayMetrics类中属性density）</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static int dip2px(Context context, <span class="built_in">float</span> dipValue) &#123;        </span><br><span class="line">        final <span class="built_in">float</span> scale = context.getResources().getDisplayMetrics().density;        </span><br><span class="line">        <span class="built_in">return</span> (int) (dipValue * scale + 0.5f);</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 将px值转换为sp值，保证文字大小不变</span><br><span class="line">     * </span><br><span class="line">     * @param pxValue</span><br><span class="line">     * @param fontScale</span><br><span class="line">     *            （DisplayMetrics类中属性scaledDensity）</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static int px2sp(Context context, <span class="built_in">float</span> pxValue) &#123;        </span><br><span class="line">        final <span class="built_in">float</span> fontScale = context.getResources().getDisplayMetrics().scaledDensity;        </span><br><span class="line">        <span class="built_in">return</span> (int) (pxValue / fontScale + 0.5f);</span><br><span class="line">    &#125;    /**</span><br><span class="line">     * 将sp值转换为px值，保证文字大小不变</span><br><span class="line">     * </span><br><span class="line">     * @param spValue</span><br><span class="line">     * @param fontScale</span><br><span class="line">     *            （DisplayMetrics类中属性scaledDensity）</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static int sp2px(Context context, <span class="built_in">float</span> spValue) &#123;        </span><br><span class="line">        final <span class="built_in">float</span> fontScale = context.getResources().getDisplayMetrics().scaledDensity;        </span><br><span class="line">        <span class="built_in">return</span> (int) (spValue * fontScale + 0.5f);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-drawable转bitmap的工具类"><a href="#6-drawable转bitmap的工具类" class="headerlink" title="6.drawable转bitmap的工具类"></a>6.drawable转bitmap的工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * drawable转bitmap</span><br><span class="line"> *</span><br><span class="line"> * @param drawable</span><br><span class="line"> * @<span class="built_in">return</span></span><br><span class="line">*/</span><br><span class="line">private Bitmap drawableToBitamp(Drawable drawable) &#123;    </span><br><span class="line">       <span class="keyword">if</span> (null == drawable) &#123;        </span><br><span class="line">       <span class="built_in">return</span> null;</span><br><span class="line">       &#125;<span class="keyword">if</span> (drawable instanceof BitmapDrawable) &#123;</span><br><span class="line">       BitmapDrawable bd = (BitmapDrawable) drawable;        </span><br><span class="line">       <span class="built_in">return</span> bd.getBitmap();</span><br><span class="line">   &#125;    </span><br><span class="line">       int w = drawable.getIntrinsicWidth();    </span><br><span class="line">       int h = drawable.getIntrinsicHeight();</span><br><span class="line">       Bitmap bitmap = Bitmap.createBitmap(w, h, Bitmap.Config.ARGB_8888);</span><br><span class="line">       Canvas canvas = new Canvas(bitmap);</span><br><span class="line">       drawable.setBounds(0, 0, w, h);</span><br><span class="line">       drawable.draw(canvas);    </span><br><span class="line">       <span class="built_in">return</span> bitmap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-文章发布模仿朋友圈时间显示"><a href="#7-文章发布模仿朋友圈时间显示" class="headerlink" title="7.文章发布模仿朋友圈时间显示"></a>7.文章发布模仿朋友圈时间显示</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">public static String ChangeTime(Date time) &#123;</span><br><span class="line">        String ftime = <span class="string">""</span>;</span><br><span class="line">        Calendar cal = Calendar.getInstance();        // 判断是否是同一天</span><br><span class="line">        String curDate = dateFormater2.get().format(cal.getTime());</span><br><span class="line">        String paramDate = dateFormater2.get().format(time);        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (curDate.equals(paramDate)) &#123;            </span><br><span class="line"></span><br><span class="line">    int hour = (int) ((cal.getTimeInMillis() - time.getTime()) / 3600000);            </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hour == 0)</span><br><span class="line">                ftime = Math.max(</span><br><span class="line">                        (cal.getTimeInMillis() - time.getTime()) / 60000, 1)</span><br><span class="line">                        + <span class="string">"分钟前"</span>;            </span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                ftime = hour + <span class="string">"小时前"</span>;            </span><br><span class="line"></span><br><span class="line">            <span class="built_in">return</span> ftime;</span><br><span class="line">        &#125;        long lt = time.getTime() / 86400000;        </span><br><span class="line"></span><br><span class="line">            long ct = cal.getTimeInMillis() / 86400000;        </span><br><span class="line"></span><br><span class="line">            int days = (int) (ct - lt);        </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (days == 0) &#123;            </span><br><span class="line"></span><br><span class="line">            int hour = (int) ((cal.getTimeInMillis() - time.getTime()) / 3600000);            </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (hour == 0)</span><br><span class="line">            ftime = Math.max( (cal.getTimeInMillis() - time.getTime()) / 60000, 1)</span><br><span class="line">                        + <span class="string">"分钟前"</span>;           </span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                ftime = hour + <span class="string">"小时前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days == 1) &#123;</span><br><span class="line">            ftime = <span class="string">"昨天"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days == 2) &#123;</span><br><span class="line">            ftime = <span class="string">"前天 "</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 2 &amp;&amp; days &lt; 31) &#123;</span><br><span class="line">            ftime = days + <span class="string">"天前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt;= 31 &amp;&amp; days &lt;= 2 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"一个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 2 * 31 &amp;&amp; days &lt;= 3 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"2个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 3 * 31 &amp;&amp; days &lt;= 4 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"3个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ftime = dateFormater2.get().format(time);</span><br><span class="line">        &#125;        <span class="built_in">return</span> ftime;</span><br><span class="line">    &#125;    public static String friendly_time(String sdate) &#123;</span><br><span class="line">        Date time = null;        </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (TimeZoneUtil.isInEasternEightZones())</span><br><span class="line">            time = toDate(sdate);        <span class="keyword">else</span></span><br><span class="line">            time = TimeZoneUtil.transformTime(toDate(sdate),</span><br><span class="line">                    TimeZone.getTimeZone(<span class="string">"GMT+08"</span>), TimeZone.getDefault());        </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (time == null) &#123;            </span><br><span class="line"></span><br><span class="line">            <span class="built_in">return</span> <span class="string">"Unknown"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String ftime = <span class="string">""</span>;</span><br><span class="line">        Calendar cal = Calendar.getInstance();        // 判断是否是同一天</span><br><span class="line">        String curDate = dateFormater2.get().format(cal.getTime());</span><br><span class="line">        String paramDate = dateFormater2.get().format(time);        </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (curDate.equals(paramDate)) &#123;            </span><br><span class="line"></span><br><span class="line">            int hour = (int) ((cal.getTimeInMillis() - time.getTime()) / 3600000);            </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (hour == 0)</span><br><span class="line">                ftime = Math.max(</span><br><span class="line">                        (cal.getTimeInMillis() - time.getTime()) / 60000, 1)</span><br><span class="line">                        + <span class="string">"分钟前"</span>;           </span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                ftime = hour + <span class="string">"小时前"</span>;            </span><br><span class="line"></span><br><span class="line">             <span class="built_in">return</span> ftime;</span><br><span class="line">        &#125;        long lt = time.getTime() / 86400000;        </span><br><span class="line"></span><br><span class="line">             long ct = cal.getTimeInMillis() / 86400000;        </span><br><span class="line"></span><br><span class="line">             int days = (int) (ct - lt);        </span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (days == 0) &#123;            </span><br><span class="line"></span><br><span class="line">             int hour = (int) ((cal.getTimeInMillis() - time.getTime()) / 3600000);            </span><br><span class="line"></span><br><span class="line">             <span class="keyword">if</span> (hour == 0)</span><br><span class="line">                ftime = Math.max(</span><br><span class="line">                        (cal.getTimeInMillis() - time.getTime()) / 60000, 1)</span><br><span class="line">                        + <span class="string">"分钟前"</span>;           </span><br><span class="line"></span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                ftime = hour + <span class="string">"小时前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days == 1) &#123;</span><br><span class="line">            ftime = <span class="string">"昨天"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days == 2) &#123;</span><br><span class="line">            ftime = <span class="string">"前天 "</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 2 &amp;&amp; days &lt; 31) &#123;</span><br><span class="line">            ftime = days + <span class="string">"天前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt;= 31 &amp;&amp; days &lt;= 2 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"一个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 2 * 31 &amp;&amp; days &lt;= 3 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"2个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (days &gt; 3 * 31 &amp;&amp; days &lt;= 4 * 31) &#123;</span><br><span class="line">            ftime = <span class="string">"3个月前"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ftime = dateFormater2.get().format(time);</span><br><span class="line">        &#125;        <span class="built_in">return</span> ftime;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="8-时间格式转换工具类"><a href="#8-时间格式转换工具类" class="headerlink" title="8.时间格式转换工具类"></a>8.时间格式转换工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static String ConverToString(Date date) &#123;</span><br><span class="line">        DateFormat df = new SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);        </span><br><span class="line">        <span class="built_in">return</span> df.format(date);</span><br><span class="line">    &#125;    </span><br><span class="line">        public static String ConverToString2(Date date)&#123;</span><br><span class="line">        DateFormat df = new SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm"</span>);        </span><br><span class="line">        <span class="built_in">return</span> df.format(date);</span><br><span class="line">    &#125;    </span><br><span class="line">        public static String ConverToString3(Date date)&#123;</span><br><span class="line">        DateFormat df = new SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);        </span><br><span class="line">        <span class="built_in">return</span> df.format(date);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-验证码倒计时工具类"><a href="#9-验证码倒计时工具类" class="headerlink" title="9.验证码倒计时工具类"></a>9.验证码倒计时工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">	public class TimeCount extends CountDownTimer &#123;    </span><br><span class="line">    private Button button;    /**</span><br><span class="line">     * 到计时</span><br><span class="line">     * @param millisInFuture  到计时多久,毫秒</span><br><span class="line">     * @param countDownInterval 周期</span><br><span class="line">     * @param button   按钮</span><br><span class="line">     */</span><br><span class="line">    public TimeCount(long millisInFuture, long countDownInterval,Button button) &#123;        </span><br><span class="line">    super(millisInFuture, countDownInterval);        </span><br><span class="line">    this.button =button;</span><br><span class="line">    &#125;    </span><br><span class="line">    public TimeCount(long millisInFuture, long countDownInterval) &#123;        </span><br><span class="line">    super(millisInFuture, countDownInterval);</span><br><span class="line">    &#125;    </span><br><span class="line">    @Override</span><br><span class="line">    public void <span class="function"><span class="title">onFinish</span></span>() &#123;// 计时完毕</span><br><span class="line">        button.setText(<span class="string">"获取验证码"</span>);</span><br><span class="line">        button.setClickable(<span class="literal">true</span>);</span><br><span class="line">        button.setBackground(MyApplication.getContext().getResources().getDrawable(R.drawable.radius14));</span><br><span class="line">    &#125;   </span><br><span class="line">     @Override</span><br><span class="line">    public void onTick(long millisUntilFinished) &#123;// 计时过程</span><br><span class="line">        button.setClickable(<span class="literal">false</span>);//防止重复点击</span><br><span class="line">        button.setText(millisUntilFinished / 1000 + <span class="string">"s后重试"</span>);</span><br><span class="line">        button.setBackground(MyApplication.getContext().getResources().getDrawable(R.drawable.radius_gray));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="10-屏幕截图工具类"><a href="#10-屏幕截图工具类" class="headerlink" title="10.屏幕截图工具类"></a>10.屏幕截图工具类</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">	public class ScreenShot &#123;</span><br><span class="line">	    </span><br><span class="line">	public static void shoot(Activity a, File filePath) &#123;        </span><br><span class="line">    <span class="keyword">if</span> (filePath == null) &#123;            </span><br><span class="line">        <span class="built_in">return</span>;</span><br><span class="line">        &#125;        </span><br><span class="line">    <span class="keyword">if</span> (!filePath.getParentFile().exists()) &#123;</span><br><span class="line">            filePath.getParentFile().mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        FileOutputStream fos = null;        </span><br><span class="line">    try &#123;</span><br><span class="line">            fos = new FileOutputStream(filePath);            </span><br><span class="line">    <span class="keyword">if</span> (null != fos) &#123;</span><br><span class="line">                takeScreenShot(a).compress(Bitmap.CompressFormat.PNG, 100, fos);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;            </span><br><span class="line">    <span class="keyword">if</span> (fos != null) &#123;                </span><br><span class="line">    try &#123;</span><br><span class="line">                    fos.flush();</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    private static Bitmap takeScreenShot(Activity activity) &#123;</span><br><span class="line">        View view = activity.getWindow().getDecorView();</span><br><span class="line">        view.setDrawingCacheEnabled(<span class="literal">true</span>);</span><br><span class="line">        view.buildDrawingCache();</span><br><span class="line">        Bitmap bitmap = view.getDrawingCache();</span><br><span class="line">        Rect frame = new Rect();</span><br><span class="line">        activity.getWindow().getDecorView().getWindowVisibleDisplayFrame(frame);        </span><br><span class="line">        int statusBarHeight = frame.top;        </span><br><span class="line">        int width = activity.getWindowManager().getDefaultDisplay().getWidth();        </span><br><span class="line">        int height = activity.getWindowManager().getDefaultDisplay()</span><br><span class="line">                .getHeight();        //去掉标题栏</span><br><span class="line">        Bitmap b = Bitmap.createBitmap(bitmap, 0, statusBarHeight, width,</span><br><span class="line">                height - statusBarHeight);</span><br><span class="line">        view.destroyDrawingCache();        </span><br><span class="line">        <span class="built_in">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/06/job/" itemprop="url">
                  2017年Android曲折的求职之路
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-06T18:12:35+08:00" content="2017-06-06">
              2017-06-06
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="本人近况"><a href="#本人近况" class="headerlink" title="本人近况"></a>本人近况</h1><p>先说下博主最近近况，5月底毅然离职没想到目前市场这么萧条，怪自己太作，有好的机会不好好把握，非得出来受虐哈，人都是犯贱的……所以目前整理几家去过的公司以免以后被坑。</p>
<h2 id="金开门（好贷网旗下孵化创业公司）"><a href="#金开门（好贷网旗下孵化创业公司）" class="headerlink" title="金开门（好贷网旗下孵化创业公司）"></a>金开门（好贷网旗下孵化创业公司）</h2><blockquote>
<p>这公司是在BOSS直聘上投的<br>总体面试还算不错吧Android技术那面一般也不会问特别深主要是最新的主流技术一般会问下，还有就是之前的项目会大致问一下<br>接下来是总监面，总监是个蛮不错的人，满有亲和力的，大概就是聊推送这一块的，还有支付，因为这公司主要业务是聚合支付相关的，总体还OK<br>接着是HR 谈薪水还有介绍公司近况，貌似最近一直是995的节奏<br>最后是大Boss面貌似很屌的说了一句目前我们就是996的节奏（应该是试探我的），我觉得跟他也没啥好谈，他一幅咄咄逼人的气势，由于他比较强势，我又不妥协，所以就没有后续了…</p>
</blockquote>
<h2 id="音悦台"><a href="#音悦台" class="headerlink" title="音悦台"></a>音悦台</h2><blockquote>
<p>这个也是在Boss直聘上约的，公司就在三里屯SOHO<br>公司主要业务主打MV的剩下的我就不多说了，前几年业务还是挺火的</p>
<p>HR人还是很不错的，公司的环境神马的都没得说，妹子也多╮(╯_╰)╭没给offer确实感觉挺遗憾的</p>
<p>首先光技术面问的就蛮深入的，基本最近貌似招人都比较苛刻~多线程，线程池，handler，Looper源码层，activity源码，四种启动模式，生命周期，View的绘制流程，自定义view，手势传递问的最复杂也最多<br>还有一些开源项目相关的问题吧 okhttp，glide，eventbus相关的</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">但是特么的这个面完之后就没有然后了，估计是薪资没谈拢？</span><br><span class="line">只说按公司流程来说还要有次复试，</span><br><span class="line">HR说下周一大概会通知结果，也确实通知了（比较少有的有职业素质的公司吧）</span><br></pre></td></tr></table></figure>
<h2 id="1905电影网"><a href="#1905电影网" class="headerlink" title="1905电影网"></a>1905电影网</h2><blockquote>
<p>这个是在拉勾上投的，公司在西直门<br>我敢说这个面试官是这么多年我遇到的最能装逼一个，当然人家技术也蛮不错的，你不会的，遇到问题的，人家也耐心给你讲解哟，无形装逼，最为致命啊！如果你技术不是很好的话千万不要去这家公司找虐</p>
<p>博主之前有个朋友也来过这家面试，貌似最后给说开不了他的工资，还跟他说来面试很多<br>给我种感觉 就是面试造核弹，工作拧螺丝？最后还问了我项目里有啥亮点<br>问题蛮多的好多都忘了，大致记住几个</p>
</blockquote>
<p>Glide ，Picasso都分别有几个线程池<br>Asynctask 源码，为什么android4.0以后是串行</p>
<p>OnMeasure 方法几个参数对应含义（这个题问的最多的所以我把答案贴上O(∩_∩)O~</p>
<p>首先我们要理解的是widthMeasureSpec, heightMeasureSpec这两个参数是从哪里来的？onMeasure()函数由包含这个View的具体的ViewGroup调用，因此值也是从这个ViewGroup中传入的。这里我直接给出答案：子类View的这两个参数，由ViewGroup中的layout_width，layout_height和padding以及View自身的layout_margin共同决定。权值weight也是尤其需要考虑的因素，有它的存在情况可能会稍微复杂点。<br>了解了这两个参数的来源，还要知道这两个值的作用。我们只取heightMeasureSpec作说明。这个值由高32位和低16位组成，高32位保存的值叫specMode，可以通过如代码中所示的MeasureSpec.getMode()获取；低16位为specSize，同样可以由MeasureSpec.getSize()获取。那么specMode和specSize的作用有是什么呢？要想知道这一点，我们需要知道代码中的最后一行，所有的View的onMeasure()的最后一行都会调用setMeasureDimension()函数的作用——这个函数调用中传进去的值是View最终的视图大小。也就是说onMeasure()中之前所作的所有工作都是为了最后这一句话服务的。</p>
<p>我们知道在ViewGroup中，给View分配的空间大小并不是确定的，有可能随着具体的变化而变化，而这个变化的条件就是传到specMode中决定的，specMode一共有三种可能：</p>
<p>MeasureSpec.EXACTLY：父视图希望子视图的大小应该是specSize中指定的。</p>
<p>MeasureSpec.AT_MOST：子视图的大小最多是specSize中指定的值，也就是说不建议子视图的大小超过specSize中给定的值。</p>
<p>MeasureSpec.UNSPECIFIED：我们可以随意指定视图的大小。)</p>
<p>广播怎么不跨进程<br>Rxjava 操作符<br>Rxjava 1 2的区别<br>还有问了轮播怎么让用户按下三秒之后继续翻页<br>还有五种进程级别<br>多线程下载，3个线程如何下载10M的文件<br>两列Recyclerview 如果是表格布局怎么添加header view<br>Thread 和intent service </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">最牛B的一个问题是类似天猫这种大厂APP实现的全局应用代理是怎么实现的</span><br><span class="line">（本意就是类似于推送的时候处理推送的逻辑不写一大堆switch case，而是在入口处动态去配置就可以）</span><br></pre></td></tr></table></figure>
<h2 id="凡普金科（普惠金融旗下）"><a href="#凡普金科（普惠金融旗下）" class="headerlink" title="凡普金科（普惠金融旗下）"></a>凡普金科（普惠金融旗下）</h2><blockquote>
<p>这个是在拉勾上投的，公司在银河SOHO<br>当时面试地点其实是发的有问题的，前台大门明明在A座嘛，你非得发个D座那边的位置，结果那边的门锁了，我敲了半天才有人开，我才知道走错门了应该从A座的电梯上来，可是就是发的D座，这里吐槽下。。。然后前台妹子给我的笔试题居然是Java的（貌似给错了）</p>
<p>面试的深度基本跟1905那哥们差不多，也是activity启动模式跟手势传递还有Looper的源码那块问的比较多只是这个人最后问了一个尺子的效果：附上项目地址哈<br><a href="https://github.com/kailaisi/WheelSelect" target="_blank" rel="noopener">https://github.com/kailaisi/WheelSelect</a><br>类似这个地址demo的实现效果只是年龄换成了金额（毕竟是做金融的公司 当然这样咯）</p>
<p>只说还有复试，但是也是没下文了 ~~o(&gt;_&lt;)o ~~</p>
</blockquote>
<h2 id="映社（木蚂蚁）"><a href="#映社（木蚂蚁）" class="headerlink" title="映社（木蚂蚁）"></a>映社（木蚂蚁）</h2><blockquote>
<p>这个公司绝对是坑比中的战斗机，去了就让你一直等啊等，等到花都谢了的那种<br>PS：他们现在的项目主要是做直播的产品叫“映社”（有种抄袭映客的嫌疑~~）<br>去的时候公司前台都没人，打电话也没人接，后来一个快递小哥进门了我和另外的一个也是面试的才进去</p>
<p>首先是有笔试题的话说蛮弱智的（做完感觉也不会怎么看，完全就是浪费时间啊啊）然后那哥们把你领到一个类似小会议室的屋子里，这哥们给人的感觉技术也很一般，没有之前面的那么强势，基本都是照着简历问的，问直播跟FFmpeg那块偏多，贝塞尔曲线？自定义View，偶尔穿插下retrofit，Rxjava，热修复神马的，面完之后就出去了让你一直等啊等，等了快40分钟的时候进来说总监在开会<br>这个公司真特么的是个奇葩，你约人的时候不会挑个没会的时间么，貌似拉勾上有个面php的哥们跟我一样也是被搁置一直等啊等，真是日了狗了！最后来了一句改天复试吧</p>
<p>只说还有复试，让我来我也不会来了。。。</p>
</blockquote>
<h2 id="Melons-北京知行远科技"><a href="#Melons-北京知行远科技" class="headerlink" title="Melons(北京知行远科技)"></a>Melons(北京知行远科技)</h2><blockquote>
<p>这家公司是我在拉勾上投的，公司成立于2016年太初创了（我能怎么办，我也很绝望啊，貌似最近拉勾的公司比较少，稀里糊涂就投了╮(╯▽╰)╭）<br>Boss也是做android的，而且还是前最美应用的联合创始人，技术出身还是蛮不错的公司早10晚8做海外项目</p>
<p>但是目前的状况是跟别人挤在一间办公室里，那个隔壁组的貌似是Google天气的团队。。。</p>
<p>技术面还是跟之前的那几家差不多，基本都不会看你做过的项目就咔咔的问底层源码咯，唯一不同的是启动模式那块多问了taskAffinity这个属性，我确实是没用过，面试官拿着macbook一个一个的循序渐进的问着，面试流程大概一个半小时左右，然后跟boss聊了聊薪资和之前为什么离职，因为是早上十点半约的，一直聊到了中午12点40多</p>
<p>我中午饭都没吃，然后紧接着就去中关村准备下午那家的面试</p>
<p>PS:今天还下着雨，挺苦逼的。。。</p>
<p>目测不会发offer，可能是小公司给不起薪资。。。</p>
</blockquote>
<h2 id="NewsDog-公司名字就叫这个薪资标的还挺高"><a href="#NewsDog-公司名字就叫这个薪资标的还挺高" class="headerlink" title="NewsDog(公司名字就叫这个薪资标的还挺高)"></a>NewsDog(公司名字就叫这个薪资标的还挺高)</h2><blockquote>
<p>这家公司是我在拉勾上投的，公司应该是B轮了已经<br>因为是约的是下午两点，而且刚从Melons那里面完就来了，所以去这家公司的时候连中午饭都没吃，让前台给接了杯水暂时压压惊。。。</p>
<p>看简介公司应该是做海外市场主要是信息推荐跟数据挖掘的业务（不知道他们现在的产品是啥）</p>
<p>技术面主要是根据简历去问的，比较在意内存泄漏，内存优化还有View的过渡绘制这一块的东西，还有就是问了问图片开源库Picasso v/s Imageloader v/s Fresco vs Glide 区别以及如何去选择吧，还有eventbus的源码以及注解的优点，其它的大概就是还问了问项目的难点之类的</p>
<p>比较操蛋的是没有讨论薪资，然后就直接送客了，不造差在哪里。。。</p>
</blockquote>
<h2 id="曙光无限"><a href="#曙光无限" class="headerlink" title="曙光无限"></a>曙光无限</h2><p><strong>曙光无限</strong>这家公司是在boss上约的，公司地址在回龙观东大街的腾讯众创空间（办公楼的环境蛮好的），公司主打产品是海外的项目，旗下产品几十种还是蛮多的</p>
<ul>
<li><strong>第一面</strong> ：只是人事先照着简历初略的聊了聊以前的项目经验，由于公司是做海外滤镜软件的，可能对图片算法这块要求蛮高的，福利这块目前是采取接近避税的方式，第一年还不给交住房公积金，貌似还需要第二面总监面，而且还要上机写demo…</li>
<li><strong>目前android行情</strong> ：从以往的面试分析来看基本android的行情接近饱和状态，薪资这块基本稍微要高点的话直接就给你pass然后可能用其它人候选人去对比，市场的行情还真是惨淡</li>
<li><strong>后续</strong> ：没有通知进一步的面试~~~~ HR先面的公司一般都会要求复试各位如果考虑时间成本的话要慎重去这种公司。。。。</li>
</ul>
<hr>
<h2 id="遇见科技"><a href="#遇见科技" class="headerlink" title="遇见科技"></a>遇见科技</h2><p><strong>遇见科技</strong>这家公司是在boss上约的，公司地址在知春路附近，公司的办公环境也还不错哈，项目应该是一款社交软件，貌似起步还是蛮早的，已经做了几年了</p>
<ul>
<li><strong>第一面</strong> ：主要是技术面，问的以简历的内容为主还有面试官会看以往做过的项目（现在看项目的公司确实不多了）比较在意的是之前做过的项目整体的流程，整体架构设计模式还有业务这块的详情，基本都是围绕做的项目这块的技术点来的涉及的知识点也基本涵盖了目前比较流行的开源组件，还有会问一些关于同类框架之前的区别与对比：比如volley与okhttp，图片框架，数据库greenDao，realm，litepal等等性能方面的问题</li>
<li><strong>第二面</strong> ：第一面没什么问题之后会和HR进一步沟通，主要介绍了公司目前的产品方向还有项目节奏，福利待遇神马之类的</li>
<li><strong>总监面</strong> ：能见到总监也基本很不容易了，基本也是聊了聊以往的项目，可能比较看重的是解决问题的能力，会问擅长哪方面（Ui还是业务？）项目难点等等。。。</li>
<li><strong>后续</strong> ：没有通知是否给offer（难道是薪资问题？？现在市场要到20K左右貌似就要考虑考虑了）</li>
</ul>
<hr>
<h2 id="邻动"><a href="#邻动" class="headerlink" title="邻动"></a>邻动</h2><p><strong>邻动</strong> 这家公司是在boss上约的，公司地址也是在知春路附近，公司的办公环境没的说，门口摆着各种零食饮料，面试等待的过程，前台妹子还给了一杯饮料喝O(∩_∩)O~，公司主要做视频方向的项目，目前已知产品叫“快牙”</p>
<ul>
<li><strong>第一面</strong> ：主要是技术面，基本问的跟之前遇到的问题一样，其中回答的不是很好的问题户要是MessageQue的源码实现（我回答错了，应该是链表）还有自定义线程池（应该是问线程池那几个参数），但是公司的技术要求可能希望更倾向于有FFmpeg相关经验还有做过视频剪切，裁剪之类的经验吧，问完就送客了….内心其实还是挺喜欢做视频这块的项目(⊙﹏⊙)b</li>
</ul>
<blockquote>
<p>感觉问到的问题除了那两块其他的回答还是蛮好的，尼玛心累</p>
</blockquote>
<hr>
<h2 id="元宝亿家"><a href="#元宝亿家" class="headerlink" title="元宝亿家"></a>元宝亿家</h2><p><strong>元宝亿家</strong> 这家公司是在boss上约的，公司地址在东直门，去了直接在前台填表，然后一个目测像总监的人直接面试，他们现在的项目是采用MVP写的应该是想找个人快速接手</p>
<ul>
<li><strong>第一面</strong> ：主要是技术面，问的东西感觉还好，但是感觉自己发挥的不是很好，Java String类的底层源码（其实就是char数组），Hashmap实现原理，Android 广播 Service相关的，ANR，gson高级用法（比如序列化的时候如何排除某个字段），项目里用到的设计模式，android手势机制用到了什么设计模式（是责任链模式，这个我回答错了），内存泄漏和内存溢出，子线程不能更新view的机制，Rxjava retrofit okhttp，给我印象比较深的是问了mac上pwd这个命令是干嘛的（我用了这么久mac确实没有用过这个命令，是显示当前文件全路径的）还有用没用过Home brew，最后问了问Git相关的命令pull跟fetch</li>
<li>git rm a.a 移除文件(从暂存区和工作区中删除)</li>
<li><p>git rm –cached a.a 移除文件(只从暂存区中删除)</p>
</li>
<li><p>PS:技术很耐心的给我讲解了我没能答对的问题</p>
</li>
<li><p><strong>总结</strong> ：感觉自己跟目前市场上需求真正意义的Android高级工程职位还是有一定差距的，好多东西还是欠缺好多，还要继续恶补了，fighting…</p>
<blockquote>
<p>约了第二天复试，信心严重受挫，不知道能不能谈拢…<br>复试完结在考虑是否过去…</p>
</blockquote>
</li>
</ul>
<hr>
<h2 id="最近面试的几家公司"><a href="#最近面试的几家公司" class="headerlink" title="最近面试的几家公司"></a>最近面试的几家公司</h2><p>这周面的几家公司相对来说都比较正常了没有过多的问源码，基本都是看简历然后以往的项目经验，基本能把以前问过的东西能正确的说出来再面的别的公司也基本OK…</p>
<p><strong>苏宁体育</strong> 这家公司是在boss上约的，公司地址望京锐创国际，去了直接在前台填表，然后有个笔试题（还蛮简单的，主要是写一个单例，多态）,填完就一直等，因为面Android的在排队，然后等了快半个小时，来了两个人面的一个是Android,另外一个是一个女的项目负责人。。。</p>
<ul>
<li><p>总体的面试感觉还OK，因为是做体育类视频项目的，会要求多一些FFmpeg的技能。。。公司会比较在意这一块的想来面试的建议先把这部分摸清，否则人家都不会往深层次的提问，就算问了也接不上哦~</p>
</li>
<li><p>薪资我只奢求不低于之前在信和的待遇，估计按现在的行情很难啊,有种想回原来公司的冲动~~o(&gt;_&lt;)o ~~。。。大的环境冒险离职真的很危险啊，出来都要降薪了，现在这个时间段确实不适合找工作，希望有离职想法的兄弟别冲动….</p>
</li>
</ul>
<p><strong>新娱时代</strong> 这家公司都忘了是哪个大兄弟帮我推的，公司原来是在魏公村，现在搬到了中关村的鼎好电子城写字楼，去的时候还一直在装修，面试的地方极其简陋，因为是内推的技术这块基本就大致聊聊，感觉薪资也是给不到。。而且目前公司还是996的节奏，做海外直播，貌似项目还蛮多的工作强度很大。。。</p>
<ul>
<li>目前他们公司的项目是采用MVP写的，不理解的是为什么项目还用比较陈旧的Volley作为请求框架…</li>
</ul>
<p><strong>半糖</strong> 这家公司是一个非常好的哥们推给他们公司的php的童鞋然后帮我推的，公司在雍和宫的一个胡同里，非常有文艺气息，来到公司首先要填表然后还要填一份性格测试，之后来的面试官也非常的有亲和力，基本都在聊以往互相的项目经验之类的，面试官做Android也蛮久了可能比较保守，自己公司的产品并木有用到最新比较主流的技术框架，应该是考虑项目稳定吧，但是我感觉也太保守了，公司的产品做了三年按他的话来说就是迭代的时间太紧张，基本没有重构的时间就开始做下个版本了，我觉得还是应该搞一搞技术变革的，肯定能提升团队整体的效率，并跟他推荐了一个蛮好用的插件jrebel for android…</p>
<ul>
<li><p>这里安利几个本人一直在用的比较好用库  </p>
</li>
<li><p>下拉刷新&amp;滚动到底部加载更多 <a href="https://github.com/MIkeeJY/demo-1" target="_blank" rel="noopener">https://github.com/MIkeeJY/demo-1</a></p>
</li>
<li><p>这个项目是由一个CSDN大神叫Li Hong修改自PulltoRefresh那个库而来，基本做到了View的分离，用法也比较简单就是直接把拓展的控件放进去，理论上支持所有的View的下拉，需要注意的是这个库只实现了listview的加载更多，recyclerview需要自己拓展</p>
</li>
<li><p><a href="https://github.com/ybq/Endless-RecyclerView" target="_blank" rel="noopener">https://github.com/ybq/Endless-RecyclerView</a> 这个库实现了recyclerview的加载更多配合上面的下拉刷新控件对比别的recyclerview的扩展，这个是代码量最少最简单且bug比较少的，其它类似的扩展大概就是用装饰器模式去封装recyclerview的adapter咯~</p>
</li>
<li><a href="https://github.com/MIkeeJY/OkHttpUtils-2" target="_blank" rel="noopener">https://github.com/MIkeeJY/OkHttpUtils-2</a> 自用Okhttp封装，参考了鸿洋大神Okhttp2.x版本的封装，采用纯Okhttp实现，基本能满足所有的网络请求</li>
<li>Glide封装可以参考 <a href="https://github.com/whyalwaysmea/BigBoom" target="_blank" rel="noopener">https://github.com/whyalwaysmea/BigBoom</a> 这个项目中抽出接口的方式</li>
<li><a href="https://github.com/jinloong/BannerLayout" target="_blank" rel="noopener">https://github.com/jinloong/BannerLayout</a> 虽然star不多但是用起来非常稳定的一个轮播库（比较冷门，相反star数多的库反而各种bug,(⊙﹏⊙)b）</li>
</ul>
<p><strong>总结</strong> ：面试也是一个不断总结跟学习的过程，可能拿到合适的offer还需要一些运气的成份，我始终坚信就算大的环境再不好，但是其实整个行业还是缺牛人的！一时的不景气并不会影响真正技术好的人，博主已经入职了，祝大家好运~</p>
<p><strong>PS</strong> ：首先写这篇文章的目的不在于针对某某公司，这个选择都是双向的，大家谁都不欠谁，只是想把遇到的公司做一个总结展示给大家看，供大家以后求职时候的参考，在于告诫大家如果没什么想不开的千万不要在这个时候离职，比较目前环境可以说是非常的严峻，离职要慎重！！！离职要慎重！！！离职要慎重！！！重要的事情说三遍~！如果有针对某些公司负能量的言语，可能言语过激，希望大家能及时指出，我会及时修改，目测应该还有人对我的技术做出了评价，我也承认目前跟真正的Android高级是有差距的（但是毕竟还是有些技术实力的，15年面过腾讯，优酷，16年面了Apus都拿到了offer，只是我当时想法太年轻没去而已），但是目前Android层的东西还是蛮杂的，我也不可能什么都会，目前已经拿到几家offer也已经做出选择了，这里记录下辛酸的面试历程吧~</p>
<hr>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/11/camera/" itemprop="url">
                  关于调用系统照相机Activity被销毁问题解决
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-11T17:08:26+08:00" content="2016-05-11">
              2016-05-11
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在项目中需要启用系统照相机来拍照。本来很容易的一个问题。但在适配中出现了问题。<br>简单说一下问题：<br>    有些手机拍照成功，有些手机拍完照后确定返回后activity数据丢失，被销毁了。<br>问题查找：<br>    经过代码查找发现，当这些出问题的手机被调用系统手机拍照时，当前activity被销毁了之后又被重新创建了。即Acitivity 执行了ondestory()–&gt;onCreate()，所以Activity被重新创建了从而内部的数据丢失,而按照正常的逻辑该Activity应该入后台堆栈。一开始以为是系统启用照相机内存不够自动销毁回收。可有些手机不会出现该问题。很无奈。<br>    之后经过本人细心研究activity的生命周期才恍然大悟，原来当手机横竖屏时系统会重新创建一个activity，这就是为什么上个activity会ondestory()–&gt;onCreate()。但为什么有些手机会执行有些不会呢。问题就出在横竖屏上。因为有些手机的系统照相机弄的很炫会自动旋转90度，从而导致了横竖屏的发生（–！看来最潮的也不是好东西，苦了我们这些碼农）。这就是为什有些手机会发生有些不会。跟系统照相机是否旋转有关系。<br>    最后贴上解决方案。<br>    AndroidMainifest.xml中加入</p>
<pre><code>&lt;activity
            android:name=&quot;.Activity&quot;
            android:launchMode=&quot;singleTask&quot;          
            android:configChanges=&quot;orientation|keyboardHidden&quot;                       
            android:theme=&quot;@android:style/Theme.Black.NoTitleBar.Fullscreen&quot;/&gt;
</code></pre><pre><code>@Override
public void onConfigurationChanged(Configuration newConfig) {
    //其实这里什么都不要做
    super.onConfigurationChanged(newConfig);
}
</code></pre><h6 id="PS-在level13以后加入了一个screenSize的属性，这个属性很重要如果在android3-2以后的版本中没有添加”screenSize”的话依然会触发横竖屏activity销毁周期-也就是说不能屏蔽activity销毁，从而调用onConfigurationChanged方法，而在3-2之前只要设置orientation-keyboardHidden就可以-。由于智能机的迅速普及手机的系统大多数升级到4-0以上，这样会导致很多没有设置screenSize属性的程序activity又出现销毁情况。"><a href="#PS-在level13以后加入了一个screenSize的属性，这个属性很重要如果在android3-2以后的版本中没有添加”screenSize”的话依然会触发横竖屏activity销毁周期-也就是说不能屏蔽activity销毁，从而调用onConfigurationChanged方法，而在3-2之前只要设置orientation-keyboardHidden就可以-。由于智能机的迅速普及手机的系统大多数升级到4-0以上，这样会导致很多没有设置screenSize属性的程序activity又出现销毁情况。" class="headerlink" title="PS:在level13以后加入了一个screenSize的属性，这个属性很重要如果在android3.2以后的版本中没有添加”screenSize”的话依然会触发横竖屏activity销毁周期(也就是说不能屏蔽activity销毁，从而调用onConfigurationChanged方法，而在3.2之前只要设置orientation|keyboardHidden就可以)。由于智能机的迅速普及手机的系统大多数升级到4.0以上，这样会导致很多没有设置screenSize属性的程序activity又出现销毁情况。"></a>PS:在level13以后加入了一个screenSize的属性，这个属性很重要如果在android3.2以后的版本中没有添加”screenSize”的话依然会触发横竖屏activity销毁周期(也就是说不能屏蔽activity销毁，从而调用onConfigurationChanged方法，而在3.2之前只要设置orientation|keyboardHidden就可以)。由于智能机的迅速普及手机的系统大多数升级到4.0以上，这样会导致很多没有设置screenSize属性的程序activity又出现销毁情况。</h6><p>试试如下代码：<br>AndroidMainifest.xml中加入</p>
<pre><code>&lt;activity  
  android:name=&quot;.Activity&quot; 
  android:launchMode=&quot;singleTask&quot;    
  android:configChanges=&quot;orientationkeyboardHidden|screenSize&quot;/&gt;
</code></pre><p>复写acitivity的onConfigurationChanged方法</p>
<pre><code>@Override
public void onConfigurationChanged(Configuration newConfig) {
    //其实这里什么都不要做
    super.onConfigurationChanged(newConfig);
}
</code></pre>
          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/20/BaseRecyclerView/" itemprop="url">
                  对RecyclerView.Adapter的简单封装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-20T14:58:25+08:00" content="2016-04-20">
              2016-04-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对分页展示而言，RecyclerView已经可以完全替代ListView。这里只进行一下对其Adapter的简单封装。  </p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ul>
<li>目的：目的是为了减少Adapter具体实现的代码，使代码整洁，易于维护。</li>
<li>分析：与listview面向view的adapter不同，recyclerview面向的是viewholder。所以BaseRecyclerAdapter需要两个泛型声明，一个是数据源，一个是viewholder。<br>onCreateViewHoler()方法中需要生成具体的viewhoder实例，所以暂时不去对其做封装。对onBindViewHoler()方法的操作分为两步，一步是bindItemData()将数据填充至itemview，下一步是setupOnItemClick()设置每个item的点击监听。其它方法都是对便利性的扩展，可以根据不同情况添加。</li>
<li>并没有对viewholder动刀子，考虑到目前情况下在AS中利用ButterKnife可以高效的生成viewholder，对开发效率影响不大。不过ButterKnife毕竟是通过运行时反射对view进行绑定的，对效率是有影响，但是AS2.0之后发现Google有扶正DataBindding的趋势，所以综合考虑下，还是没有对viewholder动刀子。但是会在RecyclerView深入研究时思考这个问题。 </li>
</ul>
<h3 id="BaseRecyclerViewAdapter"><a href="#BaseRecyclerViewAdapter" class="headerlink" title="BaseRecyclerViewAdapter"></a>BaseRecyclerViewAdapter</h3><p>话不多说,上代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public abstract class BaseRecyclerAdapter&lt;T, VH extends RecyclerView.ViewHolder&gt; extends RecyclerView.Adapter&lt;VH&gt; &#123;</span><br><span class="line">    protected List&lt;T&gt; mDatas = new ArrayList&lt;&gt;();</span><br><span class="line">    protected Context mContext;</span><br><span class="line">    protected LayoutInflater inflater;</span><br><span class="line">    AdapterView.OnItemClickListener mItemClickListener;</span><br><span class="line">    public BaseRecyclerAdapter(List&lt;T&gt; mDatas, Context mContext) &#123;</span><br><span class="line">        this.mDatas = mDatas;</span><br><span class="line">        this.mContext = mContext;</span><br><span class="line">        inflater = LayoutInflater.from(mContext);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void onBindViewHolder(VH holder, int position) &#123;</span><br><span class="line">        final T item = getItem(position);</span><br><span class="line">        bindItemData(holder, item, position);</span><br><span class="line">        setupOnItemClick(holder, position);</span><br><span class="line">    &#125;</span><br><span class="line">    protected abstract void bindItemData(VH viewHolder, T data, int position);</span><br><span class="line">    protected void setupOnItemClick(final VH viewHolder, final int position) &#123;</span><br><span class="line">        if (mItemClickListener != null) &#123;</span><br><span class="line">            viewHolder.itemView.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void onClick(View v) &#123;</span><br><span class="line">                    mItemClickListener.onItemClick(null, viewHolder.itemView, position, position);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public int getItemCount() &#123;</span><br><span class="line">        return mDatas != null ? mDatas.size() : 0;</span><br><span class="line">    &#125;</span><br><span class="line">    public T getItem(int position) &#123;</span><br><span class="line">        position = Math.max(0, position);</span><br><span class="line">        return mDatas.get(position);</span><br><span class="line">    &#125;</span><br><span class="line">    public List&lt;T&gt; getDataSource() &#123;</span><br><span class="line">        return mDatas;</span><br><span class="line">    &#125;</span><br><span class="line">    public void addData(List&lt;T&gt; newItems) &#123;</span><br><span class="line">        if (newItems != null) &#123;</span><br><span class="line">            mDatas.addAll(newItems);</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public void updateListViewData(List&lt;T&gt; lists) &#123;</span><br><span class="line">        mDatas.clear();</span><br><span class="line">        if (lists != null) &#123;</span><br><span class="line">            mDatas.addAll(lists);</span><br><span class="line">            notifyDataSetChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public void setOnItemClickListener(AdapterView.OnItemClickListener listener) &#123;</span><br><span class="line">        this.mItemClickListener = listener;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class NotesAdapter extends BaseRecyclerAdapter&lt;NoteItem, NotesAdapter.NotesViewHolder&gt; &#123;</span><br><span class="line">    public NotesAdapter(List&lt;NoteItem&gt; mDatas, Context mContext) &#123;</span><br><span class="line">        super(mDatas, mContext);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public NotesViewHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;</span><br><span class="line">        View contentView = LayoutInflater.from(mContext)</span><br><span class="line">                .inflate(R.layout.recycler_item_note, parent, false);</span><br><span class="line">        NotesViewHolder vh = new NotesViewHolder(contentView);</span><br><span class="line">        return vh;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void bindItemData(NotesViewHolder viewHolder, NoteItem data, int position) &#123;</span><br><span class="line">        viewHolder.titleTxt.setText(data.getTitle());</span><br><span class="line">        viewHolder.timeTxt.setText(data.getCreatedTime());</span><br><span class="line">        viewHolder.tagTxt.setText(data.getTags().size() != 0 ? data.getTags().get(0) : &quot;other&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    static class NotesViewHolder extends RecyclerView.ViewHolder &#123;</span><br><span class="line">        @Bind(R.id.title_txt)</span><br><span class="line">        TextView titleTxt;</span><br><span class="line">        @Bind(R.id.time_txt)</span><br><span class="line">        TextView timeTxt;</span><br><span class="line">        @Bind(R.id.tag_txt)</span><br><span class="line">        TextView tagTxt;</span><br><span class="line">        NotesViewHolder(View view) &#123;</span><br><span class="line">            super(view);</span><br><span class="line">            ButterKnife.bind(this, view);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/20/gson/" itemprop="url">
                  Gson解析（List和Map）格式json数据
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-20T14:58:25+08:00" content="2016-04-20">
              2016-04-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有时候服务端非得返回比较傻逼的Json</p>
<h2 id="这时候可以用gson解析带有键值对的json"><a href="#这时候可以用gson解析带有键值对的json" class="headerlink" title="这时候可以用gson解析带有键值对的json"></a>这时候可以用gson解析带有键值对的json</h2><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public class jsonParse&#123;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">class City&#123;</span><br><span class="line"></span><br><span class="line">        int id;</span><br><span class="line"></span><br><span class="line">        String name;</span><br><span class="line"></span><br><span class="line">        String code;</span><br><span class="line"></span><br><span class="line">        String map;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        //列表/array 数据</span><br><span class="line"></span><br><span class="line">                 String str=<span class="string">"[&#123;'id': '1','code': 'bj','name': '北京','map': '39.90403, 116.40752599999996'&#125;, &#123;'id': '2','code': 'sz','name': '深圳','map': '22.543099, 114.05786799999998'&#125;, &#123;'id': '9','code': 'sh','name': '上海','map': '31.230393,121.473704'&#125;, &#123;'id': '10','code': 'gz','name': '广州','map': '23.129163,113.26443500000005'&#125;]"</span>;</span><br><span class="line"></span><br><span class="line">        Gson gson=new Gson();</span><br><span class="line"></span><br><span class="line">        List&lt;City&gt; rs=new ArrayList&lt;City&gt;();</span><br><span class="line"></span><br><span class="line">         Type <span class="built_in">type</span> = new TypeToken&lt;ArrayList&lt;City&gt;&gt;() &#123;&#125;.getType();</span><br><span class="line"></span><br><span class="line">          rs=gson.fromJson(str, <span class="built_in">type</span>);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span>(City o:rs)&#123;</span><br><span class="line"></span><br><span class="line">                  System.out.println(o.name);</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          </span><br><span class="line"></span><br><span class="line">          //map数据</span><br><span class="line"></span><br><span class="line">          String jsonStr=<span class="string">"&#123;'1': &#123;'id': '1','code': 'bj','name': '北京','map': '39.90403, 116.40752599999996'&#125;,'2': &#123;'id': '2','code': 'sz','name': '深圳','map': '22.543099, 114.05786799999998'&#125;,'9': &#123;'id': '9','code': 'sh','name': '上海','map': '31.230393,121.473704'&#125;,'10': &#123;'id': '10','code': 'gz','name': '广州','map': '23.129163,113.26443500000005'&#125;&#125;"</span>;</span><br><span class="line"></span><br><span class="line">          Map&lt;String, City&gt; citys = gson.fromJson(jsonStr, new TypeToken&lt;Map&lt;String, City&gt;&gt;() &#123;&#125;.getType()); </span><br><span class="line"></span><br><span class="line">          System.out.println(citys.get(<span class="string">"1"</span>).name+<span class="string">"----------"</span>+citys.get(<span class="string">"2"</span>).code);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/20/gsonUtil/" itemprop="url">
                  Gson工具类
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-20T14:58:25+08:00" content="2016-04-20">
              2016-04-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用泛型来封装Gson</p>
<h2 id="泛型才是JAVA的精髓"><a href="#泛型才是JAVA的精髓" class="headerlink" title="泛型才是JAVA的精髓"></a>泛型才是JAVA的精髓</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">import com.google.gson.Gson;</span><br><span class="line">import com.google.gson.JsonArray;</span><br><span class="line">import com.google.gson.JsonElement;</span><br><span class="line">import com.google.gson.JsonParser;</span><br><span class="line">import com.google.gson.reflect.TypeToken;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class GsonUtil &#123;</span><br><span class="line">    private static Gson gson = null;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        <span class="keyword">if</span> (gson == null) &#123;</span><br><span class="line">            gson = new Gson();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="function"><span class="title">GsonUtil</span></span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成json</span><br><span class="line">     *</span><br><span class="line">     * @param object</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static String GsonString(Object object) &#123;</span><br><span class="line">        String gsonString = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            gsonString = gson.toJson(object);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> gsonString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成bean</span><br><span class="line">     *</span><br><span class="line">     * @param gsonString</span><br><span class="line">     * @param cls</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; T GsonToBean(String gsonString, Class&lt;T&gt; cls) &#123;</span><br><span class="line">        T t = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            t = gson.fromJson(gsonString, cls);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成list</span><br><span class="line">     * 解决泛型问题</span><br><span class="line">     *</span><br><span class="line">     * @param json</span><br><span class="line">     * @param cls</span><br><span class="line">     * @param &lt;T&gt;</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; List&lt;T&gt; GsonToList(String json, Class&lt;T&gt; cls) &#123;</span><br><span class="line">        Gson gson = new Gson();</span><br><span class="line">        List&lt;T&gt; list = new ArrayList&lt;T&gt;();</span><br><span class="line">        JsonArray array = new JsonParser().parse(json).getAsJsonArray();</span><br><span class="line">        <span class="keyword">for</span> (final JsonElement elem : array) &#123;</span><br><span class="line">            list.add(gson.fromJson(elem, cls));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成list中有map的</span><br><span class="line">     *</span><br><span class="line">     * @param gsonString</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; List&lt;Map&lt;String, T&gt;&gt; GsonToListMaps(String gsonString) &#123;</span><br><span class="line">        List&lt;Map&lt;String, T&gt;&gt; list = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            list = gson.fromJson(gsonString, new TypeToken&lt;List&lt;Map&lt;String, T&gt;&gt;&gt;() &#123;</span><br><span class="line">            &#125;.getType());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 转成map的</span><br><span class="line">     *</span><br><span class="line">     * @param gsonString</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; Map&lt;String, T&gt; GsonToMaps(String gsonString) &#123;</span><br><span class="line">        Map&lt;String, T&gt; map = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            map = gson.fromJson(gsonString, new TypeToken&lt;Map&lt;String, T&gt;&gt;() &#123;</span><br><span class="line">            &#125;.getType());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">     * 将Map转化为Json</span><br><span class="line">     *</span><br><span class="line">     * @param map</span><br><span class="line">     * @<span class="built_in">return</span> String</span><br><span class="line">     */</span><br><span class="line">    public static &lt;T&gt; String mapToJson(Map&lt;String, T&gt; map) &#123;</span><br><span class="line">        String jsonStr = null;</span><br><span class="line">        <span class="keyword">if</span> (gson != null) &#123;</span><br><span class="line">            jsonStr = gson.toJson(map);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">return</span> jsonStr;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/default_avatar.jpg" alt="Mikee">
          <p class="site-author-name" itemprop="name">Mikee</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">8</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mikee</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
